/* >>> file start: js/jquery/jquery.comments.js */
!function(e){e.comments=e.comments||{options:{selectors:{leaf:LJ.Util.isMediusJournal()?".mdspost-comment":".b-leaf",levelTwig:LJ.Util.isMediusJournal()?".mdspost-thread--level-{level}":".b-tree-twig-{level}",twig:LJ.Util.isMediusJournal()?".mdspost-thread":".b-tree-twig"},classNames:{levelTwig:LJ.Util.isMediusJournal()?"mdspost-thread--level-{level}":"b-tree-twig-{level}"}},scrollIsBugged:LJ.Support.isMobile(),mustFocusSynchronously:LJ.Support.isMobile(),skipAnimation:jQuery.browser.msie&&+jQuery.browser.version<=8||LJ.Support.isMobile()||!1,isMac:!!navigator.appVersion.match(/mac/i),_selector:function(e){return this.options.selectors[e]},_className:function(e){return this.options.classNames[e]}};var t=e.comments._selector.bind(e.comments),s=e.comments._className.bind(e.comments);e.extend(e.comments,{level:function(e){var l=e.is(t("twig"))?e:e.closest(t("twig")),i=RegExp(s("levelTwig").supplant({level:"(\\d+)"})).exec(l.prop("className"));return i&&parseInt(i[1],10)||1},parent:function(s,l){for(var i=s.closest(t("twig")),n=e.comments.level(i),r=i;n>1;){if(n--,r=r.prevAll(t("levelTwig").supplant({level:n})+":first"),0===r.length)return!1;if(!l||r.data("tid")===l)return r.find(t("leaf"))}return!1},parentByID:function(e){var t=angular.element("#"+e);return t.length?this.parent(t):!1},hasChildren:function(s){var l=s.is(t("twig"))?s:s.closest(t("twig")),i=e.comments.level(l);return e.comments.level(l.next())>i},isChild:function(s,l){var i=s.is(t("twig"))?s:s.closest(t("twig")),n=l.is(t("twig"))?l:l.closest(t("twig")),r=e.comments.level(l),o=e.comments.level(s);if(1===o||r>=o)return!1;var a=i.prevAll(t("levelTwig").supplant({level:r})+":first");return a.get(0)===n.get(0)},getThread:function(s,l){var i,n=s.closest(t("twig")),r=e.comments.level(n),o=l?[]:jQuery(),a=n;for(l?o.push(n.find(t("leaf"))):o=o.add(n.find(t("leaf")));;){if(a=a.next(),0===a.length)break;if(i=e.comments.level(a),r>=i)break;l?o.push(a.find(t("leaf"))):o=o.add(a.find(t("leaf")))}return o}})}(jQuery);
/* <<< file end: js/jquery/jquery.comments.js */

//# map link was there [jquery.comments.js.map]
/* >>> file start: js/jquery/jquery.hotkeys.js */
!function(e){function t(t){if("string"==typeof t.data){var s=t.handler,a=t.data.toLowerCase().split(" ");t.handler=function(t){if(this===t.target||!/textarea|select/i.test(t.target.nodeName)&&!/text|password|search|tel|url|email|number/.test(t.target.type)){var r="keypress"!==t.type&&e.hotkeys.specialKeys[t.which],f=String.fromCharCode(t.which).toLowerCase(),i="",h={};t.altKey&&"alt"!==r&&(i+="alt+"),t.ctrlKey&&"ctrl"!==r&&(i+="ctrl+"),t.metaKey&&!t.ctrlKey&&"meta"!==r&&(i+="meta+"),t.shiftKey&&"shift"!==r&&(i+="shift+"),r?h[i+r]=!0:(h[i+f]=!0,h[i+e.hotkeys.shiftNums[f]]=!0,"shift+"===i&&(h[e.hotkeys.shiftNums[f]]=!0));for(var l=0,o=a.length;o>l;l++)if(h[a[l]])return s.apply(this,arguments)}}}}e.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",187:"+",189:"-",191:"/",224:"meta"},shiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}},e.each(["keydown","keyup","keypress"],function(){e.event.special[this]={add:t}})}(jQuery);
/* <<< file end: js/jquery/jquery.hotkeys.js */

//# map link was there [jquery.hotkeys.js.map]
/* >>> file start: js/jquery/jquery.lj.commentsPager.js */
//= require js/jquery/jquery.hotkeys.js
!function(t){"use strict";function e(t){this._switch("prev",t)}function a(t){this._switch("next",t)}function i(){return this._currentPage}function s(t){var e=Number(jQuery(t.currentTarget).text());e&&this._switch(e,t)}function r(t){var e;this._el("page").removeClass(this._cl("active")).eq(t-1).addClass(this._cl("active")),this.element.toggleClass(this._cl("first"),1===t).toggleClass(this._cl("last"),t===this._totalPages),this._ajaxLoader&&this._master&&(e=location.href.split("#")[0].replace(/\&?(page|view)=\d+/g,""),e=LiveJournal.constructUrl(e,t>1?{page:t}:null).replace("?&","?"),location.href.indexOf("adaptive")>-1&&location.href.indexOf("#comments")>-1&&(e+="#comments"),t!==this._currentPage&&(this._pushStateCount++,window.history.pushState(null,"",e))),this._ajaxLoader&&(e=location.href.split("#")[0].replace(/\&?(page|view)=\d+/g,""),this._el("prev").attr("href",LiveJournal.constructUrl(e,3>t?null:{page:t-1})),this._el("next").attr("href",LiveJournal.constructUrl(e,{page:t+1}))),this._currentPage=t,this._formatPages()}function n(t,e){LJ.Event.trigger("comments::beforeSwitch");var a,i,s=!!document.activeElement.closest("[contenteditable]");s||(this._ajaxLoader?(i="next"!==t&&"prev"!==t?t:this._currentPage+("next"===t?1:-1),i=this._correctPageNumber(i),i!==this._currentPage&&this._fire("commentsPage",[i],!0)):(a=this._links[t].prop("href"),document.location=a),LJ.Event.trigger("commentsPager/change"),e&&e.preventDefault&&e.preventDefault())}function o(){var e,a=this;this._master&&(e=this._scrollTop,this._scrollTop=t(window).scrollTop(),this._scrollTop<=e||(this._bottomPager=this._bottomPager||t(".b-pager").last(),this._bottomPager.is(":screenable")&&!this._cachePages[this._currentPage]&&(this._cachePages[this._currentPage]=!0,setTimeout(function(){a._cachePages[a._currentPage]=!1},1e3*a._cachePagesTime),this._fire("cachePage",[this._correctPageNumber(this._currentPage+1)]),this._fire("cachePage",[this._correctPageNumber(this._currentPage-1)]))))}function c(t){return 1>t?1:t>this._totalPages?this._totalPages:t}function h(){t.lj.basicWidget.prototype._bindControls.apply(this);var e=this,a=t.comments.isMac?"alt":"ctrl",i=LJ.Function.threshold(this._switch,500);_||(jQuery(document).bind("keydown",a+"+left",i.bind(this,"prev")).bind("keydown",a+"+right",i.bind(this,"next")),this._ajaxLoader&&(window.onpopstate=function(){var t=1;location.href.match(/page=(\d+)/)&&(t=Number(RegExp.$1)),e._currentPage!==t&&e._pushStateCount>0&&(e._currentPage=t,e._fire("commentsPage",[t],!0))},t(window).on("scroll",LJ.Function.throttle(this._scroll.bind(this),100))),_=!0,this._master=!0),this._ajaxLoader&&(this.element.on("click",this._s("page"),this.loadPage.bind(this)).on("click",this._s("next"),this.next.bind(this)).on("click",this._s("prev"),this.prev.bind(this)),this._on("commentsPage",function(t){this._updatePager(t)}.bind(this)))}function l(){function t(t){jQuery(i[t]).after(a)}function e(t,e){LJ.Function.range(t,e).forEach(function(t){jQuery(i[t]).hide()})}jQuery(".b-pager-more__wrap",this.element).remove();var a='<li class="b-pager-page b-pager-more__wrap"><span class="b-pager-more">...</span></li>',i=this._el("page");if(i.show(),!(this._totalPages<=9)){if(10===this._totalPages)return this._currentPage<=5?(e(7,8),t(7)):(e(1,2),t(1));if(this._currentPage<=5)return e(7,this._totalPages-2),t(7);if(this._currentPage>=this._totalPages-4)return e(1,this._totalPages-8),t(1);e(1,this._currentPage-4),e(this._currentPage+2,this._totalPages-2),t(1),t(this._currentPage+2)}}function g(){t.lj.basicWidget.prototype._create.apply(this);var e=this.options.selectors,a=this.element;this._scrollTop=null,this._bottomPager=null,this._cachePages={},this._cachePagesTime=100,this._links={prev:a.find(e.prev),next:a.find(e.next)},t.comments.isMac&&this.element.addClass(this._cl("mac")),this._ajaxLoader=!(!LJ.get("ajaxPagination")||!LJ.Support.history),this._currentPage=parseInt(a.find(e.active).text(),10)||1,this._totalPages=this._el("page").length,this._master=!1,this._formatPages(),this._pushStateCount=/webkit/i.test(navigator.userAgent)?0:1,this._bindControls()}var _=!1,u={classNames:{first:"b-pager-first",last:"b-pager-last",mac:"b-pager-mac",active:"b-pager-page-active"},selectors:{page:".b-pager-page",prev:".b-pager-prev a",next:".b-pager-next a",active:".b-pager-page-active"}};t.widget("lj.commentsPager",jQuery.lj.basicWidget,{options:u,_create:g,_bindControls:h,_formatPages:l,_correctPageNumber:c,_scroll:o,_switch:n,_updatePager:r,loadPage:s,page:i,next:a,prev:e})}(jQuery);
/* <<< file end: js/jquery/jquery.lj.commentsPager.js */

//# map link was there [jquery.lj.commentsPager.js.map]
/* >>> file start: js/core/crossStorageClient.js */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};!function(){var e=LJ.Util.getWindow(),t={};LJ.define("LJ.Util.CrossStorage"),LJ.Util.CrossStorage=t;var n=void 0,r=[];e.addEventListener("message",function(e){if(e.origin===LJ.get("statprefix")){var t=e.data||{};"ljCrossStorage.storageEvent"===t.messageType&&r.forEach(function(e){e(_extends({},t.eventObj))})}});var o=function(){if(n)return n;var t=e.document.createElement("iframe");return t.style.cssText="display: none; width: 0; height: 0; border: 0;",t.frameBorder=0,t.src=LJ.get("statprefix")+("/??plain/crossStorageServ.html?&v="+LJ.get("v")),e.document.body.appendChild(t),n=new Promise(function(e){var n=setTimeout(function(){t.src=t.src+"0"},5e3);t.onload=function(){clearTimeout(n),e(t)}})},s=function(t){var n=t.requestID;return new Promise(function(t){var r=function o(r){if(r.origin===LJ.get("statprefix")){var s=r.data||{};"object"===("undefined"==typeof s?"undefined":_typeof(s))&&"crossStorageServResponse"in s&&s.requestID===n&&(e.removeEventListener("message",o),t(s.crossStorageServResponse))}};e.addEventListener("message",r)})};t.getItem=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return o().then(function(n){var r=Date.now()+""+Math.floor(1e4*Math.random()),o={fn:"getItem",args:[e],source:"LJ.CrossStorage",requestID:r};return n.contentWindow.postMessage(o,"*"),s({requestID:r}).then(function(e){var n=e;if(t.parseJSON)try{n=JSON.parse(e)}catch(r){}return n})})},t.setItem=function(e,t){return o().then(function(n){var r={fn:"setItem",source:"LJ.CrossStorage",args:[e,t]};n.contentWindow.postMessage(r,"*")})},t.listenStorageEvents=function(e){r.push(e)}}();
/* <<< file end: js/core/crossStorageClient.js */

//# map link was there [crossStorageClient.js.map]
/* >>> file start: js/misc/newCommentsCounter.js */
//= require js/core/crossStorageClient.js
!function(){var r={};LJ.define("LJ.Misc.NewCommentsCounter"),LJ.Misc.NewCommentsCounter=r;var e=1e3,t="ljNewCommentsCounter",n=LJ.Util.CrossStorage,o=function(){return{counters:{},orderArr:[],v:.1}};r.getAllStoredData=function(){return n.getItem(t,{parseJSON:!0})};var u=function(r){return r.replace(/^https?:\/\//,"")};r.setCounter=function(){var c=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],s=c.postURL,i=c.count;return r.getAllStoredData().then(function(r){var c=u(s),a=o();r&&(a=r),a.counters[c]=i;var d=a.orderArr.indexOf(c);d>-1&&(a.orderArr=a.orderArr.slice(0,d).concat(a.orderArr.slice(d+1))),a.orderArr.push(c);var l=a.orderArr.length-e;if(l>0){var f=a.orderArr.slice(0,l);a.orderArr=a.orderArr.slice(l),f.forEach(function(r){return delete a.counters[r]})}n.setItem(t,a)})},r.getCount=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.postURL,n=u(t);return r.getAllStoredData().then(function(r){if(!r||!r.counters)return Promise.reject();var e=r.counters;return"number"!=typeof e[n]?Promise.reject():e[n]})},r.createCounter=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=e.count,n=u(e.postURL);return r.getCount({postURL:n})["catch"](function(){r.setCounter({postURL:n,count:t})})}}();
/* <<< file end: js/misc/newCommentsCounter.js */

//# map link was there [newCommentsCounter.js.map]
/* >>> file start: js/jquery/jquery.lj.comments.js */
function _maybeArrayLike(e,t,o){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var n=t.length;return _arrayLikeToArray(t,void 0!==o&&n>o?o:n)}return e(t,o)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){return"undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0}function _arrayWithoutHoles(e){return Array.isArray(e)?_arrayLikeToArray(e):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);t>o;o++)n[o]=e[o];return n}function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),o.push.apply(o,n)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach(function(t){_defineProperty(e,t,o[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))})}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}
LJ.UI.registerTemplate('templates-Comments-Twig', "<div class=\" b-tree-twig {{if $data.level}} b-tree-twig-{{html $data.level}} b-tree-twig-deep-{{html $data.deepLevel}} {{/if}} \" style=\"margin-left: {{html $data.margin}}px\" data-tid=\"t{{html $data.dtalkid}}\" > {{if $data.html}} {{html $data.html}} {{else}} {{if $data.more}} <div class=\" b-leaf b-leaf-seemore {{if $data.moreclass}} b-leaf-seemore-{{html $data.moreclass}} {{/if}} \" data-parent=\"{{html $data.parent}}\" data-dtalkids=\"{{html $data.data}}\" data-updated-ts=\"{{html $data.touched}}\" data-count=\"{{html $data.more}}\" > <div class=\" b-leaf-inner svgpreloader svgpreloader-pseudo svgpreloader-16 \"> {{each ($value.actions || $data.actions)}} <span class=\"b-leaf-seemore-more\"> <a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" class=\"b-pseudo\" >{{html ($value.title || $data.title)}}</a> </span> {{if ($value.is_remote_sup || $data.is_remote_sup)}} {{if ($value.ljusers || $data.ljusers)}} <span class=\"b-leaf-seemore-from\">{{html LJ.mltext(\'talk.from\')}}</span> <span class=\"b-leaf-seemore-users\">{{each ($value.ljusers || $data.ljusers)}}{{if !(($value.anonymous || $data.anonymous))}}{{if ($value.legacy || $data.legacy)}}{{html ($value.ljuser || $data.ljuser)}}{{else}}{{if ($value.amp || $data.amp)}}<span class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \">{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" class=\"i-ljuser-profile\" ><amp-img class=\"i-ljuser-userhead\" src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" width=\"16\" height=\"16\" ></amp-img></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" ><b>{{html ($value.journal || $data.journal)}}</b></a></span>{{else}}<span {{if ($value.inline_css || $data.inline_css)}} style=\" white-space:nowrap; {{if ($value.striked || $data.striked)}} text-decoration:line-through; {{/if}} \" {{/if}} class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \" {{html ($value.attrs || $data.attrs)}} data-ljuser=\"{{html ($value.username || $data.username)}}\" lj:user=\"{{html ($value.username || $data.username)}}\" >{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} class=\"i-ljuser-profile\" ><img {{if ($value.inline_css || $data.inline_css)}} width=\"16\" height=\"16\" style=\"vertical-align:text-bottom;border:0;padding-right:1px;\" {{else}} class=\"i-ljuser-userhead\" {{/if}} src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" /></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" {{if ($value.color || $data.color)}} style=\"color:{{html ($value.color || $data.color)}};\" {{/if}} {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} {{if ($value.alias || $data.alias)}} title=\"{{html ($value.user_alias || $data.user_alias)}}\" {{/if}} >{{if ($value.inline_css || $data.inline_css)}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.alias || $data.alias)}}<span class=\"useralias-value\">*</span>{{/if}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{else}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{/if}}</a>{{if ($value.alias || $data.alias) && ($value.side_alias || $data.side_alias)}}<span class=\"alias-value i-ljuser-alias\">{{html ($value.user_alias || $data.user_alias)}}</span>{{/if}}</span>{{/if}} {{/if}}{{else}}{{html LJ.mltext(\'talk.anonuser\')}}{{/if}}{{if !(($index ===  ljusers.length - 1))}},&nbsp;{{/if}}{{/each}}{{if ($value.moreusers || $data.moreusers)}}&hellip;{{/if}}</span> {{/if}} {{/if}} <span class=\"b-leaf-seemore-expand\"> <a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" class=\"b-pseudo\" >{{html LJ.mltext(\'talk.expandlink\')}}</a> </span> {{/each}} </div> </div> {{else}} {{if $data.deleted || !$data.shown}} <div class=\" b-leaf b-leaf-clipped b-leaf-{{html $data.leafclass}} \" {{if !($data.noid)}} id=\"t{{html $data.dtalkid}}\" {{/if}} > <div class=\" b-leaf-inner svgpreloader svgpreloader-pseudo svgpreloader-16 \"> <div class=\"b-leaf-cheader\"> <p class=\"b-leaf-status\"> {{if $data.leafclass == \'deleted\'}} {{html LJ.mltext(\'talk.deletedpost\')}} {{else $data.leafclass == \'screened\'}} {{html LJ.mltext(\'talk.screenedpost\')}} {{else $data.leafclass == \'spammed\'}} {{html LJ.mltext(\'talk.spammedpost\')}} {{else $data.leafclass == \'suspended\'}} {{html LJ.mltext(\'talk.suspendedpost\')}} {{/if}} </p> {{if $data.controls}} <ul class=\"b-leaf-controls\"> {{each ($value.controls || $data.controls)}} {{if ($value.allowed || $data.allowed)}} {{if !($value.nocontrols || $data.nocontrols) || ($value.name || $data.name) == \'cancel_best\'}} <li class=\"b-leaf-controls-item b-leaf-controls-item-{{html ($value.name || $data.name)}}\"><a class=\" b-controls b-controls-{{html ($value.name || $data.name)}} \" title=\"{{html ($value.title || $data.title)}}\" href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" ><i class=\"b-controls-bg\"></i>{{html ($value.title || $data.title)}}</a></li> {{/if}} {{/if}} {{/each}} </ul> {{/if}} {{if $data.actions}} <ul class=\"b-leaf-actions\"> {{each ($value.actions || $data.actions)}} {{if !(($value.footer || $data.footer))}} {{if ($value.name || $data.name) != \'permalink\'}} {{if !($value.noid || $data.noid) || ($value.name || $data.name) != \'collapse\'}} {{if ($value.allowed || $data.allowed)}} {{if !($value.checkbox || $data.checkbox) || ($value.massactions || $data.massactions)}} <li class=\" b-leaf-actions-item b-leaf-actions-{{if ($value.checkbox || $data.checkbox)}}check{{else}}{{html ($value.name || $data.name)}}{{/if}} {{if ($value.noid || $data.noid) && ($value.name || $data.name) == \'reply\'}} b-leaf-actions-noid {{/if}} {{if ($value.active || $data.active)}} active {{/if}} \" data-tid=\"t{{html ($value.dtalkid || $data.dtalkid)}}\" > {{if ($value.disabled || $data.disabled)}} {{html ($value.title || $data.title)}} {{else}} {{if ($value.checkbox || $data.checkbox)}} <label class=\"b-leaf-actions-label\" > <input type=\"checkbox\" data-item-id=\"c{{html ($value.dtalkid || $data.dtalkid)}}\" name=\"selected_{{html ($value.talkid || $data.talkid)}}\" class=\"b-leaf-actions-checkbox\" autocomplete=\"off\" > <span class=\"b-leaf-actions-label-text\">{{html ($value.title || $data.title)}}</span> </label> {{else}} <a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" {{if ($value.name || $data.name) != \'permalink\'}} class=\"b-pseudo\" {{/if}} >{{html ($value.title || $data.title)}}</a>{{if ($value.ljusers || $data.ljusers)}}&nbsp;{{html ($value.ljusers || $data.ljusers)}}{{if ($value.moreusers || $data.moreusers)}}, &ellipsis;{{/if}}{{/if}} {{/if}} {{/if}} </li> {{/if}} {{/if}} {{/if}} {{/if}} {{/if}} {{/each}} </ul> {{/if}} </div> <div class=\"b-leaf-footer\"> {{if $data.actions}} <ul class=\"b-leaf-actions\"> {{each ($value.actions || $data.actions)}} {{if ($value.footer || $data.footer)}} {{if ($value.name || $data.name) != \'permalink\'}} {{if !($value.noid || $data.noid) || ($value.name || $data.name) != \'collapse\'}} {{if ($value.allowed || $data.allowed)}} {{if !($value.checkbox || $data.checkbox) || ($value.massactions || $data.massactions)}} <li class=\" b-leaf-actions-item b-leaf-actions-{{if ($value.checkbox || $data.checkbox)}}check{{else}}{{html ($value.name || $data.name)}}{{/if}} {{if ($value.noid || $data.noid) && ($value.name || $data.name) == \'reply\'}} b-leaf-actions-noid {{/if}} {{if ($value.active || $data.active)}} active {{/if}} \" data-tid=\"t{{html ($value.dtalkid || $data.dtalkid)}}\" > {{if ($value.disabled || $data.disabled)}} {{html ($value.title || $data.title)}} {{else}} {{if ($value.checkbox || $data.checkbox)}} <label class=\"b-leaf-actions-label\" > <input type=\"checkbox\" data-item-id=\"c{{html ($value.dtalkid || $data.dtalkid)}}\" name=\"selected_{{html ($value.talkid || $data.talkid)}}\" class=\"b-leaf-actions-checkbox\" autocomplete=\"off\" > <span class=\"b-leaf-actions-label-text\">{{html ($value.title || $data.title)}}</span> </label> {{else}} <a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" {{if ($value.name || $data.name) != \'permalink\'}} class=\"b-pseudo\" {{/if}} >{{html ($value.title || $data.title)}}</a>{{if ($value.ljusers || $data.ljusers)}}&nbsp;{{html ($value.ljusers || $data.ljusers)}}{{if ($value.moreusers || $data.moreusers)}}, &ellipsis;{{/if}}{{/if}} {{/if}} {{/if}} </li> {{/if}} {{/if}} {{/if}} {{/if}} {{/if}} {{/each}} </ul> {{/if}} </div> </div> </div> {{else}} <div {{if !($data.noid)}} id=\"t{{html $data.dtalkid}}\" {{/if}} class=\" b-leaf {{if $data.leafclass}} b-leaf-{{html $data.leafclass}} {{/if}} {{if $data.suspended}} b-leaf-suspended {{/if}} {{if $data.tracked}} b-leaf-tracked {{/if}} {{if $data.subclass}} b-leaf-{{html $data.subclass}} {{/if}} {{if $data.p_tracked}} b-leaf-tracked-parent {{/if}} {{if $data.modereply}} b-leaf-modereply {{/if}} {{if $data.uname == $data.poster}} b-leaf-poster {{/if}} {{if $data.subject}} b-leaf-withsubject {{/if}} {{if $data.is_best}} b-leaf-best {{/if}} {{if $data.is_promo}} b-leaf-promo {{/if}} {{if $data.loaded}} b-leaf-full {{/if}} {{if $data.is_hatespeech}} b-leaf-collapsed b-leaf-hatespeech {{/if}} comment p-comment \" data-username=\"{{html $data.uname}}\" data-displayname=\"{{html $data.dname}}\" data-updated-ts=\"{{html $data.ctime_ts}}\" {{if $data.loaded}} data-full=\"1\" {{/if}} {{if $data.subject}} data-subject=\"{{html $data.subject}}\" {{/if}} > <div class=\" b-leaf-inner svgpreloader svgpreloader-pseudo svgpreloader-16 \"> <div class=\"b-leaf-header\"> <div class=\"b-leaf-userpic\"> <a href=\"{{html $data.commenter_journal_base}}\" target=\"_blank\" class=\"b-leaf-userpic-inner\" {{if !($data.amp)}} lj:user=\"{{html $data.uname}}\"> {{/if}} {{if $data.userpic}} <img src=\"{{html $data.userpic}}\" alt=\"{{html $data.uname}}\" loading=\"lazy\" {{if $data.upictitle}} title=\"{{html $data.upictitle}}\" {{/if}} > {{else}} <img src=\"{{html $data.lj_statprefix}}{{if $data.username}}/img/userpics/userpic-user.png?v=15821{{else}}/img/userpics/userpic-anonymous.png?v=15821{{/if}}\" alt=\"{{html $data.uname}}\" loading=\"lazy\" > {{/if}} </a> </div> <div class=\"b-leaf-details\"> {{if $data.shown}} {{if $data.subject}} <h4 class=\"b-leaf-subject\"><a href=\"{{html $data.thread_url}}\" class=\"b-leaf-subject-link\" >{{html $data.subject}}</a></h4> {{/if}} <p class=\"b-leaf-username\">{{if $data.is_best}}<span class=\" b-leaf-badge b-leaf-badge-best \" >{{html LJ.mltext(\'talk.comment.best\')}}</span>{{/if}}{{if $data.is_promo}}<span class=\" b-leaf-badge b-leaf-badge-promo \" >{{html LJ.mltext(\'talk.comment.promo\')}}</span>{{/if}}<span class=\"b-leaf-username-name\">{{if $data.username}}{{if $data.deleted_poster}}{{html $data.deleted_poster}}{{else}}{{each ($value.username || $data.username)}}{{if ($value.legacy || $data.legacy)}}{{html ($value.ljuser || $data.ljuser)}}{{else}}{{if ($value.amp || $data.amp)}}<span class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \">{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" class=\"i-ljuser-profile\" ><amp-img class=\"i-ljuser-userhead\" src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" width=\"16\" height=\"16\" ></amp-img></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" ><b>{{html ($value.journal || $data.journal)}}</b></a></span>{{else}}<span {{if ($value.inline_css || $data.inline_css)}} style=\" white-space:nowrap; {{if ($value.striked || $data.striked)}} text-decoration:line-through; {{/if}} \" {{/if}} class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \" {{html ($value.attrs || $data.attrs)}} data-ljuser=\"{{html ($value.username || $data.username)}}\" lj:user=\"{{html ($value.username || $data.username)}}\" >{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} class=\"i-ljuser-profile\" ><img {{if ($value.inline_css || $data.inline_css)}} width=\"16\" height=\"16\" style=\"vertical-align:text-bottom;border:0;padding-right:1px;\" {{else}} class=\"i-ljuser-userhead\" {{/if}} src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" /></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" {{if ($value.color || $data.color)}} style=\"color:{{html ($value.color || $data.color)}};\" {{/if}} {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} {{if ($value.alias || $data.alias)}} title=\"{{html ($value.user_alias || $data.user_alias)}}\" {{/if}} >{{if ($value.inline_css || $data.inline_css)}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.alias || $data.alias)}}<span class=\"useralias-value\">*</span>{{/if}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{else}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{/if}}</a>{{if ($value.alias || $data.alias) && ($value.side_alias || $data.side_alias)}}<span class=\"alias-value i-ljuser-alias\">{{html ($value.user_alias || $data.user_alias)}}</span>{{/if}}</span>{{/if}} {{/if}}{{/each}}{{/if}}{{else}}{{html LJ.mltext(\'talk.anonuser\')}}{{/if}}</span> {{if $data.ipaddr}} <span class=\"b-leaf-ipaddr\">{{html $data.ipaddr}}</span> {{/if}} </p> <p class=\"b-leaf-meta\"> {{if $data.ctime}} <a href=\"{{html $data.thread_url}}\" class=\"b-leaf-permalink\" > <span class=\"b-leaf-createdtime\">{{html $data.ctime}}</span> </a> {{/if}} {{if $data.stime}} <span class=\"b-leaf-shorttime\">{{html $data.stime}}</span> {{/if}} {{if $data.etime}} <span class=\"b-leaf-editedtime\">{{html LJ.mltext(\'talk.edited\')}}&nbsp;{{html $data.etime}}</span> {{/if}} </p> {{if $data.is_hatespeech}} <p class=\"b-leaf-status\"> {{html LJ.mltext(\'talk.hatespeechpost\')}} </p> {{/if}} {{if $data.actions}} <ul class=\"b-leaf-actions\"> {{each ($value.actions || $data.actions)}} {{if !(($value.footer || $data.footer))}} {{if ($value.name || $data.name) != \'permalink\'}} {{if !($value.noid || $data.noid) || ($value.name || $data.name) != \'collapse\'}} {{if ($value.allowed || $data.allowed)}} {{if !($value.checkbox || $data.checkbox) || ($value.massactions || $data.massactions)}} <li class=\" b-leaf-actions-item b-leaf-actions-{{if ($value.checkbox || $data.checkbox)}}check{{else}}{{html ($value.name || $data.name)}}{{/if}} {{if ($value.noid || $data.noid) && ($value.name || $data.name) == \'reply\'}} b-leaf-actions-noid {{/if}} {{if ($value.active || $data.active)}} active {{/if}} \" data-tid=\"t{{html ($value.dtalkid || $data.dtalkid)}}\" > {{if ($value.disabled || $data.disabled)}} {{html ($value.title || $data.title)}} {{else}} {{if ($value.checkbox || $data.checkbox)}} <label class=\"b-leaf-actions-label\" > <input type=\"checkbox\" data-item-id=\"c{{html ($value.dtalkid || $data.dtalkid)}}\" name=\"selected_{{html ($value.talkid || $data.talkid)}}\" class=\"b-leaf-actions-checkbox\" autocomplete=\"off\" > <span class=\"b-leaf-actions-label-text\">{{html ($value.title || $data.title)}}</span> </label> {{else}} <a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" {{if ($value.name || $data.name) != \'permalink\'}} class=\"b-pseudo\" {{/if}} >{{html ($value.title || $data.title)}}</a>{{if ($value.ljusers || $data.ljusers)}}&nbsp;{{html ($value.ljusers || $data.ljusers)}}{{if ($value.moreusers || $data.moreusers)}}, &ellipsis;{{/if}}{{/if}} {{/if}} {{/if}} </li> {{/if}} {{/if}} {{/if}} {{/if}} {{/if}} {{/each}} <li class=\"b-leaf-actions-item b-leaf-actions-new\"><span class=\"b-thisisnew\">{{html LJ.mltext(\'talk.new\')}}</span></li> </ul> {{/if}} {{/if}} {{if $data.loaded}} {{if $data.controls}} <ul class=\"b-leaf-controls\"> {{each ($value.controls || $data.controls)}} {{if ($value.allowed || $data.allowed)}} {{if !($value.nocontrols || $data.nocontrols) || ($value.name || $data.name) == \'cancel_best\'}} <li class=\"b-leaf-controls-item b-leaf-controls-item-{{html ($value.name || $data.name)}}\"><a class=\" b-controls b-controls-{{html ($value.name || $data.name)}} \" title=\"{{html ($value.title || $data.title)}}\" href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" ><i class=\"b-controls-bg\"></i>{{html ($value.title || $data.title)}}</a></li> {{/if}} {{/if}} {{/each}} </ul> {{/if}} {{/if}} </div> </div> {{if $data.article}} <div class=\"b-leaf-article\"> {{html $data.article}} </div> {{/if}} <div class=\"b-leaf-footer\"> {{if $data.actions}} <ul class=\"b-leaf-actions b-leaf-footer-actions\"> {{each ($value.actions || $data.actions)}} {{if ($value.footer || $data.footer)}} {{if ($value.name || $data.name) != \'permalink\'}} {{if !($value.noid || $data.noid) || ($value.name || $data.name) != \'collapse\'}} {{if ($value.allowed || $data.allowed)}} {{if !($value.checkbox || $data.checkbox) || ($value.massactions || $data.massactions)}} <li class=\" b-leaf-actions-item b-leaf-actions-{{if ($value.checkbox || $data.checkbox)}}check{{else}}{{html ($value.name || $data.name)}}{{/if}} {{if ($value.noid || $data.noid) && ($value.name || $data.name) == \'reply\'}} b-leaf-actions-noid {{/if}} {{if ($value.active || $data.active)}} active {{/if}} \" data-tid=\"t{{html ($value.dtalkid || $data.dtalkid)}}\" > {{if ($value.disabled || $data.disabled)}} {{html ($value.title || $data.title)}} {{else}} {{if ($value.checkbox || $data.checkbox)}} <label class=\"b-leaf-actions-label\" > <input type=\"checkbox\" data-item-id=\"c{{html ($value.dtalkid || $data.dtalkid)}}\" name=\"selected_{{html ($value.talkid || $data.talkid)}}\" class=\"b-leaf-actions-checkbox\" autocomplete=\"off\" > <span class=\"b-leaf-actions-label-text\">{{html ($value.title || $data.title)}}</span> </label> {{else}} <a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" {{if ($value.name || $data.name) != \'permalink\'}} class=\"b-pseudo\" {{/if}} >{{html ($value.title || $data.title)}}</a>{{if ($value.ljusers || $data.ljusers)}}&nbsp;{{html ($value.ljusers || $data.ljusers)}}{{if ($value.moreusers || $data.moreusers)}}, &ellipsis;{{/if}}{{/if}} {{/if}} {{/if}} </li> {{/if}} {{/if}} {{/if}} {{/if}} {{/if}} {{/each}} <li class=\"b-leaf-actions-item b-leaf-actions-new\"> <span class=\"b-thisisnew\">{{html LJ.mltext(\'talk.new\')}}</span> </li> </ul> {{/if}} </div> </div> </div> {{/if}} {{/if}} {{/if}} </div> ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-Widgets-promocomment', "<div class=\"promocomment\"> {{if $data.promoAllowed}} <p class=\"promocomment-desc\">{{html LJ.mltext(\'talk.promo.place.desc\')}}<a href=\"{{html $data.siteroot}}/support/faq/424.html\" target=\"_blank\"><svg style=\"pointer-events: none; visibility: hidden;\" class=\"svgicon flaticon flaticon--helpicon\"><use xlink:href=\"#flaticon--helpicon\"/></svg></a></p> <p class=\"promocomment-buttons\"> <button type=\"button\" class=\" b-flatbutton b-flatbutton-simple promocomment-submit \" >{{html LJ.mltext(\'talk.promo.place.button\', \'tokens\', $data.tokens)}}</button> </p> {{else}} <p class=\"promocomment-desc\">{{html LJ.mltext(\'talk.promo.notokens.desc\', \'tokens\', $data.tokens)}}<a href=\"{{html $data.siteroot}}/support/faq/424.html\" target=\"_blank\"><svg style=\"pointer-events: none; visibility: hidden;\" class=\"svgicon flaticon flaticon--helpicon\"><use xlink:href=\"#flaticon--helpicon\"/></svg></a></p> <p class=\"promocomment-buttons\"> <a href=\"{{html $data.siteroot}}/shop/tokens.bml\" target=\"_blank\" class=\" b-flatbutton b-flatbutton-simple \" >{{html LJ.mltext(\'talk.promo.notokens.button\')}}</a> <small class=\"promocomment-small\">{{html LJ.mltext(\'talk.promo.notokens.window\')}}</small> </p> {{/if}} <button type=\"button\" class=\"promocomment-update\" title=\"{{html LJ.mltext(\'talk.promo.refresh\')}}\" >{{html LJ.mltext(\'talk.promo.refresh\')}}</button> </div> ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-Comments-v6-Comment', "<div class=\" mdspost-thread {{if $data.level}} mdspost-thread--level-{{html $data.level}} mdspost-thread--leveldeep-{{html $data.deepLevel}} {{/if}} \" style=\"margin-left: {{html $data.margin}}px\" data-tid=\"t{{html $data.dtalkid}}\" > {{if $data.html}} {{html $data.html}} {{else}} {{if $data.more}} <article class=\" mdspost-comment mdspost-comment--seemore {{if $data.moreclass}} mdspost-comment--{{html $data.moreclass}} {{/if}} \" data-thread=\"{{html $data.thread}}\" data-parent=\"{{html $data.parent}}\" data-dtalkids=\"{{html $data.data}}\" data-updated-ts=\"{{html $data.touched}}\" data-count=\"{{html $data.more}}\" > <div class=\" mdspost-comment__inner svgpreloader svgpreloader-pseudo svgpreloader-16 \" >{{each ($value.actions || $data.actions)}}<a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}javascript:void(0){{/if}}\" rel=\"nofollow\" class=\"mdspost-comment-seemore__more\" >{{html ($value.title || $data.title)}}</a>{{if ($value.ljusers || $data.ljusers)}}<span class=\"mdspost-comment-seemore__from\">{{html LJ.mltext(\'talk.from\')}}</span><span class=\"mdspost-comment-seemore__users\">{{each ($value.ljusers || $data.ljusers)}}<span class=\"mdspost-comment-seemore__user\">{{if ($value.anonymous || $data.anonymous)}}{{html LJ.mltext(\'talk.anonuser\')}}{{else}}{{if ($value.legacy || $data.legacy)}}{{html ($value.ljuser || $data.ljuser)}}{{else}}{{if ($value.amp || $data.amp)}}<span class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \">{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" class=\"i-ljuser-profile\" ><amp-img class=\"i-ljuser-userhead\" src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" width=\"16\" height=\"16\" ></amp-img></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" ><b>{{html ($value.journal || $data.journal)}}</b></a></span>{{else}}<span {{if ($value.inline_css || $data.inline_css)}} style=\" white-space:nowrap; {{if ($value.striked || $data.striked)}} text-decoration:line-through; {{/if}} \" {{/if}} class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \" {{html ($value.attrs || $data.attrs)}} data-ljuser=\"{{html ($value.username || $data.username)}}\" lj:user=\"{{html ($value.username || $data.username)}}\" >{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} class=\"i-ljuser-profile\" ><img {{if ($value.inline_css || $data.inline_css)}} width=\"16\" height=\"16\" style=\"vertical-align:text-bottom;border:0;padding-right:1px;\" {{else}} class=\"i-ljuser-userhead\" {{/if}} src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" /></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" {{if ($value.color || $data.color)}} style=\"color:{{html ($value.color || $data.color)}};\" {{/if}} {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} {{if ($value.alias || $data.alias)}} title=\"{{html ($value.user_alias || $data.user_alias)}}\" {{/if}} >{{if ($value.inline_css || $data.inline_css)}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.alias || $data.alias)}}<span class=\"useralias-value\">*</span>{{/if}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{else}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{/if}}</a>{{if ($value.alias || $data.alias) && ($value.side_alias || $data.side_alias)}}<span class=\"alias-value i-ljuser-alias\">{{html ($value.user_alias || $data.user_alias)}}</span>{{/if}}</span>{{/if}} {{/if}}{{/if}}</span>{{/each}}{{if ($value.moreusers || $data.moreusers)}}&hellip;{{/if}}</span>{{/if}}{{/each}}</div> </article> {{else}} {{if $data.deleted || !$data.shown}} <article {{if !($data.noid)}} id=\"t{{html $data.dtalkid}}\" {{/if}} class=\" mdspost-comment mdspost-comment--clipped {{if $data.leafclass}} mdspost-comment--{{html $data.leafclass}} {{/if}} \" > <div class=\"mdspost-comment__inner\"> <header class=\"mdspost-comment__header\"><div class=\"mdspost-comment-status\">{{if $data.leafclass == \'deleted\'}}{{html LJ.mltext(\'talk.deletedpost\')}}{{else $data.leafclass == \'screened\'}}{{html LJ.mltext(\'talk.screenedpost\')}}{{else $data.leafclass == \'spammed\'}}{{html LJ.mltext(\'talk.spammedpost\')}}{{else $data.leafclass == \'suspended\'}}{{html LJ.mltext(\'talk.suspendedpost\')}}{{/if}}</div></header> {{if $data.actions}} <footer class=\"mdspost-comment__footer\"> <ul class=\"mdspost-comment-actions\">{{each ($value.actions || $data.actions)}}{{if ($value.name || $data.name) != \'permalink\'}}{{if !($value.noid || $data.noid) || ($value.name || $data.name) != \'collapse\'}}{{if ($value.allowed || $data.allowed)}}{{if !($value.checkbox || $data.checkbox) || ($value.massactions || $data.massactions)}}<li class=\" mdspost-comment-actions__item {{if ($value.disabled || $data.disabled)}}js-action-disabled{{/if}} mdspost-comment-actions__item--{{if ($value.checkbox || $data.checkbox)}}check{{else}}{{html ($value.name || $data.name)}}{{/if}} {{if ($value.noid || $data.noid) && ($value.name || $data.name) == \'reply\'}} mdspost-comment-actions__item--noid {{/if}} {{if ($value.active || $data.active)}} mdspost-comment-actions__item--active {{/if}} \" data-tid=\"t{{html ($value.dtalkid || $data.dtalkid)}}\" >{{if ($value.disabled || $data.disabled)}}{{html ($value.title || $data.title)}}{{else}}{{if ($value.checkbox || $data.checkbox)}}<input type=\"checkbox\" data-item-id=\"c{{html ($value.dtalkid || $data.dtalkid)}}\" name=\"selected_{{html ($value.talkid || $data.talkid)}}\" class=\"mdspost-comment-actions__checkbox js-comment-checkbox\" autocomplete=\"off\" >{{else}}<a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" class=\"mdspost-comment-actions__link\" >{{html ($value.title || $data.title)}}</a>{{if ($value.ljusers || $data.ljusers)}}&nbsp;{{html ($value.ljusers || $data.ljusers)}}{{if ($value.moreusers || $data.moreusers)}}, &ellipsis;{{/if}}{{/if}}{{/if}}{{/if}}</li>{{/if}}{{/if}}{{/if}}{{/if}} {{/each}} <li class=\"mdspost-comment-actions__item mdspost-comment-actions__item--new\"> {{html LJ.mltext(\'post2017.comments.new-comment\')}} </li> </ul> </footer> {{/if}} </div> </article> {{else}} <article {{if !($data.noid)}} id=\"t{{html $data.dtalkid}}\" {{/if}} class=\" mdspost-comment {{if $data.leafclass}} mdspost-comment--{{html $data.leafclass}} {{/if}} {{if $data.suspended}} mdspost-comment--suspended {{/if}} {{if $data.tracked}} mdspost-comment--tracked {{/if}} {{if $data.subclass}} mdspost-comment--{{html $data.subclass}} {{/if}} {{if $data.p_tracked}} mdspost-comment--tracked-parent {{/if}} {{if $data.modereply}} mdspost-comment--modereply {{/if}} {{if $data.uname == $data.poster}} mdspost-comment--poster {{/if}} {{if $data.subject}} mdspost-comment--withsubject {{/if}} {{if $data.is_best}} mdspost-comment--best {{/if}} {{if $data.is_promo}} mdspost-comment--promo {{/if}} {{if $data.is_hatespeech}} mdspost-comment--collapsed mdspost-comment--hatespeech {{/if}} comment p-comment \" data-username=\"{{html $data.uname}}\" data-displayname=\"{{html $data.dname}}\" data-updated-ts=\"{{html $data.ctime_ts}}\" {{if $data.loaded}} data-full=\"1\" {{/if}} {{if $data.subject}} data-subject=\"{{html $data.subject}}\" {{/if}} ><div class=\"mdspost-comment__inner\"><header class=\"mdspost-comment__header\"><a href=\"{{html $data.commenter_journal_base}}\" target=\"_blank\" class=\"mdspost-comment-userpic\" >{{if $data.userpic}}<span class=\"mdspost-comment-userpic__pic\" {{if !($data.amp)}} lj:user=\"{{html $data.uname}}\" {{/if}} >{{if $data.amp}} <amp-img src=\"{{html $data.userpic}}\" width=\"32\" height=\"32\" alt=\"{{html $data.uname}}\" class=\"mdspost-comment-userpic__img ContextualPopup\" {{if $data.upictitle}}title=\"{{html $data.upictitle}}\"{{/if}} /> {{else}} <img src=\"{{html $data.userpic}}\" alt=\"{{html $data.uname}}\" loading=\"lazy\" class=\"mdspost-comment-userpic__img ContextualPopup\" {{if $data.upictitle}}title=\"{{html $data.upictitle}}\" {{/if}} > {{/if}}</span>{{else}}<span class=\"mdspost-comment-userpic__pic\" {{if !($data.amp)}} lj:user=\"{{html $data.uname}}\" {{/if}} >{{if $data.amp}} <amp-img src=\"{{html $data.lj_statprefix}}{{if $data.username}}/img/userpics/userpic-user.png?v=15821{{else}}/img/userpics/userpic-anonymous.png?v=15821{{/if}}\" width=\"32\" height=\"32\" alt=\"{{html $data.uname}}\" class=\"mdspost-comment-userpic__img ContextualPopup\"/> {{else}} <img src=\"{{html $data.lj_statprefix}}{{if $data.username}}/img/userpics/userpic-user.png?v=15821{{else}}/img/userpics/userpic-anonymous.png?v=15821{{/if}}\" alt=\"{{html $data.uname}}\" loading=\"lazy\" class=\"mdspost-comment-userpic__img ContextualPopup\"> {{/if}}</span>{{/if}}</a><div class=\"mdspost-comment-details\">{{if $data.shown}}<p class=\"mdspost-comment-username\"><span class=\"mdspost-comment-username__name\">{{if $data.username}}{{if $data.deleted_poster}}{{html $data.deleted_poster}}{{else}}{{each ($value.username || $data.username)}}{{if ($value.legacy || $data.legacy)}}{{html ($value.ljuser || $data.ljuser)}}{{else}}{{if ($value.amp || $data.amp)}}<span class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \">{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" class=\"i-ljuser-profile\" ><amp-img class=\"i-ljuser-userhead\" src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" width=\"16\" height=\"16\" ></amp-img></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" ><b>{{html ($value.journal || $data.journal)}}</b></a></span>{{else}}<span {{if ($value.inline_css || $data.inline_css)}} style=\" white-space:nowrap; {{if ($value.striked || $data.striked)}} text-decoration:line-through; {{/if}} \" {{/if}} class=\"ljuser {{if !(($value.inline_css || $data.inline_css))}} i-ljuser {{if ($value.striked || $data.striked)}} i-ljuser-deleted {{/if}} i-ljuser-type-{{html ($value.journaltype || $data.journaltype)}} {{/if}} {{if ($value.noctxpopup || $data.noctxpopup)}} noctxpopup i-ljuser-nopopup {{/if}} {{if ($value.alias || $data.alias)}} with-alias i-ljuser-withalias {{/if}} {{if ($value.side_alias || $data.side_alias)}} with-alias-value i-ljuser-showalias {{/if}} \" {{html ($value.attrs || $data.attrs)}} data-ljuser=\"{{html ($value.username || $data.username)}}\" lj:user=\"{{html ($value.username || $data.username)}}\" >{{if ($value.show_userhead || $data.show_userhead)}}<a href=\"{{html ($value.profile_url || $data.profile_url)}}\" {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} class=\"i-ljuser-profile\" ><img {{if ($value.inline_css || $data.inline_css)}} width=\"16\" height=\"16\" style=\"vertical-align:text-bottom;border:0;padding-right:1px;\" {{else}} class=\"i-ljuser-userhead\" {{/if}} src=\"{{html ($value.userhead_url || $data.userhead_url)}}\" /></a>{{/if}}<a href=\"{{html ($value.journal_url || $data.journal_url)}}\" class=\"i-ljuser-username\" {{if ($value.color || $data.color)}} style=\"color:{{html ($value.color || $data.color)}};\" {{/if}} {{if ($value.target || $data.target)}} target=\"{{html ($value.target || $data.target)}}\" {{/if}} {{if ($value.alias || $data.alias)}} title=\"{{html ($value.user_alias || $data.user_alias)}}\" {{/if}} >{{if ($value.inline_css || $data.inline_css)}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.alias || $data.alias)}}<span class=\"useralias-value\">*</span>{{/if}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{else}}{{if ($value.bold || $data.bold)}}<b>{{/if}}{{html ($value.journal || $data.journal)}}{{if ($value.bold || $data.bold)}}</b>{{/if}}{{/if}}</a>{{if ($value.alias || $data.alias) && ($value.side_alias || $data.side_alias)}}<span class=\"alias-value i-ljuser-alias\">{{html ($value.user_alias || $data.user_alias)}}</span>{{/if}}</span>{{/if}} {{/if}}{{/each}}{{/if}}{{else}}{{html LJ.mltext(\'talk.anonuser\')}}{{/if}}</span>{{if $data.ipaddr}}<span class=\"mdspost-comment-username__ipaddr\">{{html $data.ipaddr}}</span>{{/if}}</p><p class=\" mdspost-comment-meta {{if $data.etime}} mdspost-comment-meta--edited {{/if}} \" >{{if $data.ctime}}<a href=\"{{html $data.thread_url}}\" class=\"mdspost-comment-time mdspost-comment-time--ctime\" >{{html $data.ctime}}</a>{{/if}}{{if $data.stime}}<time class=\"mdspost-comment-time mdspost-comment-time--shorttime\">{{html $data.stime}}</time>{{/if}}{{if $data.etime}}<time class=\"mdspost-comment-time mdspost-comment-time--editedtime\">{{html LJ.mltext(\'talk.edited\')}}&nbsp;{{html $data.etime}}</time>{{/if}}</p>{{/if}}{{if $data.loaded}}{{if $data.controls && !$data.amp}}<ul class=\"mdspost-comment-controls\">{{each ($value.controls || $data.controls)}}{{if ($value.allowed || $data.allowed)}}{{if !($value.nocontrols || $data.nocontrols) || ($value.name || $data.name) == \'cancel_best\'}}<li class=\" mdspost-comment-controls__item mdspost-comment-controls__item--{{html ($value.name || $data.name)}}\" >{{if ($value.checkbox || $data.checkbox)}}<input type=\"checkbox\" data-item-id=\"c{{html ($value.dtalkid || $data.dtalkid)}}\" name=\"selected_{{html ($value.talkid || $data.talkid)}}\" class=\"mdspost-comment-controls__checkbox js-comment-checkbox\" autocomplete=\"off\" >{{else}}<a class=\" mdspost-comment-controls__button mdspost-comment-controls__button--{{html ($value.name || $data.name)}} \" title=\"{{html ($value.title || $data.title)}}\" href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}javascript:void(0){{/if}}\" rel=\"nofollow\" >{{if ($value.name || $data.name) == \'delete\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"30\" viewBox=\"0 0 24 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"24\" version=\"1.1\" viewBox=\"0 0 24 30\" y=\"0\"><path id=\"delete_repost-Shape\" d=\"m-3.6637e-14 10h23.863v-0.5514c0-1.3171-1.336-4.0827-2.983-4.0827h-17.897c-1.6466 0-2.983 2.7656-2.983 4.0827l-3.6637e-14 0.5514zm2.3068 18.178c0.0981 1.002 1.0739 1.822 2.1689 1.822h14.914c1.095 0 2.071-0.82 2.169-1.822l1.441-16.178h-22l1.3068 16.178zm7.2608-2.178h-2.7437l-0.9145-11.056h3.6582v11.056zm4.7654 0v-11.056h3.658l-0.915 11.056h-2.743zm4.667-20.634c0-2.1601-0.861-5.3659-2.794-5.3659h-8.3819c-1.9332 0-2.794 3.2058-2.794 5.3659h13.97zm-11.378 0l0.6904-2.8148 7.1524 0.0155 0.697 2.7993h-8.5398z\"/></svg></svg>{{else ($value.name || $data.name) == \'spam\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 30\" y=\"0\"><path d=\"m15 30c-8.2843 0-15-6.716-15-15 0-8.2843 6.7157-15 15-15 8.284 0 15 6.7157 15 15 0 8.284-6.716 15-15 15zm0-4c6.075 0 11-4.925 11-11 0-6.0751-4.925-11-11-11-6.0751 0-11 4.9249-11 11 0 6.075 4.9249 11 11 11z\"/><path d=\"m4.5858 7.4142l18.111 18.111 1.414 1.414 2.828-2.828-1.414-1.414-18.111-18.111-1.414-1.4144-2.8284 2.8284 1.4142 1.4142z\"/></svg></svg>{{else ($value.name || $data.name) == \'unspam\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 30\" y=\"0\"><path d=\"m15 30c-8.2843 0-15-6.716-15-15 0-8.2843 6.7157-15 15-15 8.284 0 15 6.7157 15 15 0 8.284-6.716 15-15 15zm0-4c6.075 0 11-4.925 11-11 0-6.0751-4.925-11-11-11-6.0751 0-11 4.9249-11 11 0 6.075 4.9249 11 11 11z\"/><path d=\"m4.5858 7.4142l18.111 18.111 1.414 1.414 2.828-2.828-1.414-1.414-18.111-18.111-1.414-1.4144-2.8284 2.8284 1.4142 1.4142z\"/><path fill=\"#F73C32\" d=\"m28.981 2.5514c0.581-0.5909 0.572-1.5406-0.018-2.1212-0.591-0.58071-1.541-0.57246-2.122 0.0184l-26.411 26.874c-0.58051 0.591-0.57226 1.54 0.0186 2.121 0.5909 0.581 1.5406 0.573 2.1212-0.018l26.411-26.875v0.0004z\"/></svg></svg>{{else ($value.name || $data.name) == \'freeze\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"29\" viewBox=\"0 0 30 29\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"29\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 29\" y=\"0\"><path d=\"m20.777 9.9048l-4.872 2.8132v-5.3831l4.978-4.9786c0.419-0.4186 0.419-1.0974 0-1.516-0.418-0.41869-1.097-0.41869-1.516-0.00004l-3.462 3.4625v-3.2308c0-0.59204-0.48-1.072-1.072-1.072s-1.072 0.47996-1.072 1.072v3.2308l-3.463-3.4625c-0.4185-0.41869-1.0973-0.41869-1.5159-0.00004-0.4187 0.41864-0.4187 1.0974 0 1.516l4.9789 4.9786v5.3111l-4.5383-2.62-1.8223-6.8004c-0.1533-0.5719-0.7411-0.9113-1.313-0.7581-0.5719 0.1533-0.9113 0.7411-0.758 1.313l1.2674 4.7299-2.798-1.6154c-0.5127-0.296-1.1683-0.1203-1.4644 0.3924-0.296 0.5127-0.1203 1.1684 0.3924 1.4644l2.7979 1.6152-4.7299 1.268c-0.57186 0.153-0.91124 0.741-0.75801 1.313 0.15324 0.571 0.74107 0.911 1.313 0.758l6.8008-1.823 4.6004 2.656-4.5384 2.62-6.8009-1.822c-0.5719-0.153-1.1597 0.186-1.313 0.758-0.1532 0.572 0.18618 1.16 0.75807 1.313l4.7299 1.267-2.798 1.616c-0.5127 0.296-0.6884 0.951-0.3923 1.464 0.296 0.513 0.9516 0.688 1.4644 0.392l2.7979-1.615-1.2674 4.73c-0.1532 0.572 0.1862 1.16 0.7581 1.313 0.5718 0.153 1.1597-0.186 1.3129-0.758l1.8223-6.801 4.4764-2.584v5.411l-4.9789 4.979c-0.4187 0.419-0.4187 1.097 0 1.516 0.4186 0.419 1.0974 0.419 1.5159 0l3.463-3.462v2.989c0 0.592 0.48 1.072 1.072 1.072s1.072-0.48 1.072-1.072v-2.989l3.462 3.462c0.419 0.419 1.098 0.419 1.516 0 0.419-0.419 0.419-1.097 0-1.516l-4.978-4.979v-5.483l4.81 2.778 1.823 6.8c0.153 0.572 0.741 0.912 1.313 0.758 0.572-0.153 0.911-0.741 0.758-1.313l-1.268-4.729 2.589 1.494c0.513 0.296 1.169 0.121 1.465-0.392s0.12-1.168-0.393-1.464l-2.589-1.495 4.73-1.268c0.572-0.153 0.912-0.741 0.758-1.313-0.153-0.571-0.741-0.911-1.313-0.758l-6.801 1.823-4.748-2.742 4.81-2.777 6.801 1.822c0.572 0.153 1.16-0.186 1.313-0.758s-0.186-1.16-0.758-1.313l-4.73-1.267 2.589-1.4953c0.513-0.296 0.689-0.9516 0.393-1.4644-0.296-0.5127-0.952-0.6884-1.465-0.3924l-2.589 1.4948 1.268-4.7299c0.153-0.5719-0.187-1.1597-0.758-1.3129-0.572-0.1533-1.16 0.1861-1.313 0.758l-1.823 6.8009z\"/></svg></svg>{{else ($value.name || $data.name) == \'unfreeze\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 30\" y=\"0\"><path d=\"m10.223 9.9048l4.872 2.8132v-5.3831l-4.978-4.9786c-0.419-0.4186-0.419-1.0974 0-1.516 0.418-0.41869 1.097-0.41869 1.516-0.00004l3.462 3.4625v-3.2308c0-0.59204 0.48-1.072 1.072-1.072s1.072 0.47996 1.072 1.072v3.2308l3.463-3.4625c0.419-0.41869 1.097-0.41869 1.516-0.00004 0.419 0.41864 0.419 1.0974 0 1.516l-4.979 4.9786v5.3111l4.538-2.62 1.823-6.8004c0.153-0.5719 0.741-0.9113 1.313-0.7581 0.571 0.1533 0.911 0.7411 0.758 1.313l-1.268 4.7299 2.798-1.6154c0.513-0.296 1.169-0.1203 1.465 0.3924s0.12 1.1684-0.393 1.4644l-2.798 1.6152 4.73 1.268c0.572 0.153 0.911 0.741 0.758 1.313-0.153 0.571-0.741 0.911-1.313 0.758l-6.801-1.823-4.6 2.656 4.538 2.62 6.801-1.822c0.572-0.153 1.16 0.186 1.313 0.758 0.154 0.572-0.186 1.16-0.758 1.313l-4.73 1.267 2.798 1.616c0.513 0.296 0.689 0.951 0.393 1.464s-0.952 0.688-1.465 0.392l-2.798-1.615 1.268 4.73c0.153 0.572-0.186 1.16-0.758 1.313s-1.16-0.186-1.313-0.758l-1.823-6.801-4.476-2.584v5.411l4.979 4.979c0.419 0.419 0.419 1.097 0 1.516s-1.097 0.419-1.516 0l-3.463-3.462v2.989c0 0.592-0.48 1.072-1.072 1.072s-1.072-0.48-1.072-1.072v-2.989l-3.462 3.462c-0.419 0.419-1.098 0.419-1.516 0-0.419-0.419-0.419-1.097 0-1.516l4.978-4.979v-5.483l-4.81 2.778-1.8227 6.8c-0.1532 0.572-0.7411 0.912-1.3129 0.758-0.5719-0.153-0.9113-0.741-0.7581-1.313l1.2674-4.729-2.589 1.494c-0.5128 0.296-1.1684 0.121-1.4644-0.392-0.2961-0.513-0.1204-1.168 0.3923-1.464l2.5891-1.495-4.7299-1.268c-0.5719-0.153-0.9113-0.741-0.7581-1.313 0.1533-0.571 0.7411-0.911 1.313-0.758l6.8009 1.823 4.7484-2.742-4.8104-2.777-6.8008 1.822c-0.5719 0.153-1.1598-0.186-1.313-0.758-0.15324-0.572 0.1861-1.16 0.758-1.313l4.7299-1.267-2.589-1.4953c-0.5127-0.296-0.6884-0.9516-0.3924-1.4644 0.296-0.5127 0.9517-0.6884 1.4644-0.3924l2.5891 1.4948-1.2674-4.7299c-0.1533-0.5719 0.1861-1.1597 0.758-1.3129 0.5719-0.1533 1.1597 0.1861 1.313 0.758l1.8226 6.8009z\"/><path fill=\"#F73C32\" d=\"m29.961 0.43016c-0.59-0.58067-1.54-0.57242-2.121 0.01844l-26.41 26.874c-0.5805 0.591-0.57225 1.54 0.0186 2.121 0.5908 0.581 1.5405 0.573 2.1211-0.018l26.41-26.875c0.581-0.5905 0.572-1.5402-0.019-2.1208v-0.00004z\"/></svg></svg>{{else ($value.name || $data.name) == \'screen\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 30\" y=\"0\"><path d=\"m29.96 12.991c-0.545-2.315-5.2-4.6524-14.753-4.6524-9.1548 0-13.616 2.3384-14.138 4.6524-0.49708 2.209 1.4287 12.963 14.138 12.963 13.263 0 15.271-10.754 14.753-12.963zm-15.065-1.92c-0.626 0.718-1.019 1.652-1.019 2.688 0 1.035 0.393 1.97 1.019 2.688-2.056-0.11-3.68-1.265-3.68-2.688 0-1.424 1.625-2.579 3.68-2.688zm0.312 12.174c-10.431 0-11.232-8.06-11.975-9.383-0.7421-1.322 2.2338-1.167 5.5889-1.998-0.1713 0.601-0.2671 1.236-0.2671 1.894 0 3.741 2.9792 6.776 6.6532 6.776 3.673 0 6.652-3.035 6.652-6.776 0-0.66-0.102-1.293-0.276-1.897 3.359 0.831 6.599 2 6.599 2s-2.544 9.384-12.975 9.384zm0.282-17.845c6.576 0.6967 9.212 1.4551 9.381 1.5162 0.502 0.1822 1.057-0.0774 1.24-0.5798 0.182-0.5024-0.078-1.0575-0.58-1.2397-0.049-0.0178-5.021-2.0967-10.041-2.0967-5.021 0-9.992 2.0789-10.041 2.0967-0.5026 0.1822-0.7622 0.7373-0.58 1.2397s0.7372 0.762 1.2397 0.5798c0.1686-0.0611 2.8051-1.2065 9.3813-1.5162z\"/><path fill=\"#F73C32\" d=\"m29.981 2.5514c0.581-0.5909 0.572-1.5406-0.018-2.1212-0.591-0.58071-1.541-0.57246-2.122 0.0184l-26.411 26.874c-0.58051 0.591-0.57226 1.54 0.0186 2.121 0.5909 0.581 1.5406 0.573 2.1212-0.018l26.411-26.875v0.0004z\"/></svg></svg>{{else ($value.name || $data.name) == \'unscreen\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"29\" height=\"23\" viewBox=\"0 0 29 23\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"23\" width=\"29\" version=\"1.1\" viewBox=\"0 0 29 23\" y=\"0\"><path d=\"m28.96 9.9905c-0.545-2.3148-5.2-4.6519-14.753-4.6519-9.1548 0-13.616 2.3381-14.138 4.6519-0.49708 2.2095 1.4287 12.964 14.138 12.964 13.263 0 15.271-10.754 14.753-12.964v0.0005zm-15.065-1.92c-0.626 0.7181-1.019 1.6529-1.019 2.6885 0 1.035 0.393 1.97 1.019 2.688-2.056-0.11-3.68-1.265-3.68-2.688 0-1.4236 1.625-2.5791 3.68-2.6885zm0.312 12.174c-10.431 0-11.232-8.06-11.975-9.383-0.7421-1.3225 2.2338-1.1666 5.5889-1.9979-0.1713 0.601-0.2671 1.2359-0.2671 1.8939 0 3.741 2.9792 6.776 6.6532 6.776 3.673 0 6.652-3.035 6.652-6.776 0-0.66-0.102-1.2929-0.276-1.8968 3.359 0.8313 6.599 1.9998 6.599 1.9998s-2.544 9.384-12.975 9.384zm0.282-17.845c6.576 0.6967 9.212 1.4551 9.381 1.5162 0.502 0.1822 1.057-0.0774 1.24-0.5798 0.182-0.5024-0.078-1.0575-0.58-1.2397-0.049-0.0178-5.021-2.0967-10.041-2.0967-5.0207-1.4337e-8 -9.992 2.0789-10.041 2.0967-0.5026 0.1822-0.7622 0.7373-0.58 1.2397s0.7372 0.762 1.2397 0.5798c0.1686-0.0611 2.8051-1.2065 9.3813-1.5162z\"/></svg></svg>{{else ($value.name || $data.name) == \'track\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 30\" y=\"0\"><path d=\"m12.385 24.568c0.344 4.024 2.124 2.119 4.078 0.163 1.001-1.001 2.115-2.14 3.246-3.303l7.678 7.683 2.613 0.889-0.862-2.641-7.703-7.707c1.437-1.481 2.827-2.91 3.962-4.048 1.461-1.461 2.482-2.893-0.377-3.373-1.471-0.246-3.478-0.186-4.754-0.108l-5.487-5.4903c0.153-1.3626 0.29-3.2732 0.062-4.6279-0.48-2.8599-2.257-2.2292-3.718-0.7679-2.4768 2.4786-6.3304 6.1478-9.1207 8.9411-1.9535 1.955-3.5112 4.126 0.5103 4.47 1.1233 0.096 2.6398-0.033 3.8977-0.189l6.0617 6.065c-0.105 1.238-0.191 2.832-0.087 4.044z\"/></svg></svg>{{else ($value.name || $data.name) == \'untrack\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 30\" y=\"0\"><path d=\"m13.385 24.568c0.344 4.024 2.124 2.119 4.078 0.163 1.001-1.001 2.115-2.14 3.246-3.303l7.678 7.683 2.613 0.889-0.862-2.641-7.703-7.707c1.437-1.481 2.827-2.91 3.962-4.048 1.461-1.461 2.482-2.893-0.377-3.373-1.471-0.246-3.478-0.186-4.754-0.108l-5.487-5.4903c0.153-1.3626 0.29-3.2732 0.062-4.6279-0.48-2.8599-2.257-2.2292-3.718-0.7679-2.4768 2.4786-6.3304 6.1478-9.1207 8.9411-1.9535 1.955-3.5112 4.126 0.5103 4.47 1.1233 0.096 2.6398-0.033 3.8977-0.189l6.0617 6.065c-0.105 1.238-0.191 2.832-0.087 4.044z\"/><path fill=\"#F73C32\" d=\"m29.981 2.5514c0.581-0.5909 0.572-1.5406-0.018-2.1212-0.591-0.58071-1.541-0.57246-2.122 0.0184l-26.411 26.874c-0.58051 0.591-0.57226 1.54 0.0186 2.121 0.5909 0.581 1.5406 0.573 2.1212-0.018l26.411-26.875v0.0004z\"/></svg></svg>{{else ($value.name || $data.name) == \'edit\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"28\" height=\"30\" viewBox=\"0 0 28 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"28\" version=\"1.1\" viewBox=\"0 0 28 30\" y=\"0\"><path d=\"m10.451-1.7764e-15l17.517 18.681v11.238l-10.571 0.081-17.397-18.552 0.0055967-0.851 1e-7 -1.3202 8.5789-9.1847 0.8903 0.000031 0.9762-0.092131v-1.7764e-15zm-4.9484 12.993l6.8994-6.9702-3.0204-3.2418-6.8928 7.0502 3.0138 3.1618zm12.851 14.444l6.601-0.494 0.526-6.728-7.127 7.222z\"/></svg></svg>{{else ($value.name || $data.name) == \'best\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" xml:space=\"preserve\" height=\"30\" viewBox=\"0 0 30 30\" width=\"30\" version=\"1.1\" y=\"0\" x=\"0px\" enable-background=\"new 0 0 30 30\"><path d=\"m29.951 11.514c-0.162-0.507-0.559-0.614-1.27-0.614h-9.711s-0.005-0.002-0.007-0.004h0.007s-2.708-8.451-3.001-9.363c-0.219-0.683-0.443-1.033-0.968-1.033s-0.746 0.338-0.968 1.033c-0.303 0.943-3.002 9.363-3.002 9.363h0.004l-0.004 0.004h-9.713c-0.708 0-1.107 0.107-1.27 0.614-0.162 0.506 0.087 0.823 0.671 1.253 0.791 0.583 7.858 5.788 7.858 5.788s-2.708 8.451-3 9.362c-0.219 0.685-0.241 1.1 0.185 1.414 0.426 0.313 0.8 0.171 1.382-0.26 0.792-0.583 7.857-5.788 7.857-5.788s7.067 5.205 7.858 5.788c0.582 0.429 0.959 0.573 1.383 0.26 0.426-0.312 0.403-0.729 0.185-1.414-0.292-0.911-3.003-9.362-3.003-9.362s7.068-5.205 7.859-5.788c0.58-0.43 0.83-0.747 0.668-1.253z\"/></svg></svg>{{else ($value.name || $data.name) == \'cancel_best\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" xml:space=\"preserve\" height=\"30\" viewBox=\"0 0 30 30\" width=\"30\" version=\"1.1\" y=\"0\" x=\"0px\" enable-background=\"new 0 0 30 30\"><path d=\"m29.951 11.514c-0.162-0.507-0.559-0.614-1.27-0.614h-9.711s-0.005-0.002-0.007-0.004h0.007s-2.708-8.451-3.001-9.363c-0.219-0.683-0.443-1.033-0.968-1.033s-0.746 0.338-0.968 1.033c-0.303 0.943-3.002 9.363-3.002 9.363h0.004l-0.004 0.004h-9.713c-0.708 0-1.107 0.107-1.27 0.614-0.162 0.506 0.087 0.823 0.671 1.253 0.791 0.583 7.858 5.788 7.858 5.788s-2.708 8.451-3 9.362c-0.219 0.685-0.241 1.1 0.185 1.414 0.426 0.313 0.8 0.171 1.382-0.26 0.792-0.583 7.857-5.788 7.857-5.788s7.067 5.205 7.858 5.788c0.582 0.429 0.959 0.573 1.383 0.26 0.426-0.312 0.403-0.729 0.185-1.414-0.292-0.911-3.003-9.362-3.003-9.362s7.068-5.205 7.859-5.788c0.58-0.43 0.83-0.747 0.668-1.253z\"/><path d=\"m28.98 2.551c0.581-0.591 0.573-1.541-0.018-2.121-0.592-0.581-1.541-0.572-2.121 0.019l-26.411 26.873c-0.581 0.592-0.572 1.541 0.019 2.122s1.541 0.572 2.121-0.019l26.41-26.874z\" fill=\"#F73C32\"/></svg></svg>{{else ($value.name || $data.name) == \'contentflag\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 30 30\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"30\" width=\"30\" version=\"1.1\" viewBox=\"0 0 30 30\" y=\"0\"><path d=\"m15 30c-8.2843 0-15-6.716-15-15 0-8.2843 6.7157-15 15-15 8.284 0 15 6.7157 15 15 0 8.284-6.716 15-15 15zm0-4c6.075 0 11-4.925 11-11 0-6.0751-4.925-11-11-11-6.0751 0-11 4.9249-11 11 0 6.075 4.9249 11 11 11z\"/><path d=\"m4.5858 7.4142l18.111 18.111 1.414 1.414 2.828-2.828-1.414-1.414-18.111-18.111-1.414-1.4144-2.8284 2.8284 1.4142 1.4142z\"/></svg></svg>{{else ($value.name || $data.name) == \'embed\'}}<svg class=\"mdspost-comment-controls__svg\" xmlns=\"http://www.w3.org/2000/svg\" width=\"30\" height=\"30\" viewBox=\"0 0 16 10\"><svg xmlns:xlink=\"http://www.w3.org/1999/xlink\" height=\"10\" width=\"16\" version=\"1.1\" viewBox=\"0 0 16 10\" y=\"0\"><path d=\"M5.142 10c-.218 0-.438-.08-.606-.244L.25 5.59c-.334-.326-.334-.855 0-1.178L4.537.244c.335-.325.876-.325 1.212 0 .335.325.335.854 0 1.178L2.068 5l3.68 3.578c.336.325.336.853 0 1.177-.167.164-.387.245-.606.245zm5.716 0c-.22 0-.44-.08-.607-.245-.334-.324-.334-.852 0-1.177L13.93 5l-3.678-3.578c-.335-.324-.335-.853 0-1.178.336-.325.877-.325 1.212 0l4.285 4.168c.334.323.334.852 0 1.178l-4.286 4.166c-.168.164-.388.244-.606.244z\" fill-rule=\"evenodd\"></path></svg></svg>{{/if}}</a>{{/if}}</li>{{/if}}{{/if}}{{/each}}</ul> {{/if}}{{/if}}{{if $data.is_best}}<span class=\"mdspost-comment-best-marker\" title=\"{{html LJ.mltext(\"talk.comment.best\")}}\"><span class=\"visuallyhidden\">{{html LJ.mltext(\'talk.comment.best\')}}</span> </span>{{/if}} {{if $data.is_hatespeech}} <p class=\"mdspost-comment__status mdspost-comment-status\"> {{html LJ.mltext(\'talk.hatespeechpost\')}} </p> {{/if}} </div></header>{{if $data.article}}<div class=\"mdspost-comment__body\">{{if $data.subject}}<h4 class=\"mdspost-comment__subject\">{{html $data.subject}} </h4>{{/if}}{{html $data.article}}</div>{{/if}}{{if $data.actions && !$data.amp}}<footer class=\"mdspost-comment__footer\"><ul class=\" mdspost-comment-actions svgpreloader svgpreloader-pseudo svgpreloader-16 \" >{{each ($value.actions || $data.actions)}}{{if ($value.name || $data.name) != \'permalink\'}}{{if !($value.noid || $data.noid) || ($value.name || $data.name) != \'collapse\'}}{{if ($value.allowed || $data.allowed)}}{{if !($value.checkbox || $data.checkbox) || ($value.massactions || $data.massactions)}}<li class=\" mdspost-comment-actions__item {{if ($value.disabled || $data.disabled)}}js-action-disabled{{/if}} mdspost-comment-actions__item--{{if ($value.checkbox || $data.checkbox)}}check{{else}}{{html ($value.name || $data.name)}}{{/if}} {{if ($value.noid || $data.noid) && ($value.name || $data.name) == \'reply\'}} mdspost-comment-actions__item--noid {{/if}} {{if ($value.active || $data.active)}} mdspost-comment-actions__item--active {{/if}} \" data-tid=\"t{{html ($value.dtalkid || $data.dtalkid)}}\" >{{if ($value.disabled || $data.disabled)}}{{html ($value.title || $data.title)}}{{else}}{{if ($value.checkbox || $data.checkbox)}}<input type=\"checkbox\" data-item-id=\"c{{html ($value.dtalkid || $data.dtalkid)}}\" name=\"selected_{{html ($value.talkid || $data.talkid)}}\" class=\"mdspost-comment-actions__checkbox js-comment-checkbox\" autocomplete=\"off\" >{{else}}<a href=\"{{if ($value.href || $data.href)}}{{html ($value.href || $data.href)}}{{else}}#{{/if}}\" rel=\"nofollow\" class=\"mdspost-comment-actions__link\" >{{html ($value.title || $data.title)}}</a>{{if ($value.ljusers || $data.ljusers)}}&nbsp;{{html ($value.ljusers || $data.ljusers)}}{{if ($value.moreusers || $data.moreusers)}}, &ellipsis;{{/if}}{{/if}}{{/if}}{{/if}}</li>{{/if}}{{/if}}{{/if}}{{/if}} {{/each}} <li class=\"mdspost-comment-actions__item mdspost-comment-actions__item--new\"> {{html LJ.mltext(\'post2017.comments.new-comment\')}} </li> </ul></footer>{{/if}}</div></article> {{/if}} {{/if}} {{/if}} </div> ", 'JQuery.stat');
//= require js/misc/newCommentsCounter.js
//= require_ml comments.warning.offline
!function(e,t){"use strict";var o,n=LJ.Util.getWindow(),a=LJ.Util.getDocument(),s=function(){function e(e){var o=l[e];if(o){if(t(e))return!0;s(e)}return!1}function t(e){var t=new Date,o=m[e];return 1e3*c>t-o}function o(){for(var e;r.length>d;)e=r[0],s(e)}function n(t,n){e(t)||(n?(l[t]=n,m[t]=new Date,r.push(t),o()):p._fetchThread(t,function(e){l[t]=e,m[t]=new Date,r.push(t),o()}))}function a(t){return e(t)?l[t]:null}function s(e){l[e]&&(delete l[e],delete m[e],r=r.filter(function(t){return t!==e}))}function i(e,t){p=e}var r=[],l={},m={},c=180,d=10,p=null;return{init:i,add:n,remove:s,get:a,isCached:e}}(),i=!!LJ.get("is_post"),r=LJ.Util.isMediusJournal(),l=function(e,t){var o=t.isPost2017ViewPage,n=t.isMediusJournal;return"commentActions"===e?n?".mdspost-comment-actions":".b-leaf-footer-actions":"spamCounter"===e?o?".js-spamcount":".b-xylem-cell-spam .js-amount":"replyCounter"===e?o?".js-replycount":n?".mdspost-comments-controls__count .js-amount":".b-xylem-cell-amount .js-amount":""},m=function(e,t){var o=t.isPost2017ViewPage,n=t.isMediusJournal;return"showSpam"===e?o?"mdspost-comments--showspam":"b-grove-showspam":"actionItem"===e?n?"mdspost-comment-actions__item":"b-leaf-actions-item":""};e.widget("lj.comments",e.lj.basicWidget,{options:{selectors:{linkCollapse:LJ.Util.isMediusJournal()?".mdspost-comment-actions__item--collapse a":".b-leaf-actions-collapse a",linkExpand:LJ.Util.isMediusJournal()?".mdspost-comment-actions__item--expand a":".b-leaf-actions-expand a",linkExpandChildren:LJ.Util.isMediusJournal()?".mdspost-comment-actions__item--expandchilds a":".b-leaf-actions-expandchilds a",linkPromote:LJ.Util.isMediusJournal()?".mdspost-comment-actions__item--promote a":".b-leaf-actions-promote a",linkUnpromote:LJ.Util.isMediusJournal()?".mdspost-comment-actions__item--cancel_promo a":".b-leaf-actions-cancel_promo a",leafMore:LJ.Util.isMediusJournal()?".mdspost-comment--seemore":".b-leaf-seemore",seeMore:LJ.Util.isMediusJournal()?".mdspost-comment-seemore__more":".b-leaf-seemore-more a, .b-leaf-seemore-expand a",commentDeleted:LJ.Util.isMediusJournal()?".mdspost-comment--deleted":".b-leaf-deleted",commentBest:LJ.Util.isMediusJournal()?".mdspost-comment--best":".b-leaf-best",leaf:LJ.Util.isMediusJournal()?".mdspost-comment":".b-leaf",leafCollapsed:LJ.Util.isMediusJournal()?".mdspost-comment--collapsed":".b-leaf-collapsed",leafFull:LJ.Util.isMediusJournal()?".mdspost-comment--full":".b-leaf-full",tree:".b-tree-root",twig:LJ.Util.isMediusJournal()?".mdspost-thread":".b-tree-twig",pager:".b-pager",replyCounter:l("replyCounter",{isPost2017ViewPage:i,isMediusJournal:r}),spamCounter:l("spamCounter",{isPost2017ViewPage:i}),commentsJSON:"#comments_json",title:"title",metaDescription:"meta[name=description]",actionsItem:LJ.Util.isMediusJournal()?".mdspost-comment-actions__item":".b-leaf-actions-item",treeStart:LJ.Util.isMediusJournal()?".mdscomments-list--":".b-tree-",promoPrice:LJ.Util.isMediusJournal()?".mdscomments-list--promo":".b-tree-promo"},classNames:{groveLoading:"b-grove-loading",newComment:"b-leaf-new",commentScreened:"".concat(LJ.Util.isMediusJournal()?"mdspost-comment--":"b-leaf-","screened"),leafCollapsed:LJ.Util.isMediusJournal()?"mdspost-comment--collapsed":"b-leaf-collapsed",leafFull:LJ.Util.isMediusJournal()?"mdspost-comment--full":"b-leaf-full",leafCollapsing:"b-leaf-collapsing",leafExpanding:"b-leaf-expanding",leafActive:"b-leaf-commenting",leafShow:"b-leaf-hover",leafClipped:"b-leaf-clipped",leafLevelUp:LJ.Util.isMediusJournal()?"mdspost-comment--parent":"b-leaf-seemore-parent",leafMore:"b-leaf-seemore",shortTime:LJ.Util.isMediusJournal()?"mdspost-comment-time--shorttime":"b-leaf-shorttime",seeMoreVertical:"b-leaf-seemore-depth",groveShowOnHover:"b-grove-hover",showSpam:m("showSpam",{isPost2017ViewPage:i}),twigLevel:"b-tree-twig-",commentFrozen:LJ.Util.isMediusJournal()?"mdspost-comment--frozen":"b-leaf-frozen"},templates:{twig:LJ.Util.isMediusJournal()?'<div class="mdspost-thread mdspost-thread--level-{level} mdspost-thread--leveldeep-{deepLevel}" style="margin-left: {margin}px" data-tid="t{dtalkid}">{html}</div>':'<div class="b-tree-twig b-tree-twig-{level} b-tree-twig-deep-{deepLevel}" style="margin-left: {margin}px" data-tid="t{dtalkid}">{html}</div>',emptyLeaf:'<div class="b-leaf" id="t{dtalkid}"></div>',promoBubble:"templates-Widgets-promocomment",leaf:LJ.Util.isMediusJournal()?"templates-Comments-v6-Comment":"templates-Comments-Twig"}},_create:function(){var i=this;e.lj.basicWidget.prototype._create.apply(this);var r,l=location.href.match(/(\d+)\.html/),m=this.options.selectors,c=null;if(this._itemid=l&&l[1],this._remoteBalance=LJ.get("remote.balance"),this._root=this._el("tree"),this._pager=this._el("pager"),this._constructionCache={},this._showSpamPage=this.element.hasClass(this._cl("showSpam")),this.element.removeClass(this._cl("groveShowOnHover")),this._bindControls(),this._pager.commentsPager(),this._pagerWidget=this._pager.first().data("commentsPager"),this._title=e(m.title),this._pageTitle=this._title.text(),this._description=e(m.metaDescription),this._pageDescription=this._description.attr("content"),this._titleMl=LJ.ml("talk.post.subject_page"),this._descriptionMl=LJ.ml("talk.post.meta_desct_page"),this._addPagerData(),this._replycount=LJ.get("replycount")||0,o=LJ.Object.resolve(LJ,"Misc.NewCommentsCounter"),o&&o.createCounter({postURL:n.location.host+n.location.pathname,count:this._replycount}),this._spamcount=LJ.get("spamcount")||0,this._bestTid=e(LJ.Util.isMediusJournal()?".mdscomments-list--best .mdspost-thread":".b-tree-best .b-tree-twig").attr("data-tid")||"",this._promoTid=e(m.promoPrice).find(".b-tree-twig").attr("data-tid")||"",this._promoPrice=Number(e(m.promoPrice).attr("data-currentprice")),s.init(this,this._pagerWidget),this._on("cachePage",s.add),"undefined"!=typeof LJ.get("comments")){this.element.addClass(this._cl("groveLoading")),this._root.css({"min-height":e(t).height()}),this._hideRoot(),this._one("commentsConstructed",function(){this._restoreRoot(),this.element.removeClass(this._cl("groveLoading"))}.bind(this)),this._on("commentsPage",function(){this._root.css({"min-height":e(t).height()}),this._loadPage.apply(this,[].slice.call(arguments)),e(t).scrollTop(this.element.offset().top+this.element.outerHeight()-this.element.height())}.bind(this));var d=this,p=function(){console.log("scrolling to",d.element.offset().top+d.element.outerHeight()-d.element.height()),e(t).scrollTop(d.element.offset().top+d.element.outerHeight()-d.element.height())};LJ.Event.on("comments::beforeSwitch",function(){LJ.Event.once("comments::construct::afterRender",function(){p()})}),this._on("commentsConstructed",function(){setTimeout(function(){LJ.Event.trigger("social:widgets:parse")},300),this._root.removeAttr("style"),this.hasOwnProperty("_realRoot")&&this._realRoot.removeAttr("style")}.bind(this)),c=LJ.get("comments"),this._pagerWidget&&(r=this._pagerWidget.page(),s.add(r,c));var u=angular.element(m.commentBest),h=LJ.get("comments");u.length&&u.each(function(e,t){var o=angular.element(t).parent().data("tid");if(o){var n=o.replace(/\D*/,""),a=h.find(function(e){return+e.dtalkid===+n});i._ensureLikeReactionsOnComment({$comment:angular.element(t),commentID:n,isFrozen:a&&"frozen"===a.leafclass})}}),this._constructComments(c),setTimeout(function(){document.location.hash.length>0&&(document.location.hash=document.location.hash)},0)}var f=a.querySelector("#comments"),g=LJ.Function.debounce(function(){if(f){var e=f.getBoundingClientRect(),t=n.innerHeight;e.top<t&&(o&&o.setCounter({postURL:n.location.host+n.location.pathname,count:i._replycount}),n.removeEventListener("scroll",g))}},200);n.addEventListener("scroll",g)},_loadPage:function(e){var t,o,n=this,a=!1,i=function(){a=!0},r=function(t){a||(n._one("commentsConstructed",function(){n._restoreRoot(),n.element.removeClass(n._cl("groveLoading"))}),n._hideRoot(),n._off("commentsPage",i),n._constructComments(t),n._fire("commentsPageLoaded",[e]))};return Function.defer(this._one.bind(this,"commentsPage",i)),this._constructionCache={},this._currentPage=e,this._root.empty(),s.isCached(e)?r(s.get(e)):(t=+new Date,o=1500,this.element.addClass(this._cl("groveLoading")),void this._fetchThread(e,function(n){var a=+new Date;o>a-t?setTimeout(r.bind(null,n),o-(a-t)):r(n),s.add(e,n)}))},_bindControls:function(){var t,o,n=this,a=this.options.selectors,i=this.options.classNames;e.lj.basicWidget.prototype._bindControls.apply(this),["Expand","Collapse","ExpandChildren","Promote","Unpromote"].forEach(function(t){var o=a["link"+t],s=t.toLowerCase();"expandchildren"===s&&(s="expand"),n.element.delegate(o,"click",function(t){var o=e(this),i=o.closest(a.leaf),r=this.closest(a.twig),l=!1;return LJ.PWA.getIsInPWA()&&("expand"===s||"collapse"===s)&&["twig-1","--level-1"].some(function(e){return r.className.indexOf(e)>-1})&&(l=!0),navigator.onLine||l?(n[s](i.prop("id"),i,o.prop("href"),o.closest(a.actionsItem)[0]),void t.preventDefault()):(t.preventDefault(),void LJ.Messages.warning({body:LJ.ml("comments.warning.offline")}))})}),o=new LJ.DelayedCall(function(e){e.addClass(i.leafShow)},150),t=new LJ.DelayedCall(this._loadTimestamp.bind(this),150),this.element.delegate(a.leaf,"click",function(){e(this).removeClass(i.newComment)}).delegate(a.seeMore,"click",function(t){var o=e(this).closest(a.leaf),s=o.hasClass(i.leafExpanding)||o.hasClass(i.leafCollapsing);o.hasClass(i.leafLevelUp)||(s||n._loadMore(o),t.preventDefault())}).delegate(a.leaf,"mouseover",function(n){var a=e(this);n.target.className.indexOf&&-1!==n.target.className.indexOf(i.shortTime)&&!n.target.getAttribute("title")&&t.run(a,e(n.target)),a.hasClass(i.leafShow)||o.run(a)}).delegate(a.leaf,"mouseout",function(n){var a=e(this),s=e(n.relatedTarget);t.stop(),0===s.closest(a).length&&(o.stop(),a.removeClass(i.leafShow))}),this.element.bind("expand",function(e,t,o){n.expand(t,null,o)}).bind("collapse",function(e,t,o){n.collapse(t,null,o)}).bind("refreshThread",this._refreshThread.bind(this)).bind("newComment",this._addNewComment.bind(this)).bind("deleteComment",this._deleteComment.bind(this)).bind("removeFromDOM",this._removeFromDOM.bind(this)),this.element.bind("commentsUpdated",function(e,t,o,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};"addnew"===o&&LJ.Event.trigger("new::comment::shown");var i=0;if(["addnew","unscreen"].indexOf(o)>-1)i=1;else if("delone"===o||"delmany"===o)if(s&&s.length){var r=s.filter(function(e){return!e.screened}).length;i=-r}else i=-a;else"screen"===o&&(i=-1);0!==i&&(n._showSpamPage?n._spamNumberChanged(i):n._commentsNumberChanged(i)),LJ.Event.trigger("entry/fixLinks"),setTimeout(function(){LJ.Event.trigger("social:widgets:parse")},300)}),LJ.Event.on("commentator/submit",function(){n._pagerWidget&&s.remove(n._pagerWidget.page())}),LJ.Event.on("commentsPager/change",n._addPagerData.bind(n)),this.element.find(".b-spamcomments").on("click",function(e){navigator.onLine||(e.preventDefault(),LJ.Messages.warning({body:LJ.ml("comments.warning.offline")}))})},_addPagerData:function(){var e,t=this._pageTitle,o=this._pageDescription;this._pagerWidget&&(e=this._pagerWidget.page()),e&&1!==e&&(t+=" - "+this._titleMl+" "+e,o+=" - "+this._descriptionMl+" "+e),this._title.text(t),this._description.attr("content",o)},_loadTimestamp:function(t,o){var n={journal:Site.currentJournal,thread:t.attr("id").substr(1)},a=function(e){"ok"===e.status&&o.attr("title",e.stamp)};e.get(LiveJournal.getAjaxUrl("get_thread_timestamp"),n,a,"json")},_highlightNewComments:function(){this._highlightNewLeaves(this.element.find(this.options.selectors.leaf))},_highlightNewLeaves:function(t,o){o=o||this._getPageTimestamp();var n,a=this,s=this.options.classNames.newComment,i=o||0;e.each(t,function(){var e=parseInt(this.getAttribute("data-updated-ts"),10),t=this.getAttribute("data-username"),n=this.className,r=-1!==n.indexOf(a._cl("leafMore"));e>i&&!r&&(i=e),o&&e>o&&(!Site.remoteUser||Site.remoteUser!==t)&&(this.className=n+" "+s,r&&this.setAttribute("data-max-ts",o))}),n=this._getPageTimestamp(),(!o||i>n)&&this._setPageTimestamp(i)},_getPageTimestamp:function(){var e=this._getPageHash(),t=LJ.Storage.getItem(e)||{};return t&&parseInt(t.stamp,10)},_setPageTimestamp:function(e){if(e){var t=this._getPageHash();LJ.Storage.setItem(t,{stamp:e,updated:+new Date})}},_getPageHash:function(){var e=["url="+Site.currentEntry];return e.push("thread="+(LiveJournal.parseGetArgs(location.href).thread||0)),e.push("page="+this._getCurrentPage()),e.join(";")},_getCurrentPage:function(){return 0===this._pager.length?1:this._pager.commentsPager("page")},_addPoster:function(e){e.poster=LJ.get("entry.poster")},_createComment:function(t){var o,n,a,s,i,r,l,m,c=this.options.selectors,d=this.options.templates;return t.parent?(l=this._constructionCache.hasOwnProperty(t.parent)?this._constructionCache[t.parent]:this._root.find("#t"+t.parent),m=e.comments.getThread(l,!0),a=t.level?t.level:e.comments.level(l)+1,r=m[m.length-1].closest(c.twig)):(a=1,r=this._root),i=t.margin||30*(a-1),s=a>=50?50:10*Math.floor(a/10),n={dtalkid:t.dtalkid,level:a,deepLevel:s,margin:i},t.hasOwnProperty("html")?o=e(d.twig.supplant({html:t.html||d.emptyLeaf}).supplant(n)):(t=e.extend({},t,{level:a,deepLevel:s,margin:i}),this._addPoster(t),o=this._tmpl("leaf",t)),r===this._root?r.append(o):o.insertAfter(r),this._constructionCache[t.dtalkid]=o,o},_addNewComment:function(o,n){if(n.result&&(this._showSpamPage||!LiveJournal.parseGetArgs(location.href).thread&&this._getCurrentPage()-n.page!==0||!n.parenttalkid&&LiveJournal.parseGetArgs(location.href).thread))return void(t.location.href=decodeURIComponent(n.result));if(0===e("#t"+n.dtalkid).length){var a=n.parenttalkid&&n.parenttalkid.substr(1)||null;this._createComment({dtalkid:n.dtalkid,parent:a,html:""}),e("#t"+n.dtalkid).empty()}this._refreshThread(null,n.dtalkid,!0,"addnew"),n.noHrefChange||setTimeout(function(){t.location.hash="t"+n.dtalkid},0)},_ensureLikeReactionsOnComment:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.$comment,o=e.commentID,n=e.isFrozen,a=void 0===n?!1:n,s=l("commentActions",{isPost2017ViewPage:i,isMediusJournal:r}),c=t.find(s);c.toArray().map(function(e){var t=m("actionItem",{isPost2017ViewPage:i,isMediusJournal:r}),n=angular.element('<li class="'.concat(t," ").concat(t,'-reaction-state"></li>')),s=angular.element('<li class="'.concat(t," ").concat(t,'-reaction-stats"></li>'));angular.element(e).append(n).append(s);var l={targetNode:n[0],directiveType:"action",likeableType:"comment",postID:LJ.get("entry.ditemid"),commentID:o,interactive:!a},c=_objectSpread(_objectSpread({},l),{},{directiveType:"stats",targetNode:s[0]});!a&&LJ.LikeReaction.buildDirective(l),LJ.LikeReaction.buildDirective(c)})},_constructComments:function(e,t){function o(){n._restoreRoot(),r.resetQueue()}var n=this,a=[],s=e.length,i=0,r=LJ.Function.threshold(function(){if(i===s)return n._off("commentsPage",o),n._highlightNewLeaves(a,t),n._fire("commentsConstructed",null,!0),LJ.Event.trigger("comments::construct::afterRender"),LJ.Event.trigger("entry/fixLinks"),void i++;if(!(i>s)){var l=n._createComment(e[i]).find(n._s("leaf"));a.push(l.get(0));var m=e[i].dtalkid,c=e[i].suspended,d=l.hasClass(n._cl("commentFrozen"));!c&&n._ensureLikeReactionsOnComment({$comment:l,commentID:m,isFrozen:d}),i++,r()}},25,!0);!function(e){return e}(),t=t||this._getPageTimestamp(),r.batch(20),Function.defer(n._one.bind(n,"commentsPage",o)),r()},_loadMore:function(e){var t=this,o=e.data("parent");e.addClass(this.options.classNames.leafExpanding),this._fetchThread("t"+o,function(n){n.shift();var a=n.map(function(e){var n=e.level,a=t._constructionCache[o][0],s=Number(_maybeArrayLike(_toConsumableArray,a.classList).find(function(e){return e.match(/mdspost-thread--level-(\d+)/)||e.match(/b-tree-twig-(\d+)/)}).replace(/\D*/,""));return _objectSpread(_objectSpread({},e),{},{level:s+n-1})});t._constructComments(a,e.data("max-ts")),e.remove()},null,e.hasClass(this._cl("seeMoreVertical"))?0:2)},_deleteComment:function(t,o,n,a){function s(){var t=0;p.each(function(o){p[o].id&&(l._bestTid===p[o].id&&(p=p.add(e(LJ.Util.isMediusJournal()?".mdscomments-list--best .mdspost-thread .mdspost-comment":".b-tree-best .b-tree-twig .b-leaf"))),l._promoTid===p[o].id&&(p=p.add(e(r.promoPrice).find(".b-tree-twig .b-leaf"))),t++)}),p.replaceWith(d);var s=p.map(function(e,t){return{screened:t.classList.contains(i.commentScreened)}}).toArray(),m=n||a?"delmany":"delone";l.element.trigger("commentsUpdated",["t"+o,m,t,s]),l._checkSpamPageStatus()}var i=this.options.classNames,r=this.options.selectors,l=this,m=function(e){return e.clone().wrap("<div/>").parent().html()},c=this.element.find(r.commentDeleted+":first"),d=c.length&&m(c),p=this.element.find("#t"+o);0===c.length&&this._fetchThread("t"+o,function(t){var o=t.pop(),n=o.hasOwnProperty("html")?e(o.html).filter(r.commentDeleted):l._tmpl("leaf",o).find(r.commentDeleted);if(0===n.length){var a=e('[data-tid="t'.concat(o.dtalkid,'"]')).find('input[type="checkbox"]');return void a.prop("checked",!1)}d=m(n),s()},!0),n&&(p=p.add(e.comments.getThread(p))),a&&(p=p.add(this.element.find(r.leaf+"[data-username="+a+"]"))),0!==c.length&&s()},_removeFromDOM:function(t,o,n){e.isArray(o)||(o=[o]),o.forEach(function(t){var o="#t"+t,n=e(o);n.length>0&&n.remove()}),this._checkSpamPageStatus(),!this._showSpamPage||"spamcomment"!==n&&"unspam"!==n||(this._spamNumberChanged(-o.length),this._commentsNumberChanged(o.length))},_checkSpamPageStatus:function(){var e,t,o=this.options.selectors,n=o.leaf+":not("+o.commentDeleted+"):not("+o.commentBest+"):first";this._showSpamPage&&0===this.element.find(n).length&&(e=LiveJournal.parseGetArgs(location.href),t=location.href.split("?")[0],delete e.mode,delete e.page,location.href=LiveJournal.constructUrl(t,e).replace(/\?$/,"")+"#comments")},_refreshThread:function(t,o,n,a){var s=this;this._fetchThread("t"+o,function(t){s._applyFetchResults(t,!0,function(){if(!n){var i,r,l,m,c=[];for(l=0,m=t.length;m>l;++l)c.push("t"+t[l].dtalkid);i=" "+c.join(" ")+" ",r=e.comments.getThread(e("#t"+o)).filter(function(){return-1===i.indexOf(" "+this.id+" ")}),r.addClass(s._cl("leafCollapsed")).removeAttr("data-full")}s.element.trigger("commentsUpdated",["t"+o,a])},a),/set_(promo|best)/.test(a)&&s._updateTop(t,function(){s.element.trigger("topUpdated")},a)},n)},_fetchThread:function(t,o,n,a){function s(){m._restoreRoot(),i.abort()}n=n||!1,o=o||e.noop;var i,r,l,m=this,c=t.toString().match(/t(\d+)/),d=c&&c[1],p=LJ.get("journal.is_medius"),u="thread";d||(u="page",d=t),l={journal:Site.currentJournal,itemid:this._itemid,flat:n?"1":"",skip:a?a:"",media:p?"1":""},r=LiveJournal.parseGetArgs(location.href),l[u]=d,"thread"===u&&(l.expand_all=n?"":"1"),r&&r.style&&"mine"===r.style&&(l.style="mine"),i=e.ajax({url:LiveJournal.getAjaxUrl("get_thread"),data:l,dataType:"json",timeout:7500}).success(function(e){m._off("commentsPage",s),e.hasOwnProperty("comments")&&(e=e.comments),o(e)}).error(function(e,a){"abort"!==a&&(m._off("commentsPage",s),setTimeout(m._fetchThread.bind(m,t,o,n),7500))}),function(e){return e}(),Function.defer(m._one.bind(m,"commentsPage",s))},_updateCounters:function(e){"replycount"in e&&(this._el("replyCounter").html(LJ.ml("talk.replycount",{count:e.replycount})),LJ.Event.trigger("commentCounterChange",{formElement:this,replyCounter:e.replycount})),"spamcount"in e&&this._el("spamCounter").html(LJ.ml("talk.spamcount",{count:e.spamcount}))},_applyFetchResults:function(t,o,n,a){var s=this,i=t.length,r=function(){i--,i||n()};n=n||e.noop,t.forEach(function(t){var o,n,i;t.html?i=e(t.html).filter("div"):(s._addPoster(t),i=s._tmpl("leaf",t).find(s._s("leaf"))),o=i.prop("id"),n=e("#"+o),n.hasClass(s._cl("leafCollapsed"))&&!i.hasClass(s._cl("leafCollapsed"))&&(i.addClass(s._cl("leafCollapsed")).data("full",1),i.removeClass(s._cl("leafFull"))),"expand"===a&&n.hasClass(s.options.classNames.leafActive)?"expand"===a&&n.removeClass(s._cl("leafExpanding")):n.replaceWith(i);var l=i.attr("id");l&&s._ensureLikeReactionsOnComment({$comment:i,commentID:+l.replace("t","")}),r()})},_commentsNumberChanged:function(t){var o=e(".b-watering").data("commentform");o&&"edit"===o.previousState()?o.syncPreviousState():(this._replycount=Math.max(0,this._replycount+t),this._updateCounters({replycount:this._replycount}))},_spamNumberChanged:function(e){this._spamcount+=e,this._el("spamCounter").html(LJ.ml("talk.spamcount",{count:this._spamcount}))},expand:function(t,o,n){if(o=o||e("#"+t),!o.hasClass(this.options.classNames.leafExpanding)&&!o.hasClass(this.options.classNames.leafCollapsing)){o.addClass(this.options.classNames.leafExpanding);var a=this,s=a.options.classNames.leafCollapsed,i=this.options.selectors,r=e.comments.getThread(o),l=r.filter(i.leafCollapsed),m=function(t){return function(){var o=e(this),n=!!o.data("full");return n===t}},c=function(t){t.filter(a._s("leafMore")).each(function(){var t=e(this),o=+t.data("count");25>o&&a._loadMore(t)})};void 0===n&&(n=e.comments.skipAnimation),!o.data("full")&&o.hasClass(s)||l.filter(m(!1)).length>0?this._fetchThread(t,function(t){a._applyFetchResults(t,!1,function(){var t=e();l.each(function(){t=t.add(e("#"+this.id))}),a._expandNodes(o,o.prop("id"),t.filter(m(!0)),n);for(var s=d?e.comments.getThread(d).filter(i.leafCollapsed):[],d=e.comments.parentByID(o.prop("id")),p=[],u=!1;d&&!s.length;){var h=d.prop("id").split("t").join(""),f=Site.page.comments.find(function(e){return+e.dtalkid===+h});if(!f){console.error("Can't find data for comment",{dtalkid:h});break}var g=f.actions.findIndex(function(e){return"expandchilds"===e.name&&e.footer});if(-1===g)break;delete f.actions[g],f.actions=f.actions.filter(Boolean),p.push(f),u=!0,d=e.comments.parentByID(d.prop("id")),s=d?e.comments.getThread(d).filter(i.leafCollapsed):[]}u?a._applyFetchResults(p,!1,function(){c(r)}):c(r)},"expand")}):o.hasClass(s)||l.length>0?(this._expandNodes(o,o.prop("id"),l.filter(m(!0)),n),c(r)):o.removeClass(this.options.classNames.leafExpanding)}},_expandNodes:function(t,o,n,a){var s=this,i=s.options.classNames.leafCollapsed,r=s.options.classNames.leafFull;void 0===a&&(a=e.comments.skipAnimation),t.removeClass(this.options.classNames.leafExpanding),a?(n.removeClass(i),n.addClass(r)):n.each(function(){var t,o=e(this),n=o.height();o.hasClass(s.options.classNames.leafActive)||(o.removeClass(i),o.addClass(r).attr("style",""),t=o.height(),o.css({opacity:0,height:n,overflow:"hidden"}).animate({opacity:1,height:t},{duration:300,complete:function(){o.attr("style","")},queue:!1}))}),this.element.trigger("commentsUpdated",[o,"expand"])},collapse:function(t,o,n){var a,s,i,r,l=this,m=l.options.classNames.leafCollapsed,c=l.options.classNames.leafFull,d=l.options.classNames.leafClipped,p=l.options.classNames.leafCollapsing;o=o||e("#"+t),void 0===n&&(n=e.comments.skipAnimation),o.hasClass(this.options.classNames.leafExpanding)||o.hasClass(p)||(s=this.options.selectors,i=o.closest(s.twig),r=e.comments.getThread(o).filter(":not(."+m+"):not(."+p+"):not(."+d+")"),o.hasClass(m)&&0===r.length||(r.addClass(m),a=i.height(),r.removeClass(m).data("full",!0).attr("style","").addClass(p),n?r.addClass(m).removeClass(c).removeClass(p):r.each(function(){var t=e(this),o=t.height();t.css({height:o,overflow:"hidden"}),t.animate({opacity:0,height:a},{duration:300,complete:function(){r.addClass(m).removeClass(c).attr("style","").removeClass(p)},queue:!1})}),this.element.trigger("commentsUpdated",[t,"collapse"])))},_promoteApi:function(t,o,n){n=n||e.noop,LJ.Api.call("promo."+o,{"class":"comments",type:"comment",user:LJ.get("currentJournal"),ditemid:this._itemid,price:this._promoPrice,object_url:t},n)},_promoteDone:function(e,t,o){this.element.trigger("refreshThread",[t.slice(1),!0,o]),this._promoPrice=e.current_price},_promoteFail:function(e){alert(e.error.message),location.reload()},promote:function(t,o,n,a){var s,i,r,l,m,c,d=this;r=function(){e(this).addClass("b-flatbutton-loading"),s.addClass("promocomment-loading"),d._promoteApi(n,"promote",function(e){return e.error?void l(e):(d._promoteDone(e,t,"set_promo"),void s.bubble("hide"))})},l=function(){e(this).addClass("promocomment-update-loading"),s.addClass("promocomment-loading"),d._promoteApi(n,"get_slot",function(e){return e.error?void d._promoteFail(e):(i=!0,d._promoPrice=e.comment[0].buyout_cost,d._remoteBalance=e.comment[0].balance,s.bubble("hide"),void c())})},m=function(){o.removeClass("b-leaf-herbarium"),s.closest(".b-popup").remove()},c=function(){var e={promoMessage:i,tokens:d._promoPrice,promoAllowed:d._remoteBalance>d._promoPrice,siteroot:LJ.get("siteroot")},t={target:a};o.addClass("b-leaf-herbarium"),s=d._tmpl("promoBubble",e).delegate(".promocomment-submit","click",r).delegate(".promocomment-update","click",l).bind("bubblehide",m).bubble(t).bubble("show")},setTimeout(c,0)},unpromote:function(e,t,o){var n=this;this._promoteApi(o,"withdraw",function(t){return t.error?void n._promoteFail(t):void n._promoteDone(t,e,"unset_promo")})},_updateTop:function(t,o,n){if(t&&t[0]&&n){var a,s,i,r,l=this,m=n.split("_");if(o=o||e.noop,r=e(l.options.selectors.treeStart+m[1]),s=r.find(l.options.selectors.twig),"unset"===m[0])return l["_"+m[1]+"Tid"]="",s.remove(),void o();if(l["_"+m[1]+"Tid"]="t"+t[0].dtalkid,a=l._tmpl("leaf",e.extend({},t[0],{is_promo:"promo"===m[1],is_best:"best"===m[1],noid:!0,noactions:!0,nocontrols:!0,massactions:!1})),0===s.length)return r.append(a),void o();i=s.attr("data-tid").slice(1),s.replaceWith(a),e("#t"+i).length>0&&l.element.trigger("refreshThread",[i,!0]),o()}},_hideRoot:function(){this.hasOwnProperty("_realRoot")||(this._realRoot=this._root,this._root=e("<div />"))},_restoreRoot:function(){this.hasOwnProperty("_realRoot")&&(this._realRoot.append(this._root.children()),this._root=this._realRoot,delete this._realRoot)}})}(jQuery,window);
/* <<< file end: js/jquery/jquery.lj.comments.js */

//# map link was there [jquery.lj.comments.js.map]
/* >>> file start: js/common/captcha.js */
!function(e){return e}(),function(e){function t(){return"undefined"!=typeof v}function n(){var t=e.Deferred();return h?t.resolve(h):LJ.Api.call("captcha.get_public_key",{},function(e){h=e.captcha_public,t.resolve(h)}),t.promise()}function r(){return location.protocol+"//www.google.com/recaptcha/api.js?onload=onRecaptchaLoad&render=explicit"}function a(r,a){var o=e.Deferred();return a=e.extend(C,a||{}),LJ.Captcha.current?e.when(n(),L()).then(function(){return t()?(a.sitekey=h,s(),v.render(r,a)):void console.error("Something went wrong. Captcha object is not defined.")}):(o.resolve(),o.promise())}function o(){}function c(){return t()?(s(),v.reset.apply(null,arguments)):void 0}function i(){return null}function l(e){return t()?v.getResponse(e):void 0}function p(){return f(),(v||grecaptcha).execute.apply(null,arguments)}function u(e){var t=e.attributes.title,n=e.attributes.src;if(t){var r=t.value;if(/|challenge/.test(r)&&/recaptcha/.test(r))return!0}if(n){var a=n.value;if(/google\.com.*recaptcha.*bframe/.test(a))return!0}return!1}LJ.define("LJ.Captcha"),LJ.Captcha={create:a,reload:c,destroy:o,getChallenge:i,getResponse:l,isDefined:t,execute:p,current:["recaptcha"].filter(LJ.Flags.isEnabled).shift()},LJ.Captcha.available=!!LJ.Captcha.current;var s,d,f,h,v,C={lang:"ru"},g=e.Deferred();window.onRecaptchaLoad=function(){g.resolve()};var L=LJ.Function.once(function(){var t=e.Deferred();return LJ.injectScript(r()),g.then(function(){v=grecaptcha,t.resolve()}),t.promise()});LJ.Captcha.getCaptchaApiObject=function(){return v||grecaptcha},LJ.Captcha.setOnSimpleForm=function(e,t){s(),window.onCaptchaPass=function(){var t=Object.getPrototypeOf(e).submit;t.call(e)},t.addEventListener("click",function(e){e.preventDefault(),p()})},LJ.Event.on("reCAPTCHA::popup::created",function(e){var t=e.firstChild,n=e.lastChild,r=n.firstChild;e.classList.add("recaptcha-tiles"),t&&t.classList.add("recaptcha-tiles__fader"),n&&n.classList.add("recaptcha-tiles__iframe-wrapper"),r&&r.classList.add("recaptcha-tiles__iframe")}),LJ.Event.on("reCAPTCHA::popup::shown",function(){document.body.classList.add("body--recaptcha-opened")}),LJ.Event.on("reCAPTCHA::popup::hidden",function(){document.body.classList.remove("body--recaptcha-opened")}),function(){var e,t;s=function(){var n=document.body.lastChild;e=setInterval(function(){var r=document.body.lastChild;if(r!==n){n=r;var a=n.querySelector("iframe");a&&u(a)&&(t=n,console.log("reCAPTCHA popup created"),LJ.Event.trigger("reCAPTCHA::popup::created",t),clearInterval(e),e=null)}},100)};var n,r;d=function(){n=new Date,r||(r=setInterval(function(){t&&0===+t.style.opacity&&(console.log("reCAPTCHA popup hidden"),LJ.Event.trigger("reCAPTCHA::popup::hidden"),clearInterval(r),r=null)},100))};var a=1e4;f=function(){n=new Date,r||(r=setInterval(function(){t&&1===+t.style.opacity?(console.log("reCAPTCHA popup shown"),LJ.Event.trigger("reCAPTCHA::popup::shown"),clearInterval(r),r=null,d()):new Date>n+a&&(console.log("reCAPTCHA popup taking too long to appear, aborting wait"),clearInterval(r),r=null)},100))}}()}(jQuery);
/* <<< file end: js/common/captcha.js */

//# map link was there [captcha.js.map]
/* >>> file start: js/misc/tempImageChecker.js */
//= require_ml message.warnings.temporary_url_insertion
LJ.define("LJ.Misc"),LJ.Misc.checkForTempImageURLs=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],n=e.event,t=e.string,a="";if(t)a=t;else if(n)try{var r=n.originalEvent||n;a=r.clipboardData.getData("text/plain")}catch(i){console.log("Could not parse text content from pasted text")}var s=a.match(/https?:\/\/[^\s'"\r\n]+/g)||[],o=s.filter(function(e){return e.indexOf("imgprx.livejournal.net/")>0?!0:e.indexOf("downloader.disk.yandex.ru/")>0?!0:e.indexOf("fna.fbcdn.net/")>0});return o.length&&LJ.Messages&&LJ.Messages.add({body:LJ.ml("message.warnings.temporary_url_insertion"),type:"warning"}),o};
/* <<< file end: js/misc/tempImageChecker.js */

//# map link was there [tempImageChecker.js.map]
/* >>> file start: js/common/comments.js */
//= require js/misc/tempImageChecker.js
//= require_ml blocked.content.comment.warning
!function(){function e(e){var t=-1!==e[0].type.indexOf("image"),n=e[0].size/1e6>=LJ.GlobalConfig.photoUploadMaxSize,o=document.querySelector(".js-commentform-preloader");return e||t||!n?new Promise(function(t,n){o.classList.remove("svgpreloader-wrapper--hidden");var i=new FormData;i.append("name",e[0].name),i.append("form_auth",LJ.get("guid")),i.append("file",e[0]),fetch("".concat(location.protocol,"//").concat(location.host,"/up"),{method:"post",body:i}).then(function(e){return e.json()}).then(function(e){"error"===e.status&&n(e),o.classList.add("svgpreloader-wrapper--hidden"),t(e)})}):void 0}function t(t){var n=t.clipboardData||t.nativeEvent.clipboardData;if(n.files.length){var o=n.files;e(o).then(function(e){var n=angular.element(t.target),o='<img src="'.concat(e.url,'" alt="image" />');n.surroundSelectedText?n.surroundSelectedText(o,""):n[0].setRangeText&&n[0].setRangeText(o)})["catch"](function(e){LJ.Messages.add({type:"error",body:e.message})})}}function n(){var e=document.querySelector(".b-loginform form").getAttribute("action"),t=window.location.href;document.querySelector(".b-loginform form").setAttribute("action",e+"&returnto="+t+"#statShare"),setTimeout(LJ.Util.Action.login)}var o;if(LJ.define("LJ.Comments"),!LJ.Comments.initialized){LJ.Comments.initialized=!0,LJ.Event.on("commentField::init",function(e){var o=e.source,i=e.node;i&&(i.addEventListener("paste",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=e.clipboardData||e.nativeEvent.clipboardData;if(o.files.length){if(!LJ.get("remote"))return LJ.Messages.onLinkClick(function(e){"showLoginPopup"===e.target.dataset.action&&(e.preventDefault(),n())}),LJ.Messages.add({type:"warning",body:"<div>".concat(LJ.ml("blocked.content.comment.warning",{aopts:' href="" data-action="showLoginPopup"'}),"</div>")}),void e.preventDefault();t(e);var i=LJ.Object.resolve(LJ,"Misc.checkForTempImageURLs")||function(){};i({event:e})}}),"S2_comments_view"===o&&(LJ.Event.on("api::broadcast",function(e){e&&"mentionHint"===e.name&&e.api&&e.api.doStandardTextareaMount({textarea:i})}),LJ.Event.trigger("api::request",{name:"mentionHint"})))});var i=Site.entry&&Site.entry.ditemid,r=JSON.parse(localStorage.getItem("lastCommentParams")),a=LiveJournal.parseGetArgs(location.href);if(LJ.Event.on("comment::submit::success",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.postURL,n=e.submittedFromNewForm;o=LJ.Object.resolve(LJ,"Misc.NewCommentsCounter"),t&&o&&o.getCount({postURL:t}).then(function(e){o.setCounter({postURL:t,count:e+1})})["catch"](function(){}),LJ.Post.getPostMeta({URL:e.postURL}).isPublic&&LJ.Rambler.Loyalty.call("comment_sent");try{localStorage.setItem("lastCommentParams",JSON.stringify({ditemid:Site.entry&&Site.entry.ditemid||null,prevViewGetArg:a.view||null}))}catch(i){console.warn(i)}window.ym&&window.ym(27737346,"reachGoal","POST_COMMENT"),n&&LJ.Track.callYM({method:"reachGoal",argArr:["CREATE_COMMENT_NEW_FORM"]})}),LJ.Event.on("comment::submit",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"S2_comments_view"===e.source&&LJ.Post.getPostMeta({URL:e.postURL}).isPublic&&LJ.Rambler.Loyalty.call("comment_sent")}),LJ.Event.on("new::comment::shown",function(){LJ.Misc.Popups&&LJ.Misc.Popups.BetterCommentInApp&&LJ.Misc.Popups.BetterCommentInApp.requestShow()}),r&&"cAdd"===a.act&&a.view&&i===r.ditemid&&a.view!==r.prevViewGetArg){var s=function(){LJ.Event.trigger("new::comment::shown")};Site.entry&&("s2"===Site.page.styleSystem?s():LJ.Event.once("comments::construct::afterRender",s))}localStorage.removeItem("lastCommentParams"),LJ.Comments.preSubmitProcessors=LJ.Comments.preSubmitProcessors||[],LJ.Comments.preSubmitProcessors.push({id:"convertMentionsToLjUsers",fn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.commentInputNode;return LJ.Util.Mentions.replaceMentionsWithLjUsers(t.value).then(function(e){t.value=e})}})}}();
/* <<< file end: js/common/comments.js */

//# map link was there [comments.js.map]
/* >>> file start: js/jquery/jquery.lj.commentator.js */
function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}
//= require js/common/captcha.js
//= require js/common/comments.js
!function(e){return e}(),function(e,t,r){function n(){return"idle"!==l?i:(LJ.injectLjScript("".concat(Site.statprefix,"/js/??front-bundled/dist/rte2022.js")),i=new Promise(function(e){l="pending",t.addEventListener("Rte2022CodeReady",e)}).then(function(){l="resolved"})["catch"](function(){l="rejected"}))}var o,a,i,s=["numbered-list","bulleted-list"],c=Site.page.allow_rte2022,l="idle",d={OLD_COMMENT_FORM:0,CURRENT:2},p=function(e){return'\n      <li class="b-updateform-buttons-item">\n        <div class="b-updateform-button b-updateform-button-'.concat(e,'">\n        <i class="b-updateform-button-pic" data-format="').concat(e,'"></i>\n        </div>\n      </li>\n    ').trim()},u=function(e,t){e.preventDefault();var r=e.detail,n=r.format,o=r.isActive,a=t[n];a&&(o?a.style.opacity="":a.style.opacity=1)},m=function(e){e.preventDefault();var t=r.querySelector(".active-rte");if(t){var n=e.target.dataset.format;if(!n)return;if(s.includes(n)){var o=new CustomEvent("insertList",{detail:{format:e.target.dataset.format}});return void t.dispatchEvent(o)}var a=new CustomEvent("formatting",{detail:{format:e.target.dataset.format}});t.dispatchEvent(a)}},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.onFormToggle,s=e.onInit,d={"new":{node:r.querySelector(".js--new-comment-form-tab-toggle")},classic:{node:r.querySelector(".js--classic-comment-form-tab-toggle")}},f=r.querySelector(".b-updateform-buttons-firstsection"),v=r.querySelector(".b-updateform-buttons-secondsection"),h=v.parentElement,b=r.createElement("ul");b.classList.add("b-updateform-buttons","b-updateform-buttons-firstsection"),b.style.display="none",b.innerHTML="\n      ".concat(p("bold"),"\n      ").concat(p("italic"),"\n      ").concat(p("strikethrough"),"\n      ").concat(p("numbered-list"),"\n      ").concat(p("bulleted-list"),"\n    "),b.dataset.rteFormatBtnsSection="",h.insertBefore(b,v);var g=Array.from(h.querySelectorAll("[data-format]")).reduce(function(e,t){return e[t.dataset.format]=t,e},{});g.link=h.querySelector(".b-updateform-button-link > i");var y=r.querySelector(".js--preview-old-comment-control");b.addEventListener("mousedown",m),t.addEventListener("toggleFormatButton",function(e){return u(e,g)});var C=r.querySelector(".b-updateform-buttons-thirdsection"),_=[{type:"giphy",onClick:function(e){e.preventDefault();var t=r.querySelector(".active-rte");if(t){var n=new CustomEvent("giphyModal.requestShow");t.dispatchEvent(n)}}}];_.forEach(function(e){var t=e.type,n=e.onClick,o=r.createElement("li");o.classList.add("b-updateform-buttons-item"),o.dataset.rte2022Entity="",o.innerHTML='\n       <div class="b-updateform-button b-updateform-button-'.concat(t,'">\n         <i class="b-updateform-button-pic"></i>\n       </div>\n     '),"function"==typeof n&&o.addEventListener("click",n),C.append(o)});var w,E,L=LJ.Page.rte2022Form;L.resetContent=function(e){w&&w.resetContent(e)},L.getIsActive=function(){var e;return w&&!(null===(e=E)||void 0===e||!e.offsetParent)};var S=function(e){(E&&e.firstChild.id!==E.id||!E)&&(E&&E.classList.remove("active-rte"),e.firstChild.classList.add("active-rte"),E=e.firstChild)},k=function(){var e=r.createElement("div");e.classList.add("b-updateform-rte"),o.parentElement.appendChild(e),w=new LJ.Components.Rte2022.Comp({containerNode:e,onChange:function(t){S(e);var r=LJ.Components.Rte2022.getCanSubmit(t);LJ.Event.trigger("commentForm.submitBtn.toggleReq",{disable:!r})}}),s({rte:w})},F=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!(null===(e=E)||void 0===e||!e.offsetParent);if(r){var n="string"==typeof t.value?t.value:w.getHtml();o.value=n,d.classic.node.dataset.isActive="0",d["new"].node.dataset.isActive="1",o.style.display="",w.getOuterNode().style.display="none",f.style.display="",b.style.display="none";var a=b.querySelectorAll(".b-updateform-button-pic");a.forEach(function(e){return e.style.opacity=.2}),o.focus(),w.unmount(),i({newFormIsActive:!1}),y&&(y.style.display="inline-block")}},J=function(){var e,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=o.parentElement;if(!t.location.search.includes("mode=reply")&&"resolved"!==l){if(c.querySelector("[data-is-preloader]"))return;e=r.createElement("div"),e.dataset.isPreloader=!0;var p=r.createElement("div"),u=getComputedStyle(o);e.style="\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: ".concat(u.width,";\n          height: ").concat(u.height,";\n          border: ").concat(u.border,";\n          border-radius: ").concat(u["border-radius"],";\n          background-color: #F8F8F8;\n          z-index: 9999;\n          box-sizing: border-box;\n        "),p.classList.add("svgpreloader","svgpreloader-tag","svgpreloader-20"),e.append(p),o.style.display="none",c.append(e)}var m=L.getIsActive();return n().then(function(){var t,r;e&&(e.remove(),o.removeAttribute("style")),w||k();var n=_objectSpread({},s);if(m){if(!n.editorState){var c=w.getEditorState();n.editorState=c.children}}else n.htmlContentString=o.value||null;w.resetContent(n),w.getOuterNode().style.display="flex",d.classic.node.dataset.isActive="1",d["new"].node.dataset.isActive="0",o.style.display="none",f.style.display="none",b.style.display="",i({newFormIsActive:!0}),"false"===(null===(t=a)||void 0===t?void 0:null===(r=t.dataset)||void 0===r?void 0:r.rte2022WasActivated)&&(a.dataset.rte2022WasActivated=!0),y&&(y.style.display="none")})};L.makeActive=J,d.classic.node.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),F(),LJ.Track.callYM({method:"reachGoal",argArr:["ACTIVATE_OLD_COMMENT_FORM"]})}),d["new"].node.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),J(),LJ.Track.callYM({method:"reachGoal",argArr:["ACTIVATE_NEW_COMMENT_FORM"]})}),LJ.Event.on("commentForm.clearReq",function(){w&&w.resetContent()}),LJ.Event.on("commentForm::rte::makeActive",function(e){J(e)}),LJ.Event.on("commentForm::switchToRteControl::setDisable",function(e){var t=d["new"].node;e&&!t.disabled&&(t.disabled=!0),!e&&t.disabled&&(t.disabled=!1)}),LJ.Event.on("commentform::classic::makeActive",function(e){F(e)}),LJ.Event.on("commentForm::rte::basicToolbar::formatBtnsSection::changeState",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.querySelector("[data-rte-format-btns-section]");t&&e.hasOwnProperty("isActive")&&(t.style.pointerEvents=e.isActive?"auto":"none")});var x=function(){var e,t,i;o=r.querySelector(".b-updateform-textarea"),a=(null===(e=o)||void 0===e?void 0:e.closest("[data-rte2022-wrapper]"))||(null===(t=o)||void 0===t?void 0:null===(i=t.closest("form"))||void 0===i?void 0:i.firstElementChild);var s=r.querySelector("#comments");if(s&&"idle"===l)var p=LJ.Util.onNodeVisible(s,{edge:"top"},function(){n(),p.abortPolling()});c?J().then(function(){d.classic.node.removeAttribute("disabled"),d["new"].node.removeAttribute("disabled")}):(d.classic.node.removeAttribute("disabled"),d["new"].node.removeAttribute("disabled"))};"complete"!==r.readyState&&"loaded"!==r.readyState&&"interactive"!==r.readyState||x(),r.addEventListener("DOMContentLoaded",x)},v=function(e){var t=e.newForm,r=void 0===t?{}:t;if(r.isActive&&r.rte&&r.rte.getHtml){var n=r.rte.getHtml({serializeParams:{convertLineBreaksToBrsInParagraphs:!0}}),o=r.rte.getEditorState(),a=o.children[0];1===o.children.length&&a.children&&"paragraph"===a.children.type&&(n=a.children.reduce(function(e,t){return e+LJ.Components.Rte2022.serializeToHtml(t)},"")),e.textarea[0].value=n}};e.widget("lj.commentator",{options:{publicKey:"",ajax:!0,needCaptcha:!1,keyCaptchaLoaded:!1,captchaContainerId:"",selectors:{comments:"#comments",errorWrapper:".b-msgsystem-errorbox",errorBlock:".b-postform-alert-ajax",blockingErrorBlocks:".b-bubble-warning",preloaderElem:".b-postform-preload",controls:":button, :submit",ajaxField:'input[name="json"]',captchaResponse:'input[name="captcha_response"]',captchaType:'input[name="captcha_type"]',previewControl:'input[name="submitpreview"]',rteContent:'input[name="content"]',formatVersionHiddenInput:'input[name="prop_format_ver"]',inputParentTalkid:"#parenttalkid",submitControl:"button[name=submitpost]",form:"form",captchaBox:".b-postform-captchabox",anonLoginSubmit:".b-watering-authtype-user.b-watering-user-notreg",rte2022Wrapper:"[data-rte2022-wrapper]"},classNames:{idle:"b-postform-preload-active",captchaActive:"b-postform-captchabox-active",errorWrapperShow:"b-msgsystem-errorbox-show",replyPage:"b-postform",loginTypeContainerPrefix:"b-postform-login-",authtypePrefix:"b-postform-authtype-"},templates:{frame:'<iframe class="b-watering-commentator" name="commentator" width="0" height="0" frameborder="0" />'}},_create:function(){function n(e){LJ.Flags.isEnabled("messages_v6")?JSON.parse(e).forEach(LJ.Messages.add.bind(LJ.Messages)):alert(e)}var o=this,a=this,i=a.element,s=a.options,l=s.selectors,p=s.classNames;a._isReplyPage=i.hasClass(p.replyPage),a._form=i.find(l.form),e(s.templates.jsonField).prependTo(a._form),e(s.templates.frame).prependTo(r.body),a._errorBlock=i.find(l.errorBlock),a._errorsWrapper=i.find(l.errorWrapper),a._blockingErrorBlocks=i.find(l.blockingErrorBlocks),a._preloaderElem=i.find(l.preloaderElem),a._controls=i.find(l.controls),a._ajaxField=i.find(l.ajaxField),a._captchaResponse=i.find(l.captchaResponse),a._captchaType=i.find(l.captchaType),a._captchaBox=i.find(l.captchaBox),a._inputParentTalkid=i.find(l.inputParentTalkid),a._rteContent=i.find(l.rteContent),a._formatVersionHiddenInput=i.find(l.formatVersionHiddenInput),a._rte2022Wrapper=i.find(l.rte2022Wrapper),a.textarea=a.element.find("textarea"),a._isCommentFormVisible=a.element.is(":visible"),a._setOptions(s),i.bind("authtypechange",function(e,t){a._setOptions(t),a.toggleCaptcha(t.needCaptcha)}).bind("keydown",function(e){if(!a._disabled&&13===e.which&&e.ctrlKey){var t;null!==(t=a.newForm)&&void 0!==t&&t.isActive&&v(a),a._form.trigger("submit"),e.preventDefault()}}),i.bind("commentformopen",function(){a._isCommentFormVisible=!0,a.toggleCaptcha(!0)}).bind("commentformclose",function(){a._errorsWrapper.removeClass(p.errorWrapperShow),a._isCommentFormVisible=!1,a.toggleCaptcha(),LJ.Event.trigger("commentForm::switchToRteControl::setDisable",!1)}).bind("commentformdisable",function(e,t){a._disabled=!!t});var u=function(){var e=Promise.resolve(),t=LJ.Comments.preSubmitProcessors||[];return t.forEach(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=e.then(function(){return t.fn({commentInputNode:a.textarea[0]})})}),e};c&&(a.newForm={},f({onFormToggle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.newFormIsActive;a.newForm.isActive=t,a._setOption("formatVersion",t?d.CURRENT:d.OLD_COMMENT_FORM),LJ.Page.commentForm.lastTypeUsed=t?"rte":"classic",a._rte2022Wrapper[0].dataset.currentForm=t?"rte":"classic"},onInit:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.rte;a.newForm.rte=t}}));var m=!1;a._controls.on("click",function(e){var t=jQuery(e.target),r="submitpreview"===t.prop("name"),n="submitpost"===t.prop("name"),o=t.hasClass("b-postform-quote"),i=t.closest(".js--noSubmit").length;if(!i){if(!m){e.preventDefault();var s=e.currentTarget;return void u().then(function(){m=!0,s.click()})}return m=!1,r&&(a._setOption("ajax",!1),a._form.append('<input type="hidden" name="submitpreview" value="1" />')),LJ.get("journal.is_medius")&&a._form.append('<input type="hidden" name="is_medius" value="1" />'),v(a),n&&a.options.needCaptcha&&!a.passedCaptchaTest()?(e.preventDefault(),LJ.Captcha.execute(a.captchaWidgetId)):void(o||a.options.needCaptcha||a._controls.prop("disabled")||(a._form.submit(),e.preventDefault()))}});var h=function(){var e=o.options.classNames,t=e.authtypePrefix,r=e.loginTypeContainerPrefix;o.element.hasClass("".concat(t,"user"))||o.element.find(".".concat(r,"user")).find('[name="userpost"],[name="password"]').val("")};a._form.bind("submit",function(){var e;if(LJ.Event.trigger("comment::submit",{commentInputNode:a.textarea[0],postURL:t.location.href.match(/[^\?#]+/)[0]}),a._errorsWrapper.removeClass(p.errorWrapperShow),a._preloaderElem.addClass(p.idle),a._controls.prop("disabled",!0),a._controls.filter(function(){return this.closest(".js--noSubmit")}).prop("disabled",!1),null!==a&&void 0!==a&&null!==(e=a.newForm)&&void 0!==e&&e.isActive){var r,n,o=null===(r=a.newForm.rte)||void 0===r?void 0:null===(n=r.getEditorState())||void 0===n?void 0:n.children;a._setOption("rteContent",o),a._rteContent.prop("disabled",!1)}else a._rteContent.prop("disabled",!0);try{a._captchaResponse.val(LJ.Captcha.getResponse(a.captchaWidgetId))}catch(i){console.warn("Failed to get captcha response due to",i)}h()}),LJ.Event.on("commentator/submit",function(e){var r;switch(a.option("needCaptcha",e.need_captcha),a._setOption("rteContent",null),e.status){case"redirect":if(LJ.Event.trigger("comment::submit::success",{postURL:t.location.href.match(/[^\?#]+/)[0],submittedFromNewForm:(null===a||void 0===a?void 0:null===(r=a.newForm)||void 0===r?void 0:r.isActive)||!1}),a._isReplyPage||a.element.is(l.anonLoginSubmit))e.hidden&&n(e.message),t.location.href=decodeURIComponent(e.result);else{if(e.hidden&&(setTimeout(function(){n(e.message)},500),!LJ.get("remote")))return;e.parenttalkid=a.element.data("parenttalkid"),a.element.trigger("newComment",e)}break;case"error":if(e.redirect)return void(t.location.href=decodeURIComponent(e.redirect));a.option("error",decodeURIComponent(e.result)),a._errorsWrapper.addClass(p.errorWrapperShow),a._preloaderElem.removeClass(p.idle),a._controls.prop("disabled",!1),a._errorsWrapper.length>0&&jQuery("html, body").scrollTop(a._errorsWrapper.offset().top),e.need_captcha&&(LJ.Captcha.isDefined()?LJ.Captcha.execute(a.captchaWidgetId):LJ.Event.once("Commentator::Captcha::create",LJ.Captcha.execute))}}),LJ.Event.on("api::broadcast",function(e){e&&"hashHint"===e.name&&e.api&&(a.hashHintApi=e.api,a.hashHintApi.doStandardTextareaMount({textarea:a.textarea[0]}))}),LJ.Event.trigger("api::request",{name:"hashHint"}),LJ.Event.on("api::broadcast",function(e){e&&"mentionHint"===e.name&&e.api&&(a.mentionHintApi=e.api,a.mentionHintApi.doStandardTextareaMount({textarea:a.textarea[0]}))}),LJ.Event.trigger("api::request",{name:"mentionHint"}),LJ.Event.trigger("commentField::init",{node:a.textarea[0]}),LJ.Event.on("postQuoteReply",function(e){var t,n=r.querySelector(".b-watering-inner"),a=!(null===n||void 0===n||!n.offsetParent);if(!a){var i=r.querySelector("#comments")||r.querySelector("#add_comment"),s=i.getBoundingClientRect();r.scrollingElement.scrollTop=s.top,LJ.Event.trigger("commentator/show")}var c=e.quote,l=r.querySelector(".active-rte"),d=!(null===(t=o.newForm)||void 0===t||!t.isActive||!l),p=o.textarea[0];if(d){var u=new CustomEvent("insertPostQuote",{detail:e});return void l.dispatchEvent(u)}var m="\n";p.value||(m=""),p.value=p.value+m+'<blockquote class="post-quote-comment__blockquote" data-is-post-quote="true">'+c+"</blockquote>\n",p.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0})),p.focus()})},_setOption:function(t,r){var n,o=this,a=o.options,i=a.classNames;switch(t){case"error":if(this._errorsWrapper.removeClass(i.errorWrapperShow),this._errorBlock.hide(),r){if(n=o._blockingErrorBlocks.filter(":visible"),n.html()===r)return this._errorBlock.hide(),n.fadeOut("fast",function(){n.fadeIn("fast")}),!0;this._errorBlock.html(r).show()}break;case"needCaptcha":o.options.needCaptcha=Boolean(r),o._captchaBox.toggleClass(i.captchaActive,Boolean(r)),o.toggleCaptcha(r);break;case"ajax":r?(this._ajaxField.val(1),this._form.attr("target","commentator")):(this._ajaxField.val(0),this._form.attr("target","_self"));break;case"authtype":return;case"formatVersion":return void this._formatVersionHiddenInput.val(r);case"rteContent":if(r){var s={children:r};this._rteContent.val(JSON.stringify(s))}else this._rteContent.removeAttr("value");return}e.lj.basicWidget.prototype._setOption.apply(this,arguments)},error:function(){return this._errorsWrapper.addClass(this.options.classNames.errorWrapperShow),this._errorBlock.show(),this},hide:function(){return this._errorBlock.slideUp("fast"),this},passedCaptchaTest:function(){return""!==LJ.Captcha.getResponse(this.captchaWidgetId)},captchaSuccess:function(){this._form.submit()},toggleCaptcha:function(t){var r=this,n={lang:"ru",theme:"clean",size:"invisible",callback:this.captchaSuccess.bind(this)};if(t){if(!this.options.needCaptcha||!this._isCommentFormVisible)return;if(!e("#".concat(this.options.captchaContainerId)).length)return;return this.captchaWidgetIdIsDefined?LJ.Captcha.reload(this.captchaWidgetId):this.settingUpCaptcha?!1:(this.settingUpCaptcha=!0,LJ.Captcha.create(this.options.captchaContainerId,n).then(function(e){r.settingUpCaptcha=!1,r.captchaWidgetId=e,r.captchaWidgetIdIsDefined=!0,LJ.Event.trigger("Commentator::Captcha::create")}))}}})}(jQuery,LJ.Util.getWindow(),LJ.Util.getDocument());
/* <<< file end: js/jquery/jquery.lj.commentator.js */

//# map link was there [jquery.lj.commentator.js.map]
/* >>> file start: js/jquery/jquery.lj.authtype.js */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){e.widget("lj.authtype",e.lj.basicWidget,{options:{selectControl:{},state:"collapsed",selectedIndex:0,focusedIndex:0,nativeAuthTypes:"cookieuser, livejournal, anonymous",index:0,authType:"livejournal",authTypesControls:{},forceStartupCaptcha:!1,classNames:{expanded:"b-postform-login-services-show",startAuthTypePrefix:"b-postform-trueauth-",authTypePrefix:"b-postform-authtype-",willBeScreened:"b-postform-user-screened",notfriend:"b-postform-user-notafriend",captchaForAnonymous:"b-postform-captcha-anon",captchaForNonFriends:"b-postform-captcha-nonfriend",captchaForAll:"b-postform-captcha-all",notaspammer:"b-postform-notaspammer",activeItem:"b-watering-user-services-active"},selectors:{activeSelectItem:"a[href=#{authType}]",selectControl:".b-postform-login-services",authTypesControls:".b-postform-login-services-items a:not(.b-postform-login-services-disabled, .b-postform-login-invisible)",authInputs:"input.auth-input",authTypeNotInSelect:".b-postform-notselect",authTypesDisabledControls:".b-postform-login-services-disabled",authTypeRadios:'input[id^="{authType}"]',inputForFocus:"input:visible:first",mobileSelect:"#usertype"},hardSelectors:{mobileSelect:"#usertype"}},_create:function(){var t=this,s=t.options,o=s.selectors;e.lj.basicWidget.prototype._create.apply(this),s.authInputs=t.element.find(o.authInputs),s.selectControl=t.element.find(o.selectControl),s.authTypesControls=t.element.find(o.authTypesControls),s.commentWillBeScreened=t.element.hasClass(s.classNames.willBeScreened),s.captchaForAll=t.element.hasClass(s.classNames.captchaForAll),s.captchaForNonFriends=t.element.hasClass(s.classNames.captchaForNonFriends),s.captchaForAnonymous=t.element.hasClass(s.classNames.captchaForAnonymous);var n=t.element.find(s.selectors.mobileSelect);LJ.Support.isMobile()&&n.length?this._bindControlsMobile():this._bindControls()},_bindControlsMobile:function(){var t=this,s=t.options;e.lj.basicWidget.prototype._bindControls.apply(this),t._setStartAuthType(t.element[0].className);var o=t.element.find(s.selectors.mobileSelect);t.element.bind("commentformclose",function(e){t._setOption("authType",s.startAuthType)}),o.bind("change",function(e){s.authType!==this.value&&t.authType(this.value)})},_bindControls:function(){var t=this,s=this.options,o=this.options.selectors,n=e.browser.webkit||e.browser.msie?"keydown":"keypress";e.lj.basicWidget.prototype._bindControls.apply(this),t._setStartAuthType(t.element[0].className),t._setActiveSelectItem(),t.element.bind("commentformclose",function(e){t._setOption("authType",s.startAuthType)}).delegate(o.selectControl,"click",function(e){e.preventDefault(),t.toggleState()}).delegate(o.authTypesDisabledControls,"click",function(e){e.preventDefault()}).delegate(o.selectControl,n,function(e){switch(e.keyCode){case 38:e.preventDefault(),t.index("-1");break;case 40:e.preventDefault(),t.index("+1")}return!0}).delegate(o.authTypesControls,"click",function(s){var o=e(this),n=o.attr("href").replace("#","");s.preventDefault(),s.stopPropagation(),"expanded"==t.state()?(t.authType(n),t.state("collapsed"),t.option("activeItem",o)):t.state("expanded")}).delegate(o.authTypeNotInSelect,"click",function(s){var o=e(this),n=o.attr("href").replace("#","");s.preventDefault(),s.stopPropagation(),t.authType(n)}).delegate(o.authTypesControls,"mouseenter",function(e){s.authTypesControls.trigger("blur"),t.option("focusedIndex",-1)}).delegate(":input","focus",function(e){"expanded"==t.state()&&t.state("collapsed")}),e(document).bind("keydown","escape",function(e){t.state("collapsed")}),s.selectControl.bind("click",function(e){t._suppressNextEvent("documentClick")}),this._on("documentClick",function(){t.state("collapsed")})},_setOption:function(e,t){var s,o,n,a,i=this,r=i.options,l=r.selectors,c=r.classNames;switch(e){case"state":"expanded"==t?(r.selectControl.addClass(r.classNames.expanded),this.option("focusedIndex",-1)):r.selectControl.removeClass(r.classNames.expanded);break;case"activeItem":r.activeItem&&r.activeItem.removeClass(c.activeItem),t.addClass(c.activeItem);break;case"authType":s=-1==r.nativeAuthTypes.indexOf(t),r.authInputs.val(""),o=s&&t!==r.startAuthType||"anonymous"==t&&r.commentWillBeScreened,n=!o;var p=function(){if(Site.currentJournal===Site.remoteUser)return!0;if(Site.journal&&Site.journal.is_community){var e=["moderator","maintainer","owner"],t=Site.journal.community_relation;if(e.indexOf(t)>-1)return!0}return!1};a=(r.captchaForAnonymous||r.captchaForNonFriends||r.captchaForAll)&&"anonymous"==t||t===r.startAuthType&&!this.element.hasClass(c.notaspammer)&&(r.captchaForAll&&!p()||r.captchaForNonFriends&&this.element.hasClass(c.notfriend)),r.forceStartupCaptcha&&(a=!0,this._setOption("forceStartupCaptcha",!1)),i.element.removeClass(r.classNames.authTypePrefix+r.authType).addClass(r.classNames.authTypePrefix+t).trigger("authtypechange",{authtype:t,ajax:n,needCaptcha:a,error:!1}).find(l.authTypeRadios.supplant({authType:t})).trigger("click").end().find(l.inputForFocus).trigger("focus");var u=i.element.find(r.hardSelectors.mobileSelect);u.val(t),i._setActiveSelectItem(t)}i.options[e]=t},_setStartAuthType:function(e){var t=this.options,s=RegExp(t.classNames.startAuthTypePrefix+"(\\w+)"),o=e.match(s),n=o[1];this._setOption("startAuthType",n),s=RegExp(t.classNames.authTypePrefix+"(\\w+)"),o=e.match(s),o&&(n=o[1]),this._setOption("authType",n)},_setActiveSelectItem:function(t){for(var s,o=this.options,n=o.authTypesControls,a=t||o.authType,i=o.selectors.activeSelectItem.replace("{authType}",a),r=0,l=n.length;l>r;r++)if(s=e(n[r]),s.filter(i).length)return o.selectedIndex=r,this._setOption("activeItem",s),!0},toggleState:function(){return this.state("expanded"==this.options.state?"collapsed":"expanded"),this},authType:function(e){return"undefined"==typeof e?this.options.authType:(this._setOption("authType",e),this)},state:function(e){return"undefined"==typeof e?this.options.state:(this._setOption("state",e),this)},index:function(e){var t,s,o,n=this,a=n.options,i=a.state,r=a.authTypesControls,l="expanded"==i?a.focusedIndex:a.selectedIndex;return void 0===("undefined"==typeof e?"undefined":_typeof(e))?this.options.index:(e=parseInt(e,10),t=l+e,"collapsed"==i&&(t>=r.length||0>t)?!1:(t>=r.length?t=0:0>t&&(t=r.length-1),s=r.eq(t),void("expanded"==i?(s.trigger("focus"),a.focusedIndex=t):(o=s.attr("href").replace("#",""),n.authType(o)))))}})}(jQuery,this);
/* <<< file end: js/jquery/jquery.lj.authtype.js */

//# map link was there [jquery.lj.authtype.js.map]
/* >>> file start: js/jquery/mixins/cursor.js */
LJ.UI.mixin("cursor",function(n,e){function l(n,e,l){i.locked()||(o(null===u?0:e?n:u+n),l.preventDefault())}function o(n){if(e.items.eq(u).removeClass(e.hoverClass),null!==n){u=e.cyclic?(d+n)%d:0>n?0:n>=d?d-1:n;var l=e.items.eq(u);l.addClass(e.hoverClass);var o=e.container.scrollTop(),t=l.prop("offsetTop"),i=l.outerHeight(),r=e.container.height();t+i>o+r?e.container.scrollTop(t+i-r):o>=t&&e.container.scrollTop(t),e.cursorUpdate(n,l)}else u=null}function t(){var n;i.locked()||null!==u&&(n=e.items.eq(u),e.select(n.data("name"),n),o(null))}e=n.extend({},{target:null,items:null,container:null,cancel:n.noop,cursorUpdate:n.noop,cyclic:!1,hoverClass:"hover",columns:1},e);var i=this,u=null,d=e.items.length;return function(n){return n}(),e.target.bind("keydown","esc",e.cancel).bind("keydown","return",t).bind("keydown","home",l.bind(null,0,!0)).bind("keydown","end",l.bind(null,d-1,!0)),1===e.columns?e.target.bind("keydown","up",l.bind(null,-1,!1)).bind("keydown","down",l.bind(null,1,!1)):e.target.bind("keydown","left",l.bind(null,-1,!1)).bind("keydown","right",l.bind(null,1,!1)).bind("keydown","up",l.bind(null,-e.columns,!1)).bind("keydown","down",l.bind(null,e.columns,!1)),{reset:function(){o(null)},index:function(n){return 0===arguments.length?u:void o(n)},setData:function(n,l){l=void 0===l?null:0,e.items=n,d=e.items.length,o(l)},item:function(n){return e.items.eq(n||u)}}});
/* <<< file end: js/jquery/mixins/cursor.js */

//# map link was there [cursor.js.map]
/* >>> file start: js/jquery/jquery.lj.userpicker.js */
//= require js/jquery/mixins/cursor.js
LJ.injectStyle('/* >>> file start: stc/userpicselector.css */\n.b-ljuserpic{margin:0}#js .b-ljuserpic-mobile .b-myuserpic,.b-myuserpic{display:none}#js .b-myuserpic{display:block}#js .b-ljuserpic-selector{display:none}#js .b-ljuserpic-mobile .b-ljuserpic-selector{display:inline}.b-ljuserpic-default{display:none}.b-myuserpic{width:100px;margin:0 0 15px;padding:8px 8px 4px;border:2px solid #59D;border-radius:5px;box-shadow:0 1px 1px rgba(0,0,0,.3);border-collapse:collapse;background:#FFF;cursor:pointer}.b-myuserpic:hover{border-color:#C00;cursor:pointer}.b-myuserpic-current:active,.b-myuserpic-current:hover,.b-myuserpic-current:link,.b-myuserpic-current:visited{display:block;width:100px;height:100px;margin:0;padding:0;border:0;background-repeat:no-repeat;background-position:50% 50%;text-decoration:none;font:0/0 serif}.b-myuserpic-current:focus{outline:dotted thin}.b-myuserpic-unfocus:focus{outline:0!important}.b-myuserpic-options{display:block;margin:0}.b-myuserpic-title{position:relative;display:inline-block;margin:0;padding:5px 0 0;font-size:11px;color:#369}.b-myuserpic-title I{overflow:hidden;position:absolute;top:6px;right:-16px;display:block;width:16px;height:16px;background:url(/img/icons/popup-expand.png?v=15718) no-repeat}.b-myuserpic:hover .b-myuserpic-title I{background-position:0 -16px}.b-myuserpic:focus .b-myuserpic-title I{background-position:0 -32px}.b-myuserpic-title .b-pseudo{overflow:hidden;margin:0;display:inline-block;max-width:80px;white-space:nowrap;text-overflow:ellipsis;font-size:11px}.b-ljuserpic-disabled .b-myuserpic-title,.b-ljuserpic-off .b-myuserpic-options,.b-ljuserpic-off .b-userpicselector,.b-userpicselector .i-popup-close{display:none}.b-myuserpic:hover .b-myuserpic-title .b-pseudo{color:#C00}.b-myuserpic-anonymous{padding:8px;cursor:default}.b-myuserpic-anonymous:hover{border-color:#59D;cursor:default}.b-myuserpic-anonymous .b-myuserpic-current:active,.b-myuserpic-anonymous .b-myuserpic-current:focus,.b-myuserpic-anonymous .b-myuserpic-current:hover,.b-myuserpic-anonymous .b-myuserpic-current:link,.b-myuserpic-anonymous .b-myuserpic-current:visited{outline:0;cursor:default}.b-myuserpic-nouserpics{padding:8px;cursor:default}.b-myuserpic-nouserpics:hover{border-color:#59D;cursor:default}.b-myuserpic-nouserpics .b-myuserpic-current:active,.b-myuserpic-nouserpics .b-myuserpic-current:focus,.b-myuserpic-nouserpics .b-myuserpic-current:hover,.b-myuserpic-nouserpics .b-myuserpic-current:link,.b-myuserpic-nouserpics .b-myuserpic-current:visited{outline:0;cursor:default}.b-ljuserpic-disabled .b-myuserpic{opacity:.5;padding:8px;cursor:default}.b-ljuserpic-off,.b-ljuserpic-off .b-myuserpic{margin:0;padding:0;cursor:default}.b-ljuserpic-disabled .b-myuserpic:hover{border-color:#59D;cursor:default}.b-ljuserpic-disabled .b-myuserpic-current:active,.b-ljuserpic-disabled .b-myuserpic-current:focus,.b-ljuserpic-disabled .b-myuserpic-current:hover,.b-ljuserpic-disabled .b-myuserpic-current:link,.b-ljuserpic-disabled .b-myuserpic-current:visited{outline:0;cursor:default}.b-ljuserpic-off .b-myuserpic{width:100px;border:0;border-radius:0;box-shadow:none;border-collapse:collapse;background:#FFF}.b-ljuserpic-off .b-myuserpic-current:active,.b-ljuserpic-off .b-myuserpic-current:focus,.b-ljuserpic-off .b-myuserpic-current:hover,.b-ljuserpic-off .b-myuserpic-current:link,.b-ljuserpic-off .b-myuserpic-current:visited{outline:0;cursor:default}.b-userpicselector{overflow:hidden;position:absolute;z-index:100;clear:both;margin:-17px -17px 0;padding:15px 15px 0;border:2px solid #59D;border-radius:9px;box-shadow:0 10px 15px rgba(53,99,161,.8);background:#FAFAFA;background:-webkit-gradient(linear,left top,left bottom,color-stop(0,#FAFCFE),color-stop(25%,#E2E3E7),color-stop(100%,#FAFAFA));background:-webkit-linear-gradient(top,#FAFCFE 0,#E2E3E7 25%,#FAFAFA 100%);background:linear-gradient(top,#FAFCFE 0,#E2E3E7 25%,#FAFAFA 100%);filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#FAFCFE\', endColorstr=\'#E2E3E7\', GradientType=0 );font:14px/1.2 Arial,sans-serif}.b-userpicselector .b-popup-inner,.b-userpicselector .b-popup-outer{position:relative;z-index:100;margin:0;padding:0;border-radius:0;border:0;background:0 0}.b-userpicselector .i-popup-arr{visibility:hidden}.b-userpicselector-inner{width:620px}.b-userpicselector-tiny4{width:480px}.b-userpicselector-tiny3{width:360px}.b-userpicselector-wrapper{overflow:auto;position:relative;height:308px;margin:0;padding:0;background:url(/img/preloader/preloader-circle-gray.gif?v=21229) 50% 50% no-repeat;font:14px/1.2 Arial,sans-serif}.b-userpicselector-loaded .b-userpicselector-wrapper{background:0 0}.b-userpicselector-tiny .b-userpicselector-wrapper{overflow:hidden;height:145px}.b-userpicselector-items{margin:0;padding:0;list-style:none}.b-userpicselector-items:after,.b-userpicselector-items:before{display:table;border-collapse:collapse;content:\"\"}.b-userpicselector-items:after{clear:both}.b-userpicselector-item{overflow:hidden;position:relative;float:left;width:100px;height:124px;margin:0 0 10px;padding:10px;text-align:left}.b-userpicselector-tiny3 .b-userpicselector-item,.b-userpicselector-tiny4 .b-userpicselector-item{margin-bottom:0}.b-userpicselector-item LABEL{display:block;margin:-10px;padding:10px;text-align:center;font-size:11px}#js .b-userpicselector-checkbox{position:absolute;left:-199px}.b-userpicselector-pic{display:block;width:100px;height:100px;margin:0;padding:0;cursor:pointer;color:#0051B7;background-repeat:no-repeat;background-position:50% 50%;font:0/0 serif}.b-userpicselector-item .b-pseudo{overflow:hidden;display:inline-block;height:14px;max-width:100px;margin:0;padding:5px 0 0;border-bottom:1px dotted;white-space:nowrap;text-overflow:ellipsis;color:#369;cursor:pointer}.b-userpicselector-item:hover .b-pseudo{color:#C00}.b-userpicselector-active LABEL{border-radius:5px;background:#58E;background:-webkit-gradient(linear,left top,left bottom,color-stop(0,#347),color-stop(100%,#58E)) #58E;background:-webkit-linear-gradient(top,#347 0,#58E 100%) #58E;background:linear-gradient(top,#347 0,#58E 100%) #58E;filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#334477\', endColorstr=\'#5588EE\', GradientType=0 )}.b-userpicselector-active .b-pseudo{color:#FFF}.b-userpicselector-selected LABEL{padding:9px;border:1px dotted #000}.b-userpicselector-selected .b-pseudo{color:#C00}.b-userpicselector-selected.b-userpicselector-active LABEL{border:1px solid #473479}.b-userpicselector-selected.b-userpicselector-active .b-pseudo{color:#FFF}.b-userpicselector-selected.b-userpicselector-active:hover .b-pseudo{color:#C00}.b-userpicselector-controls{margin:15px -15px 0;padding:20px;-moz-border-radius-bottomleft:7px;-moz-border-radius-bottomright:7px;border-bottom-left-radius:7px;border-bottom-right-radius:7px;background:#CDE;background:-webkit-gradient(linear,left top,left bottom,color-stop(0,#CDE),color-stop(100%,#FFF)) #CDE;background:-webkit-linear-gradient(top,#CDE 0,#FFF 100%) #CDE;background:linear-gradient(top,#CDE 0,#FFF 100%) #CDE;filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#CCDDEE\', endColorstr=\'#FFFFFF\', GradientType=0 );font:14px/1.2 Arial,sans-serif}.b-userpicselector-keywords{display:none;width:16em;margin:0 20px 0 0}#js .b-userpicselector-keywords{display:inline-block}#js .b-userpicselector-tiny .b-userpicselector-keywords,.b-userpicselector-tiny .placeholder-wrapper{display:none}BODY .b-userpicselector-showall,BODY .b-userpicselector-showall:link,BODY .b-userpicselector-showall:visited{margin:0;border:0;color:#0051B7!important;text-decoration:underline}BODY .b-userpicselector-showall:active,BODY .b-userpicselector-showall:hover{color:#C00!important;border:0;text-decoration:underline}BODY .b-userpicselector-close:active,BODY .b-userpicselector-close:hover,BODY .b-userpicselector-close:link,BODY .b-userpicselector-close:visited{display:none;position:absolute;bottom:21px;right:4px;z-index:3;margin:0 16px 0 0;border-bottom:1px dotted;cursor:pointer;color:#000!important;text-decoration:none}BODY .b-userpicselector-close:active,BODY .b-userpicselector-close:hover{color:#C00!important}BODY .b-userpicselector-close:after{content:\" \";position:absolute;top:2px;right:-18px;width:16px;height:16px;margin:0;padding:0;background:url(/img/icons/popup-close.png?v=15718) no-repeat;font:0/0 serif;cursor:pointer}BODY .b-userpicselector-close:hover:after{background-position:0 -16px}#js .b-userpicselector-close:active,#js .b-userpicselector-close:hover,#js .b-userpicselector-close:link,#js .b-userpicselector-close:visited{display:block}\n/* <<< file end: stc/userpicselector.css */\n\n/*# map link was there [userpicselector.css.map] */\n');
LJ.UI.registerTemplate('templates-Form-UpicSelect', "{{if !($data.renderpics)}} <div class=\" b-userpicselector-inner {{if $data.hasdefaultuserpic}} {{if $data.hasuserpics < 6}} b-userpicselector-tiny {{if $data.hasuserpics < 5}} b-userpicselector-tiny4 {{/if}} {{if $data.hasuserpics < 4}} b-userpicselector-tiny3 {{/if}} {{/if}} {{else}} {{if $data.hasuserpics < 5}} b-userpicselector-tiny {{/if}} {{if $data.hasuserpics < 4}} b-userpicselector-tiny b-userpicselector-tiny4 {{/if}} {{/if}} \"> <div class=\"b-userpicselector-wrapper\"> <ul class=\"b-userpicselector-items\"> {{if !($data.hasdefaultuserpic)}} <li class=\"b-userpicselector-item b-userpicselector-item-nodefault\" data-name=\"\"><label for=\"u{{html $data.id}}\"><span class=\"b-userpicselector-pic\" data-pic=\"url({{html $data.lj_imgprefix}}/userpics/userpic-user.png?v=15821)\" title=\"{{html LJ.mltext(\'talk.no.default.userpic\')}}\">&nbsp;</span><span class=\"b-pseudo\">{{html LJ.mltext(\'talk.default.userpic\')}}</span> </label> </li> {{/if}} {{/if}} {{if $data.renderpics}} {{each ($value.userpics || $data.userpics)}} <li class=\" b-userpicselector-item {{if ($value.active || $data.active)}} b-userpicselector-active {{/if}}\" data-name=\"{{html ($value.keyword || $data.keyword)}}\"><label for=\"u{{html ($value.id || $data.id)}}\"><span class=\"b-userpicselector-pic\" data-pic=\"url({{html ($value.src || $data.src)}})\" title=\"{{html ($value.title || $data.title)}}\">&nbsp;</span><span class=\"b-pseudo\">{{html ($value.title || $data.title)}}</span></label> </li> {{/each}} {{/if}} {{if !($data.renderpics)}} </ul> </div> <div class=\"b-userpicselector-controls\"> {{if $data.hasuserpics >= 6}} <input type=\"search\" id=\"\" placeholder=\"{{html LJ.mltext(\"talk.searchuserpic\")}}\" class=\"b-userpicselector-keywords\" tabindex=\"31\"> {{/if}} <a href=\"{{html $data.siteroot}}/editpics.bml\" class=\"b-userpicselector-showall\" target=\"_blank\">{{html LJ.mltext(\'talk.manageuserpic\')}}</a> <a href=\"javascript:void(0)\" class=\"b-userpicselector-close b-pseudo\" tabindex=\"32\">{{html LJ.mltext(\'talk.close\')}}</a> </div> </div> {{/if}} ", 'JQuery.stat');
!function(e,t){e.widget("lj.userpicker",e.lj.basicWidget,{options:{updateDefaultUserpic:!1,useCurrentJournal:!1,classNames:{active:"b-userpicselector-active",selected:"b-userpicselector-selected",unfocus:"b-myuserpic-unfocus",loaded:"b-userpicselector-loaded",nodefaultItem:"b-userpicselector-item-nodefault",startAuth:"b-watering-trueauth-"},selectors:{nodefaultItem:".b-userpicselector-item-nodefault",active:".b-userpicselector-active",listWrapper:".b-userpicselector-wrapper",pickerControl:".b-myuserpic",pickerContainer:".b-userpicselector",userpic:".b-userpicselector-item",userpicsList:".b-userpicselector-items",currentImage:".b-myuserpic-current",currentText:".b-myuserpic-title span",imageNode:".b-userpicselector-pic",textNode:".b-pseudo",closeControl:".b-userpicselector-close",keywordInput:".b-userpicselector-keywords",commentWidget:".b-watering-comment",select:"#prop_picture_keyword"},templates:{popup:"templates-Form-UpicSelect"}},_create:function(){var t=this;return e.lj.basicWidget.prototype._create.apply(this),this._currentAuthSelected=!0,this._data=null,this._loadingSkiped=!1,this._shouldUpdateHeaderPic=!0,this.options.useCurrentJournal&&LJ.get("current_journal.is_comm")?(this._user=LJ.get("currentJournal"),this._shouldUpdateHeaderPic=!1):this._user=LJ.get("remoteUser"),LJ.Support.isMobile()?void this._fallbackToMobile():(this._cachedDimensions=[],this._visible=!1,this._suppressTargetClick=!1,this._picsLoaded=!1,this._picKeyword=LJ.get("activeuserpic")||"",this._defaultKeyword=this._picKeyword,this._defaultPicUrl=this._el("currentImage").css("background-image"),this._nodefLabel=this._el("currentImage").data("nodeflabel"),this._nodefPic=this._el("currentImage").data("nodefpic"),this._currentPicNode=null,this._keywords={},this._el("select").children().each(function(){t._keywords[this.getAttribute("value")]=!0}),this._preparePopup(),this._findNodes(),this._setupCursor(),void this._bindControls())},_augmentUserpicData:function(e){var t=this;return e.userpics?this._data=e.userpics.map(function(e){var i=e.keywords.join(", ");return{title:i,keyword:i.trim().toLowerCase(),active:i===t._defaultKeyword,id:e.id,src:e.url}}):this._data=[],this._data},_preparePopup:function(){var e={hasuserpics:LJ.get("hasuserpics"),hasdefaultuserpic:LJ.get("hasdefaultuserpic"),hasactiveuserpic:!!LJ.get("activeuserpic"),statprefix:LJ.get("statprefix"),siteroot:LJ.get("siteroot")};this._popupContent=this._tmpl("popup",e),this._popupContent.bubble({target:this._el("pickerControl"),alwaysShowUnderTarget:!0,closeOnDocumentClick:!1,classNames:{containerAddClass:"b-userpicselector"},showEffect:"fade",selectors:{closeControl:this._s("closeControl")},offset:{x:-12,y:-128}}),this._el("userpicsList",this._popupContent)},_loadPics:function(){this._lock(),LJ.Api.call("userpic.get_all_userpics",{user:this._user},function(e){this._picsLoaded=!0,this._unlock(),this._popupContent.addClass(this._cl("loaded")),this._initPics(this._augmentUserpicData(e)),this._defaultActiveUserpic||(this._defaultActiveUserpic=LJ.get("hasactiveuserpic")||LJ.get("hasdefaultuserpic")?this._popupContent.find(this._s("active")):this._popupContent.find(this._s("nodefaultItem")));var t=this._picKeyword!==this._defaultKeyword,i=this._picKeyword;this._findDefaultActive(),t&&this._findByKeyword(i),this._bindPopupControls(),this._updateUserpics(),0===this._cachedDimensions.length&&(this._cachedDimensions.cellheight=this._userpics.eq(0).outerHeight(!0),this._cachedDimensions.frameHeight=this._listWrapper.height())}.bind(this))},_initPics:function(e){var t={userpics:e,renderpics:!0};this._tmpl("popup",t).appendTo(this._userpicsList),this._userpicsImgList=this._userpicsList.find(this._s("imageNode")),this._userpics=this._userpicsList.find(this._s("userpic"))},_fallbackToMobile:function(){var e,t;e=this._el("select"),t=e.val(),this.element.bind("commentformclose userpic",function(i,s){e.val(s||t)})},_findDefaultActive:function(){return this._picsLoaded?void(this._defaultActiveUserpic.length&&this._setActiveUserpic(this._defaultActiveUserpic)):void this._setUserpic(this._defaultKeyword,this._defaultPicUrl)},_findNodes:function(){var e=this._popupContent;this._pickerContainer=e,this._el("keywordInput",e),this._el("listWrapper",e),this._el("currentImage"),this._el("currentText"),this._windowHeight=this._listWrapper.height()},_setupCursor:function(){var e=this;e._use("cursor",{target:this._el("pickerControl"),items:jQuery(),container:e._el("listWrapper"),cancel:e.onHide.bind(e,null),columns:5,select:function(t,i){e._visible&&(e._setActiveUserpic(i,!0),e.hide(),e._suppressTargetClick=!0)},hoverClass:this._cl("selected")}),e._("cursor").index(0)},_bindControls:function(){var t=this;e.lj.basicWidget.prototype._bindControls.apply(this),t.element.on("click",this._s("pickerControl"),function(e){t._pickerContainer.length>0&&t._currentAuthSelected&&!t._suppressTargetClick&&!t._el("select").attr("disabled")&&(t.show(),t._suppressNextEvent("documentClick"),t._picsLoaded||t.locked()||t._loadPics()),t._suppressTargetClick=!1,e.preventDefault()});var i=LJ.get("hasuserpics")||0;i>=6&&t.element.on("keypress",this._s("pickerControl"),function(e){if(!t._visible)return!0;var i=0;"undefined"==typeof e.which?i=e.keyCode:"number"==typeof e.which&&e.which>0&&(e.ctrlKey||e.metaKey||e.altKey||8==e.which||(i=e.which)),i&&(t._keywordInput.val(t._keywordInput.val()+String.fromCharCode(e.which)),Function.defer(function(){t._keywordInput.input().trigger("focus");var e=t._keywordInput.val().length;DOM.setSelectedRange(t._keywordInput.get(0),e,e)}))}),this._popupContent.on("click",this._s("userpic"),function(i){t._setActiveUserpic(e(this),!0),t.hide()}).on("click",this._suppressNextEvent.bind(this,"documentClick")),this._popupContent.on("bubbleshow",this.onShow.bind(this)).on("bubblehide",this.onHide.bind(this)),t.element.on("authtypechange",function(e,i){var s=t._cl("startAuth")+i.authtype;t._currentAuthSelected=t.element.hasClass(s)}).on("commentformclose",function(){t._keywordInput.val(""),t._picsLoaded&&(t._userpics.show(),t._("cursor").setData(t._userpics,0)),t._findDefaultActive()}).on("userpic",function(e,i,s){t._picsLoaded?t._findByKeyword(i):t._setUserpic(i,"url("+s+")")}),this._on("documentClick",this.hide.bind(this))},_bindPopupControls:function(){var e=this;this._keywordInput.labeledPlaceholder().input(LJ.Function.throttle(function(){e.filter(e._keywordInput.val())},this.value),100),this._listWrapper.scroll(this._updateUserpics.bind(this)),this._currentImage.blur(function(t){e._("cursor").item().removeClass(e._cl("selected"))}).focus(function(t){e._("cursor").index(0)}),this._userpicsImgList.one("activate",function(){var e=jQuery(this),t=e.data("pic");e.css("background-image",t),this.loaded=!0})},_updateUserpics:function(){var e=this._listWrapper.offset().top+this._windowHeight,t=this._userpicsImgList.filter(function(){return jQuery(this).offset().top<e+200}).trigger("activate");this._userpicsImgList=this._userpicsImgList.not(t)},_findByKeyword:function(t){if(!t)return void this._findDefaultActive();t=String(t).toLowerCase();var i=this._userpicNodes=this._pickerContainer.find(this._s("userpic")).filter(function(){var i=e(this).data("name");return i?!!String(i).split(/, */).filter(function(e){return e===t}).length:!1}).first();i.length>0?this._setActiveUserpic(i):this._findDefaultActive()},filter:function(e){var t=this;e=e.trim().toLowerCase();var i=jQuery(),s=this._("cursor").index(),r=this._("cursor").item().get(0);e.length>0?this._userpics.each(function(){var c=jQuery(this),n=c.data("name").toString().indexOf(e)>-1;c.toggle(n),n?i=i.add(c):this===r&&(s=0,c.removeClass(t._cl("selected")))}):(i=this._userpics,i.show()),this._("cursor").setData(i,s),this._updateUserpics(),this._currentImage.trigger("blur")},onShow:function(){this._visible=!0,this._picsLoaded&&this._updateUserpics(),this._listWrapper.scrollTop(0),this._currentImage.trigger("focus"),Function.defer(function(){this._currentImage.trigger("focus")}.bind(this)),this._picsLoaded&&this._("cursor").index(0)},onHide:function(e){this._visible=!1,this._pickerContainer.removeClass(this._cl("unfocus"))},_setActiveUserpic:function(e,t){var i,s,r;if(e.hasClass(this._cl("nodefaultItem"))?(s="",r=""):(i=e.find(this._s("imageNode")),s=i.css("background-image"),s&&"none"!==s||(s=i.data("pic")),r=e.find(this._s("textNode")).text()),this._setUserpic(r,s),!this._currentPicNode||this._currentPicNode.get(0)!==e.get(0)){var c=this._currentPicNode;this._currentPicNode=e,this._visible&&t?this._popupContent.one("bubblehide",function(){this._setUserpicNode(c,e)}.bind(this)):this._setUserpicNode(c,e)}},_setUserpic:function(t,i){var s,r=(null===(s=t)||void 0===s?void 0:s.split(/, */))||"",c=this,n=null;this.options.updateDefaultUserpic&&(n=this._getDataByTitle(t),n&&this._loadingSkiped?this._sendUpdateUserpicRequest(n.id):this._loadingSkiped=!0),e.each(r,function(e,t){c._keywords[t]&&c._el("select").val(t)}),r.indexOf(this._el("select").val())>=0&&(t=t||this._nodefLabel,i=i||this._nodefPic,this._picKeyword=t,this._currentImage.css("background-image",i),this._currentText.text(t))},_setUserpicNode:function(e,t){e&&e.removeClass(this._cl("active")),this._("cursor").item().removeClass(this._cl("selected")),t.addClass(this._cl("active")).prependTo(this._userpicsList),this._userpics=this._popupContent.find(this._s("userpic")),this._("cursor").setData(this._userpics,0)},hide:function(){this._popupContent.bubble("hide")},show:function(){this._popupContent.bubble("show")},_getDataByTitle:function(e){var t=this._data.filter(function(t){return t.title===e});return t.length>0?t[0]:null},_sendUpdateUserpicRequest:function(e){this.options.updateDefaultUserpic&&LJ.Api.call("userpic.set_default_userpic",{user:this._user,defaultpic:e},this._afterUserpicUpdate.bind(this))},_afterUserpicUpdate:function(t){var i;"ok"===t.result&&this._shouldUpdateHeaderPic&&("lanzelot"===LJ.get("scheme")?e("#header").find(".userpic").attr("src",t.url):(e(".b-userpic-wrap").removeClass("b-userpic-wrap-empty").find("#defaultpic").css("background-image","url('"+t.url+"')"),e(".s-userpic-wrap").removeClass("s-userpic-wrap-empty").find(".userpic").attr("src",t.url)),i=this._popupContent.find(this._s("nodefaultItem")),i.length&&i.remove())}})}(jQuery,this);
/* <<< file end: js/jquery/jquery.lj.userpicker.js */

//# map link was there [jquery.lj.userpicker.js.map]
/* >>> file start: js/jquery/jquery.lj.commentsFormToolbar.js */
//= require js/jquery/jquery.hotkeys.js
!function(t,o){t.widget("lj.commentsFormToolbar",jQuery.lj.basicWidget,{options:{additionalRoles:[],selectors:{buttons:".b-updateform-button",photoPreview:".b-updateform-bubble-photo-preview",toolbar:".b-updateform-bar",htmlTextarea:"#body"},classNames:{preloader:"b-updateform-bubble-photo-preload"}},init:{},_create:function(){this._el("toolbar"),t.lj.basicWidget.prototype._create.apply(this),this._el("buttons"),this._emptyGif=null,this._imgPreload=new Image,this._bindControls()},_bindControls:function(){var o=this;this.options.selectors;t.lj.basicWidget.prototype._bindControls.apply(this),this._on("rte_on",function(t){o.rteOn=!!t})},_checkPhotoLoad:function(t,o,e){var i=o.val().trim(),r=this,s=t.find(this.options.selectors.photoPreview);s.attr("src",this._emptyGif),0!==i.length&&(t.addClass(this.options.classNames.preloader),0!==i.length&&(this._imgPreload.src="",this._imgPreload.onload=function(){0!==r._imgPreload.src.length&&(t.removeClass(r.options.classNames.preloader),s.attr("src",r._imgPreload.src))},this._imgPreload.onerror=function(){t.removeClass(r.options.classNames.preloader)},clearTimeout(this._imgPreload.timer),this._imgPreload.timer=setTimeout(function(){r._imgPreload.src=i},200)))},attachHotkeys:function(t){t=jQuery(t);var o=function(t,o){this.insertContent(t),o.preventDefault(),o.stopPropagation()};t.bind("keydown","ctrl+b",o.bind(this,"bold")).bind("keydown","ctrl+i",o.bind(this,"italic")).bind("keydown","ctrl+u",o.bind(this,"underline"))}})}(jQuery,window);
/* <<< file end: js/jquery/jquery.lj.commentsFormToolbar.js */

//# map link was there [jquery.lj.commentsFormToolbar.js.map]
/* >>> file start: js/jquery/jquery.easing.js */
jQuery.easing.jswing=jQuery.easing.swing,jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(n,e,t,u,a){return jQuery.easing[jQuery.easing.def](n,e,t,u,a)},easeInQuad:function(n,e,t,u,a){return u*(e/=a)*e+t},easeOutQuad:function(n,e,t,u,a){return-u*(e/=a)*(e-2)+t},easeInOutQuad:function(n,e,t,u,a){return(e/=a/2)<1?u/2*e*e+t:-u/2*(--e*(e-2)-1)+t},easeInCubic:function(n,e,t,u,a){return u*(e/=a)*e*e+t},easeOutCubic:function(n,e,t,u,a){return u*((e=e/a-1)*e*e+1)+t},easeInOutCubic:function(n,e,t,u,a){return(e/=a/2)<1?u/2*e*e*e+t:u/2*((e-=2)*e*e+2)+t},easeInQuart:function(n,e,t,u,a){return u*(e/=a)*e*e*e+t},easeOutQuart:function(n,e,t,u,a){return-u*((e=e/a-1)*e*e*e-1)+t},easeInOutQuart:function(n,e,t,u,a){return(e/=a/2)<1?u/2*e*e*e*e+t:-u/2*((e-=2)*e*e*e-2)+t},easeInQuint:function(n,e,t,u,a){return u*(e/=a)*e*e*e*e+t},easeOutQuint:function(n,e,t,u,a){return u*((e=e/a-1)*e*e*e*e+1)+t},easeInOutQuint:function(n,e,t,u,a){return(e/=a/2)<1?u/2*e*e*e*e*e+t:u/2*((e-=2)*e*e*e*e+2)+t},easeInSine:function(n,e,t,u,a){return-u*Math.cos(e/a*(Math.PI/2))+u+t},easeOutSine:function(n,e,t,u,a){return u*Math.sin(e/a*(Math.PI/2))+t},easeInOutSine:function(n,e,t,u,a){return-u/2*(Math.cos(Math.PI*e/a)-1)+t},easeInExpo:function(n,e,t,u,a){return 0==e?t:u*Math.pow(2,10*(e/a-1))+t},easeOutExpo:function(n,e,t,u,a){return e==a?t+u:u*(-Math.pow(2,-10*e/a)+1)+t},easeInOutExpo:function(n,e,t,u,a){return 0==e?t:e==a?t+u:(e/=a/2)<1?u/2*Math.pow(2,10*(e-1))+t:u/2*(-Math.pow(2,-10*--e)+2)+t},easeInCirc:function(n,e,t,u,a){return-u*(Math.sqrt(1-(e/=a)*e)-1)+t},easeOutCirc:function(n,e,t,u,a){return u*Math.sqrt(1-(e=e/a-1)*e)+t},easeInOutCirc:function(n,e,t,u,a){return(e/=a/2)<1?-u/2*(Math.sqrt(1-e*e)-1)+t:u/2*(Math.sqrt(1-(e-=2)*e)+1)+t},easeInElastic:function(n,e,t,u,a){var r=1.70158,i=0,s=u;if(0==e)return t;if(1==(e/=a))return t+u;if(i||(i=.3*a),s<Math.abs(u)){s=u;var r=i/4}else var r=i/(2*Math.PI)*Math.asin(u/s);return-(s*Math.pow(2,10*(e-=1))*Math.sin((e*a-r)*(2*Math.PI)/i))+t},easeOutElastic:function(n,e,t,u,a){var r=1.70158,i=0,s=u;if(0==e)return t;if(1==(e/=a))return t+u;if(i||(i=.3*a),s<Math.abs(u)){s=u;var r=i/4}else var r=i/(2*Math.PI)*Math.asin(u/s);return s*Math.pow(2,-10*e)*Math.sin((e*a-r)*(2*Math.PI)/i)+u+t},easeInOutElastic:function(n,e,t,u,a){var r=1.70158,i=0,s=u;if(0==e)return t;if(2==(e/=a/2))return t+u;if(i||(i=a*(.3*1.5)),s<Math.abs(u)){s=u;var r=i/4}else var r=i/(2*Math.PI)*Math.asin(u/s);return 1>e?-.5*(s*Math.pow(2,10*(e-=1))*Math.sin((e*a-r)*(2*Math.PI)/i))+t:s*Math.pow(2,-10*(e-=1))*Math.sin((e*a-r)*(2*Math.PI)/i)*.5+u+t},easeInBack:function(n,e,t,u,a,r){return void 0==r&&(r=1.70158),u*(e/=a)*e*((r+1)*e-r)+t},easeOutBack:function(n,e,t,u,a,r){return void 0==r&&(r=1.70158),u*((e=e/a-1)*e*((r+1)*e+r)+1)+t},easeInOutBack:function(n,e,t,u,a,r){return void 0==r&&(r=1.70158),(e/=a/2)<1?u/2*(e*e*(((r*=1.525)+1)*e-r))+t:u/2*((e-=2)*e*(((r*=1.525)+1)*e+r)+2)+t},easeInBounce:function(n,e,t,u,a){return u-jQuery.easing.easeOutBounce(n,a-e,0,u,a)+t},easeOutBounce:function(n,e,t,u,a){return(e/=a)<1/2.75?u*(7.5625*e*e)+t:2/2.75>e?u*(7.5625*(e-=1.5/2.75)*e+.75)+t:2.5/2.75>e?u*(7.5625*(e-=2.25/2.75)*e+.9375)+t:u*(7.5625*(e-=2.625/2.75)*e+.984375)+t},easeInOutBounce:function(n,e,t,u,a){return a/2>e?.5*jQuery.easing.easeInBounce(n,2*e,0,u,a)+t:.5*jQuery.easing.easeOutBounce(n,2*e-a,0,u,a)+.5*u+t}});
/* <<< file end: js/jquery/jquery.easing.js */

//# map link was there [jquery.easing.js.map]
/* >>> file start: js/core/uaInfo.js */
!function(e){return e}(),function(){function e(){LJ.UAInfo.areMobileDeviceEventsDetected=!0,window.removeEventListener("touchmove",e),window.removeEventListener("touchstart",e)}LJ.define("LJ.UAInfo"),LJ.UAInfo.isMac=-1!==navigator.userAgent.indexOf("Mac"),LJ.UAInfo.isMobile=function(){return!!Site.isBackendMobile},document.addEventListener("DOMContentLoaded",function(){LJ.UAInfo.isMac&&document.documentElement.classList.add("mac")}),LJ.UAInfo.areMobileDeviceEventsDetected=!1,window.addEventListener("touchmove",e),window.addEventListener("touchstart",e)}();
/* <<< file end: js/core/uaInfo.js */

//# map link was there [uaInfo.js.map]
/* >>> file start: js/jquery/jquery.lj.commentform.js */
//= require js/jquery/jquery.easing.js
//= require js/core/uaInfo.js
//= require_ml comments.warning.offline
!function(e){LJ.define("LJ.Page"),LJ.Page.rte2022Form={getIsActive:function(){return!1}},LJ.Page.commentForm={lastTypeUsed:null,currentIntent:null},e.widget("lj.commentform",e.lj.basicWidget,{options:{classNames:{active:"active",startAuth:"b-watering-trueauth-",buttonDisabled:"b-ljbutton-disabled",activeComment:"b-leaf-commenting",editComment:"b-leaf-editing",controlNoId:LJ.Util.isMediusJournal()?"mdspost-comment-actions__item--noid":"b-leaf-actions-noid",formEditComment:"b-watering-editing",formEditMyComment:"b-watering-editing-mycomment",loginTypeContainerPrefix:"b-watering-user-login-",authtypePrefix:"b-watering-authtype-",authtypeAnonymous:"b-watering-authtype-anonymous",authtypeCookieuser:"b-watering-authtype-cookieuser",notfriend:"b-watering-user-notafriend",notreg:"b-watering-user-notreg",regonly:"b-watering-user-regonly",friendonly:"b-watering-user-friendonly",errorWrapperShow:"b-msgsystem-errorbox-show",commentFrozen:"b-leaf-frozen",commentScreened:LJ.Util.isMediusJournal()?"mdspost-comment--screened":"b-leaf-screened",commentSpammed:"b-leaf-spammed",firstLevelParent:LJ.Util.isMediusJournal()?"mdspost-comments-controls":"b-xylem",showSpam:"b-grove-showspam",previewVisible:"b-watering-preview-enabled"},selectors:{form:"#postform",errorWrapper:".b-msgsystem-errorbox",aside:".b-watering-aside",tail:".b-watering-arrows",toolbar:".b-updateform-bar",submitControl:LJ.Util.isMediusJournal?".b-watering-submit":".b-ljbutton-submit",submitButton:LJ.Util.isMediusJournal?".b-watering-submit [type=submit]":".b-ljbutton-submit [type=submit]",comment:"#body",subject:"[name=subject]",editid:"input[name=editid]",inputReplyto:"#replyto",inputParentTalkid:"#parenttalkid",inputViewingThread:"#viewing_thread",commentsRoot:LJ.Util.isMediusJournal()?".mdspost-comments":".b-grove",addFirstLevelControl:LJ.Util.isMediusJournal()?".mdspost-comments-controls__add":".b-addcomment",firstLevelParent:LJ.Util.isMediusJournal()?".mdspost-comments-controls":".b-xylem",firstLevelCommentContainer:LJ.Util.isMediusJournal()?".mdspost-comments__addcomment":".b-xylem-cell-add",addControl:LJ.Util.isMediusJournal()?".mdspost-comment-actions__item--reply":".b-leaf-actions-reply",addControlLink:".b-pseudo",commentContainer:LJ.Util.isMediusJournal()?".mdspost-comment":".b-leaf",twig:LJ.Util.isMediusJournal()?".mdspost-thread":".b-tree-twig",editLink:LJ.Util.isMediusJournal()?".mdspost-comment-controls__item--edit":".b-controls-edit",userpicImg:".b-leaf-userpic-inner > img",commentText:".b-leaf-article",commentSubject:".b-leaf-subject",closeControl:".b-watering-close",previewForm:".b-watering-preview",showPreviewCheckbox:"input#preview-comment",commentToEntrySubform:".b-watering-comment-to-entry"},relativeSelectors:{commentToEntryCheckbox:"[name=post_entry_comment_based]"},disabledRegex:/b-watering-user-(deleted|suspended|banned|notmail)/,focusTimeout:700,isSubjectEnabled:LJ.get("is_subject_enabled")},_create:function(){e.lj.basicWidget.prototype._create.apply(this),this._findNodes(),this._bindEvents(),this._disabled=!1,this._authToken=this._commentsRoot.data("authtoken"),this._updateFormState(),this._state=null,this._previousState=null,this._node=null,this._blurTimeout=0},_findNodes:function(){var t=this.options.selectors,i=this.options.relativeSelectors;this._inputs={editid:this.element.find(t.editid),replyTo:this.element.find(t.inputReplyto),parentTalkid:this.element.find(t.inputParentTalkid),viewingThread:this.element.find(t.inputViewingThread),previewCheck:this.element.find(t.showPreviewCheckbox)},this._tail=this.element.find(t.tail),this._tailHeight=parseInt(this._tail.css("height"),10),this._commentsRoot=e(t.commentsRoot),this._firstLevelParent=e(t.firstLevelParent).eq(0),this._firstLevelCommentContainer=e(t.firstLevelCommentContainer).eq(0),this._submitControl=this.element.find(t.submitControl),this._submitButton=this.element.find(t.submitButton),this._commentArea=this.element.find(t.comment),this._subject=this.element.find(t.subject),this._errorsWrapper=this.element.find(t.errorWrapper),this._form=this.element.find(t.form),this._toolbar=this.element.find(t.toolbar),this._preview=this.element.find(t.previewForm),this._commentToEntrySubform=this.element.find(t.commentToEntrySubform),this._commentToEntryCheckbox=this._commentToEntrySubform.find(i.commentToEntryCheckbox)},_bindEvents:function(){var t=this,i=this,n=i.options.selectors,o=i.options.classNames;this._commentArea.input(this._updateFormState.bind(this)),this._commentsRoot.delegate(n.addFirstLevelControl+":first","click",function(e){return navigator.onLine?(i.add(),void e.preventDefault()):(e.preventDefault(),void LJ.Messages.warning({body:LJ.ml("comments.warning.offline")}))}),this._commentsRoot.delegate(n.addFirstLevelControl+":gt(0)","click",function(e){return navigator.onLine?(i._scrollToForm(),i.element.is(":visible")&&i._node.get(0)===i._firstLevelCommentContainer.get(0)||i.add(),void e.preventDefault()):(e.preventDefault(),void LJ.Messages.warning({body:LJ.ml("comments.warning.offline")}))}),this._commentsRoot.delegate(n.addControl,"click",function(t){if(!navigator.onLine)return void t.preventDefault();var s=e(this),r=s.attr("data-tid");s.hasClass(o.controlNoId)&&(s=e("#"+r).find(n.addControl)),0===s.length||s.hasClass("js-action-disabled")||(i.add(s),i._commentArea.focus(),t.preventDefault())}),this.element.delegate(n.closeControl,"click",function(e){i._closeForm(),e.preventDefault()});var s=function(){var e=t.options.classNames,i=e.authtypePrefix,n=e.loginTypeContainerPrefix;t.element.hasClass("".concat(i,"user"))||t.element.find(".".concat(n,"user")).find('[name="userpost"],[name="password"]').val("")};this._form.bind("submit",function(){var e=i._commentArea.val(),t=e.indexOf("iframe")>-1;if(t){var n=document.createElement("div");n.innerHTML=e,i._commentArea.val(n.innerHTML)}setTimeout(function(){i._setDisabled(!0),i._commentArea.attr("disabled",!0)},0),s()}),LJ.Event.on("commentator/submit",function(e){e.hidden&&!Site.remoteUser&&i._closeForm(),i._updateFormState(),i._commentArea.attr("disabled",!1)}),LJ.Event.on("commentator/show",function(){i.comment(void 0,void 0,{allowToggleClose:!1})});var r=[];this._toolbar.bind("insertText",function(e,t){i._insertText(t.text,t.defaultSelection,t.insertTimeout)}).bind("terminateAction",function(){i._currentSelection=null}).commentsFormToolbar("attachHotkeys",this._commentArea),this._commentArea.bind("keydown mousedown mouseup"+(jQuery.browser.msie?"":" blur"),function(){Function.defer(function(){i._currentSelection=window.DOM.getSelectedRange(i._commentArea.get(0))})}).bind("blur",function(){i._blurTimeout=+new Date}).on("input",function(e){var i=e.target.value,n=e.target.selectionStart,o=i?i.split(" "):[],s=o.map(function(e,t,i){var o=i.slice(0,t+1).join(" ").length;return e.match(/^--?$/)&&t<i.length-1&&o===n-1?"":e}).join(" "),a=0;s!==i&&(1===Math.abs(s.length-i.length)&&(a=-1),r.push({value:i,selStart:n}),setTimeout(function(){t._commentArea[0].setSelectionRange(n+a,n+a)},0)),r.push({value:s,selStart:n+a}),0===i.length?LJ.Event.trigger("commentForm::switchToRteControl::setDisable",!1):LJ.Event.trigger("commentForm::switchToRteControl::setDisable",!0),t._commentArea.val(s)}).bind("keydown",function(e){var i=e.ctrlKey||e.metaKey;if(i&&"z"===e.key){e.preventDefault();var n=r[r.length-1]||[];n.value===t._commentArea.val()&&r.pop();var o=r.pop()||[];return t._commentArea.val(o.value),void t._commentArea[0].setSelectionRange(o.selStart,o.selStart)}}),this.element.bind("newComment",function(){jQuery.fx.off=!0,i._node&&i._node.find(n.editLink).remove(),i._commentArea.val(""),i._subject.val(""),i._closeForm(),i._commentToEntryCheckbox.prop("checked",!1),jQuery.fx.off=!1}).bind("authtypechange",function(e,t){var n=o.startAuth+t.authtype;i._currentAuthSelected=i.element.hasClass(n),i._updateFormState()}),e(document).bind("commentsUpdated",function(t,n,o){var s=i._node;s&&"unscreen"!==o&&(0===s.parent().length||s.attr("id")===n&&"expand"!==o||-1===["expand","delone","screen"].indexOf(o)&&e.comments.parent(s,n)!==!1)&&i._closeForm()}).bind("editComment",function(e,t){i.edit(t)}),this._on("commentsPage",function(){e.fx.off=!0,i.add(),i._node&&i._closeForm(),e.fx.off=!1}),LJ.Flags.isEnabled("s1comment_preview")&&this._inputs.previewCheck.change(function(e){e.target.checked?i._showPreview():i._hidePreview()}),LJ.Event.on("commentForm.submitBtn.toggleReq",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.disable;t._setDisabled(i)})},previousState:function(){return this._previousState},syncPreviousState:function(){this._previousState=this._state},updateCommentToEntrySubform:function(){this.element.hasClass(this.options.classNames.authtypeCookieuser)&&!this.element.hasClass(this.options.classNames.formEditComment)?this._commentToEntrySubform.show():this._commentToEntrySubform.hide()},_updateFormState:function(){var e=this.options.classNames,t=0===this._commentArea.val().trim().length||this._currentAuthSelected&&(this.options.disabledRegex.test(this.element.prop("className"))||this.element.hasClass(e.friendonly)&&this.element.hasClass(e.notfriend)||this.element.hasClass(e.notreg)&&(this.element.hasClass(e.regonly)||this.element.hasClass(e.friendonly)))||this.element.hasClass(e.authtypeAnonymous)&&(this.element.hasClass(e.regonly)||this.element.hasClass(e.friendonly));this._setDisabled(t),this.updateCommentToEntrySubform()},_setDisabled:function(e){e=!!e,window.operamini&&(e=!1),this._submitControl.toggleClass(this.options.classNames.buttonDisabled,e),e?this._submitButton.attr("disabled","disabled"):this._submitButton.removeAttr("disabled"),this._disabled=e,this.element.trigger("commentformdisable",this._disabled)},_insertText:function(e,t,i){var n,o,s,r=this._commentArea[0].value,a=this._currentSelection,l="{posifempty}",m=!1;if(t=t||"",!a||i-this._blurTimeout>this.options.focusTimeout&&!this._commentArea.is(":focus"))n=r+e.supplant({caret:t}),o=n.length,m=!0;else{var c=r.substring(a.start,a.end),d=r.substring(0,a.start),h=r.substring(a.end);0===c.length&&(c=t),0===c.length&&(m=!0),c=e.supplant({caret:c}),m||(c=c.supplant({posifempty:""})),n=d+c+h,o=a.start+c.length}m&&(s=n.indexOf(l))>=0&&(o=s),n=n.replace(l,""),this._commentArea.val(n);var u=this._commentArea.get(0);window.DOM.setSelectedRange(u,o,o),this._currentSelection=null,this._commentArea.focus(),this._updateFormState()},_scrollToForm:function(){var e=this._commentsRoot.offset().top-parseInt(this._commentsRoot.css("margin-top"),10);return jQuery("html, body").animate({scrollTop:e}),this},_setOption:function(e,t){var i=this.options,n=i.classNames,o=n.active;switch(e){case"activeControl":i.activeControl&&i.activeControl.removeClass(o),t&&t.addClass(o)}i[e]=t},_setCommentPending:function(e,t){this.element.trigger("commentpending",[e,t])},_isInState:function(e,t){return this._state===e&&this._node&&t.get(0).id===this._node.get(0).id},_closeForm:function(){var e=this,t=this.options,i=this.options.classNames,n=this._node,o=function(){e._inputs.replyTo.val("0"),e._inputs.parentTalkid.val("0"),e._inputs.editid.val("0"),e.element.data("parenttalkid",null),e._setOption("activeControl",null),e._previousState=e._state,e._state=null,e._node&&e._node.removeClass(i.activeComment),e._node=null,e._errorsWrapper.removeClass(i.errorWrapperShow)};this._subject.val(""),this._commentArea.val(""),LJ.Event.trigger("commentForm.clearReq"),t.activeControl&&!t.activeControl.hasClass(t.classNames.firstLevelParent)&&t.activeControl.find(t.selectors.addControlLink).html(Site.ml_text["talk.replytothis"]),n&&n.removeClass(i.editComment),this.element.removeClass(i.formEditComment).removeClass(i.formEditMyComment),this.hide(o,null)},show:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this,n=jQuery.comments.skipAnimation;if("skipAnimation"in t&&(n=t.skipAnimation),this.element.css({display:"block",height:""}),n)this._fixIEProblemsShow(),this.element.css({opacity:""}),e&&e(),this.element.trigger("commentformopen");else{var o=this.element.height();this._tail.css({height:"",top:""}),this._tailHeight=parseInt(this._tail.css("height"),10),this._tail.css({height:"-="+this._tailHeight,top:"+="+this._tailHeight}).animate({height:"+="+this._tailHeight,top:"-="+this._tailHeight},250),this.element.css({opacity:0,height:"1px"});var s,r=this.element.offset().top,a=jQuery("html, body"),l=jQuery(window),m=l.height(),c=l.scrollTop(),d=c+m-o-jQuery("#ljtime").height(),h=!1;c>d&&(d=c),s=-d+r,r>d&&(h=!0),this.element.animate({height:o,opacity:1},{duration:500,easing:"easeOutExpo",step:function(e,t){h&&"opacity"===t.prop&&a.scrollTop(c+s*e)},complete:function(){i.element.removeAttr("style").css("display","block"),e&&e(),i.element.trigger("commentformopen")}})}},_fixIEProblemsShow:function(){if(e.browser.msie&&!(parseInt(e.browser.version,10)>8)){this._aside||(this._aside=this.element.find(this.options.selectors.aside));var t=this._aside.get(0),i=t.parentNode,n=i.clientWidth;t.style.marginLeft=-1*(n-parseInt(i.currentStyle.paddingLeft,10)-parseInt(i.currentStyle.paddingRight,10))}},hide:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this,s=jQuery(document);if(this.element.trigger("commentformclose"),i=i||this.options.activeControl){0===i.parent().length?i=jQuery("#"+this._node.attr("id")):i.hasClass(this.options.classNames.firstLevelParent)||(i=i.closest(this.options.selectors.commentContainer));var r=jQuery.comments.skipAnimation,a=!0;if("skipAnimation"in n&&(r=!!n.skipAnimation),"allowScroll"in n&&(a=!!n.allowScroll),this.element[0]&&this.element[0].parentNode&&"block"===this.element[0].style.display){var l=s.scrollTop(),m=l+e(window).height(),c=this.element.offset().top,d=c+this.element.outerHeight(),h=i.offset().top-l;if(l>d||c>m||r){if(this.element.detach(),a){var u=i.offset().top-h;Math.abs(u-l)>1&&s.scrollTop(u)}t&&t()}else{var p=this.element.height();this.element.css({height:p}),this._tail.animate({height:"-="+this._tailHeight,top:"+="+this._tailHeight},200),this.element.animate({height:0,opacity:0},{duration:300,easing:"easeOutExpo",step:function(){s.scrollTop(i.offset().top-h)},complete:function(){s.scrollTop(i.offset().top-h),o.element.css("display",""),t&&t()}})}}else t&&t();LJ.Flags.isEnabled("s1comment_preview")&&this._hidePreview()}},add:function(e){var t=this.options,i=this.comment("add",e),n=LJ.Page.commentForm.currentIntent;if(LJ.Page.commentForm.currentIntent="addNew",t.activeControl&&!t.activeControl.hasClass(t.classNames.firstLevelParent)&&t.activeControl.find(t.selectors.addControlLink).html(Site.ml_text["talk.replytothis"]),i){this._inputs.editid.val(""),this._submitButton.html(Site.ml_text["talk.postcomment"]),e&&e.find(t.selectors.addControlLink).html(Site.ml_text["talk.answer"]);var o=!Site.page.allow_rte2022||LJ.UAInfo.areMobileDeviceEventsDetected||"classic"===LJ.Page.commentForm.lastTypeUsed;if(o){var s=!!this._commentArea.val();return s&&LJ.Event.trigger("commentForm::switchToRteControl::setDisable",!0),void LJ.Event.trigger("commentform::classic::makeActive",{value:""})}"editExisting"===n&&LJ.Page.rte2022Form.resetContent(),LJ.Page.rte2022Form.makeActive()}this._updateFormState()},edit:function(t){function i(e,i,n,a,l){var m=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},c=m.rteContent;o.comment("edit",s),t.toggleClass(o.options.classNames.editComment,e),o.element.toggleClass(o.options.classNames.formEditComment,e),Site.remoteUser!==Site.currentJournal&&o.element.toggleClass(o.options.classNames.formEditMyComment,e),e&&(o._inputs.editid.val(r),o._commentArea.val(i),o._subject.val(l),o._submitButton.html(Site.ml_text["talk.editcomment"]),o.element.trigger("userpic",[n,a]),o._updateFormState(),c?LJ.Event.trigger("commentForm::rte::makeActive",{editorState:null===c||void 0===c?void 0:c.children}):(LJ.Event.trigger("commentForm::switchToRteControl::setDisable",!0),LJ.Event.trigger("commentform::classic::makeActive",{value:i})))}function n(i){o._setCommentPending(t,!0),e.getJSON(LiveJournal.getAjaxUrl("get_comment_source",{thread:r,journal:Site.current_journal.username})).success(function(e){o._setCommentPending(t,!1),"ok"===e.status?i&&i(e.message,e.userpic_keyword,t.find(o.options.selectors.userpicImg).attr("src"),{rteContent:e.content}):alert(e.message)}).error(function(){setTimeout(n.bind(null,i),200)})}if(t){LJ.Page.commentForm.currentIntent="editExisting";var o=this,s=t.find(this.options.selectors.editLink),r=t.attr("id").substr(1);if(this.options.activeControl&&this.options.activeControl.find(this.options.selectors.addControlLink).html(Site.ml_text["talk.replytothis"]),this._isInState("edit",t))i(!1);else{var a=t.find(this.options.selectors.commentSubject).text();n(function(e,t,n,o){i(!0,e,t,n,a,o)})}}},comment:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this,s=!0;"allowToggleClose"in n&&(s=!!n.allowToggleClose);var r;r=t?t:o._state?o._state:"add";var a,l,m,c=this.options.selectors,d=this.options.classNames,h=function(e){e[0].parentNode.appendChild(o.element[0])},u=function(t,i){o._setOption("activeControl",i),o._inputs.replyTo.val(o.ditemid),o._inputs.parentTalkid.val(o.ditemid),o.element.data("parenttalkid",t.attr("id")||null),h(t),o.show(null,{skipAnimation:e.comments.mustFocusSynchronously}),"edit"===o._state&&"edit"!==r&&(o._commentArea.val(""),o._subject.val("")),o._state=r,o._node&&o._node.removeClass(d.activeComment),o._node=a,o._node.addClass(d.activeComment),e.comments.mustFocusSynchronously?(o._commentArea.blur(),o._commentArea.focus()):Function.defer(function(){o._commentArea.focus()}),o._updateFormState()};if(i){if(a=i.closest(c.commentContainer),this.ditemid=Math.floor(parseInt(a.prop("id").substr(1),10)/256),a.hasClass(d.commentFrozen)||a.hasClass(d.commentSpammed)&&!this._commentsRoot.hasClass(d.showSpam))return!1;m=this._inputs.viewingThread.data("thread"),m&&this._inputs.viewingThread.val(m),"add"===r&&this.options.isSubjectEnabled&&(l=o._getSubject(a),0!==l.length&&this._subject.val("RE: "+l.replace(/^RE:\s*/,"")))}else a=this._firstLevelCommentContainer,i=this._firstLevelParent,m=this._inputs.viewingThread.val(),this._inputs.viewingThread.val("").data("thread",m),this.ditemid="0",h=function(e){o.element.appendTo(e)};var p=r&&this._isInState(r,a);return p?s?("edit"===this._state&&(this._commentArea.val(""),this._subject.val("")),this._closeForm(),!1):(o._commentArea.blur(),o._commentArea.focus(),!0):(this._node&&this._node.removeClass(d.editComment),this.hide(u.bind(null,a,i),i,{allowScroll:!e.comments.scrollIsBugged,skipAnimation:!0}),this.element.removeClass(d.formEditComment).removeClass(d.formEditMyComment),!0)},_getSubject:function(e){var t=e.data("subject");return"undefined"!=typeof t&&null!==t||(t=""),String(t).trim()},_showPreview:function(){var e=this.options.classNames,t=this._preview,i=this._commentArea,n=function(){LJ.Api.call("comment.preview",{body:i.val()},function(i){t.html(i.preview),t.addClass(e.previewVisible),LJ.Event.trigger("social:widgets:parse")})}.bind(this),o=LJ.Function.debounce(n,1e3);this.previewInputHandler=o,i.val()&&n(),i.on("keyup paste",this.previewInputHandler),LJ.Event.on("contentInsert",o)},_hidePreview:function(){this._preview.html(""),this.previewInputHandler&&this._commentArea.off("keyup paste",null,this.previewInputHandler),this._preview.removeClass(this.options.classNames.previewVisible),this._inputs.previewCheck.attr("checked",!1),LJ.Event.off("contentInsert")}})}(jQuery);
/* <<< file end: js/jquery/jquery.lj.commentform.js */

//# map link was there [jquery.lj.commentform.js.map]
/* >>> file start: js/jquery/jquery.lj.commentsOperations.js */
function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _maybeArrayLike(e,t,o){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var n=t.length;return _arrayLikeToArray(t,void 0!==o&&n>o?o:n)}return e(t,o)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){return"undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0}function _arrayWithoutHoles(e){return Array.isArray(e)?_arrayLikeToArray(e):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);t>o;o++)n[o]=e[o];return n}
LJ.UI.registerTemplate('templates-Widgets-deletecomment', "<div class=\"deletecomment\"> <h3 class=\"deletecomment-header\"> {{html LJ.mltext(\'comment.delete.deleting\')}} </h3> <div class=\"deletecomment-items\"> {{if !($data.isSpamBtnPopup)}} <label class=\" deletecomment-item deletecomment-item-delete \" > <input type=\"checkbox\" name=\"delete\" tabindex=\"100\" class=\"deletecomment-checkbox\" checked disabled > <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comment.delete.q\')}} </span> </label> {{if $data.canBan}} <label class=\" deletecomment-item deletecomment-item-ban \" > <input type=\"checkbox\" name=\"ban\" tabindex=\"100\" class=\"deletecomment-checkbox\" {{if $data.markSpam}} checked disabled {{/if}} > <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comment.ban.user\', \'username\', $data.author)}} </span> </label> {{/if}} {{/if}} {{if $data.isSpamBtnPopup}} <label class=\" deletecomment-item deletecomment-item-multipunish \" > <input type=\"checkbox\" name=\"multipunish\" tabindex=\"100\" class=\"deletecomment-checkbox\" checked > <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comments.spam_btn_popup.multipunish\')}} </span> </label> <label class=\" deletecomment-item deletecomment-item-multipunish-b \" > <input type=\"checkbox\" name=\"multipunishB\" tabindex=\"100\" class=\"deletecomment-checkbox\" > <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comments.spam_btn_popup.multipunish_b\')}} </span> </label> {{/if}} {{if $data.canDelThread}} <label class=\" deletecomment-item deletecomment-item-sub \" > <input type=\"checkbox\" name=\"delthread\" tabindex=\"100\" class=\"deletecomment-checkbox\" > <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comment.delete.all.sub\')}} </span> </label> {{/if}} {{if $data.canDelAuthor}} <label class=\" deletecomment-item deletecomment-item-author \" > <input type=\"checkbox\" name=\"delauthor\" tabindex=\"100\" class=\"deletecomment-checkbox\" > <span class=\"deletecomment-label\"> {{if $data.author == $data.user}} {{html LJ.mltext(\'comment.delete.all.my\')}} {{else}} {{html LJ.mltext(\'comment.delete.all.author\', \'author\', $data.author)}} {{/if}} </span> </label> {{/if}} {{if $data.superBanFlag}} {{if $data.canBan}} <label class=\" deletecomment-item deletecomment-item-everywhere \" > <input type=\"checkbox\" name=\"deleverywhere\" tabindex=\"100\" class=\"deletecomment-checkbox\" > <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comment.delete.all.everywhere\', \'author\', $data.author)}} </span> </label> {{/if}} {{/if}} {{if $data.showTrollProtectionOption}} <label class=\"deletecomment-item\"> <input type=\"checkbox\" name=\"hatespeech_on\" tabindex=\"100\" class=\"deletecomment-checkbox\" > <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comment.trolls_protection\')}} </span> </label> {{/if}} {{if !$data.isOwnComment}} <label class=\"deletecomment-item\"> <span class=\"deletecomment-label\"> {{html LJ.mltext(\'comment.personal_hatespeech\')}} </span> </label> {{/if}} </div> <div class=\"deletecomment-buttons\"> <button type=\"submit\" tabindex=\"100\" class=\" b-flatbutton b-flatbutton-simple b-flatbutton-red delete-comment-button \" > {{if $data.markSpam}} {{html LJ.mltext(\'comment.delete.delete.spam\')}} {{else}} {{html LJ.mltext(\'comment.delete.delete\')}} {{/if}} </button> </div> </div> ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-Comments-Popups-screen', "<div> <h3> {{html LJ.mltext(\'comment.screen_popup.title\')}} </h3> <div> <label> <input type=\"checkbox\" name=\"screen\" tabindex=\"100\" class=\"\" checked disabled > <span> {{html LJ.mltext(\'comment.screen_popup.options.basic_screen\')}} </span> </label> <label style=\" display: block; \" > <input type=\"checkbox\" name=\"mark_as_hate_speech\" tabindex=\"100\" > <span> {{html LJ.mltext(\'comment.screen_popup.options.mark_as_hate_speech\')}} </span> </label> </div> <div> <button type=\"submit\" tabindex=\"100\" class=\" b-flatbutton b-flatbutton-simple b-flatbutton-red \" > {{html LJ.mltext(\'comment.screen_popup.submit\')}} </button> </div> </div> ", 'JQuery.stat');
//= require_ml comment.screen_popup.title
//= require_ml comment.screen_popup.options.basic_screen
//= require_ml comment.screen_popup.options.mark_as_hate_speech
//= require_ml comment.screen_popup.submit
//= require_ml comments.spam_btn_popup.multipunish
//= require_ml comments.spam_btn_popup.multipunish_b
//= require_ml comments.warning.offline
!function(e,t){e.widget("lj.commentsOperations",jQuery.lj.basicWidget,{options:{selectors:{links:"a:not(.b-controls-track)",checkboxes:"input[type=checkbox]",comment:LJ.Util.isMediusJournal()?".mdspost-comment":".b-leaf",ctrlPopupClose:"button"},classNames:{replyLink:LJ.Util.isMediusJournal()?"mdspost-comment-actions__item--reply":"b-leaf-actions-reply",expandChildsActionItem:LJ.Util.isMediusJournal()?"mdspost-comment-actions__item--expandchilds":"b-leaf-actions-expandchilds",expandActionItem:LJ.Util.isMediusJournal()?"mdspost-comment-actions__item--expand":"b-leaf-actions-expand",collapseActionItem:LJ.Util.isMediusJournal()?"mdspost-comment-actions__item--collapse":"b-leaf-actions-collapse",alwaysShowControls:"b-leaf-herbarium",controlsContainer:"mdspost-comment-controls",deleteClass:LJ.Util.isMediusJournal()?"mdspost-comment-controls__button--delete":"b-leaf-deleting",editLink:LJ.Util.isMediusJournal()?"mdspost-comment-controls__button--edit":"b-controls-edit",ctrlPopup:"b-leaf-deleting-bubble",processing:"b-leaf-processing",bestComment:LJ.Util.isMediusJournal()?"mdspost-comment-controls__button--best":"b-controls-best",bestCommentCancel:LJ.Util.isMediusJournal()?"mdspost-comment-controls__button--cancel_best":"b-controls-cancel_best"},templates:{deleteCommentPopupForm:"templates-Widgets-deletecomment",screenCommentPopupForm:"templates-Comments-Popups-screen"}},_create:function(){e.lj.basicWidget.prototype._create.apply(this);var t=location.href.match(/(\d+)\.html/);this._itemid=t&&t[1],this._authToken=this.element.data("authtoken"),this._ctrlPopup=jQuery("<div/>").bubble({classNames:{containerAddClass:this.options.classNames.ctrlPopup},alwaysShowUnderTarget:!0,arrowWidth:"auto"}),this._ctrlPopupCallback=null,this._bindControls()},_bindControls:function(){var t=this,o=this.options.selectors,n=this.options.classNames;e.lj.basicWidget.prototype._bindControls.apply(this);this._ctrlPopup[0];this.element.bind("commentpending",function(e,o,n){t._pending(o,n)}),LJ.Event.on("social:widgets:parse",function(){var o=LiveJournal.parseGetArgs()["delete"],n="delete",r="delcomment",s=e(".b-popup"),a=e("#t"+o+" .b-leaf-controls"),i=e("#t"+o+" .b-controls-delete")[0],l=e("#t"+o+" .mdspost-comment-controls"),m=e("#t"+o+" .mdspost-comment-controls__button--delete")[0],c=!1;if(!o)return!1;var u=setInterval(function(){"complete"===document.readyState&&(clearInterval(u),m?t[n](m,r,l,c):t[n](i,r,a,c))},100);LJ.Event.trigger("comment/delete"),o&&e(s).addClass("b-popup--email")}),this.element.delegate("a.b-controls-track","click",function(e){navigator.onLine||(e.preventDefault(),LJ.Messages.warning({body:LJ.ml("comments.warning.offline")}))}),this.element.delegate(o.links,"click",function(e){var r=jQuery(this).closest(o.comment);if(0!==r.length){if(r.hasClass(t.options.classNames.processing))return void e.preventDefault();var s=!!this.closest(".".concat(t.options.classNames.collapseActionItem)),a=!!this.closest(".".concat(t.options.classNames.expandChildsActionItem,", .").concat(t.options.classNames.expandActionItem)),i=this.className.indexOf("permalink")>-1||this.className.indexOf("comment-time--ctime")>-1,l=LJ.PWA.getIsInPWA()&&(s||a);if(!navigator.onLine&&!l){e.preventDefault();var m=!i;return void(m&&LJ.Messages.warning({body:LJ.ml("comments.warning.offline")}))}var c=this.href.match(/(\w+)\.bml/),u=c&&c[1],p="",d=this,h=!1;if(this.className.indexOf(n.editLink)>-1)return t.element.trigger("editComment",[r]),void e.preventDefault();switch(-1!==this.className.indexOf(n.bestComment)&&(p="bestComment",u="set_best"),-1!==this.className.indexOf(n.bestCommentCancel)&&(p="bestComment",u="unset_best"),this.className.includes("-embed")&&(p="showEmbedPopup",u="showEmbedPopup"),u){case"delcomment":p="delete",h=e.shiftKey,-1!==this.href.indexOf("spam=1")&&(u="markAsSpam");break;case"talkscreen":u=LiveJournal.parseGetArgs(this.href).mode,p="moderate";break;case"spamcomment":p="moderate";break;case"content_flag":p="moderate"}if(p){e.preventDefault();var b=jQuery(this).closest(".".concat(t.options.classNames.controlsContainer));b.css({display:"inline-block"}),setTimeout(function(){t[p](d,u,r,h),b.css({display:""})},0)}}});var r,s,a,i,l,m,c,u=function(e){return e.length>0&&e.attr("checked")},p=this;this._ctrlPopup.delegate(o.ctrlPopupClose,"click",function(){t._ctrlPopup.bubble("hide"),t._ctrlPopupCallback&&t._ctrlPopupCallback()}).bind("bubbleshow",function(){var e=t._ctrlPopup.bubble("option","target").closest(o.comment);e.addClass(n.alwaysShowControls),r=t._ctrlPopup.find("[name=delete]"),a=t._ctrlPopup.find("[name=delthread]"),s=t._ctrlPopup.find("[name=delauthor]"),i=t._ctrlPopup.find("[name=deleverywhere]"),l=t._ctrlPopup.find("[name=ban]"),m=t._ctrlPopup.find(o.ctrlPopupClose),c=t._ctrlPopup.find("[name=hatespeech_on]")}).bind("bubblehide",function(){var r=LiveJournal.parseGetArgs()["delete"],s=(e("#t"+r+" .mdspost-comment-controls"),t._ctrlPopup.bubble("option","target").closest(o.comment));s.removeClass(n.alwaysShowControls).removeClass(n.deleteClass)}).delegate(o.checkboxes,"click",function(){this===i[0]&&u(i)&&s.attr("checked",!0),this!==s[0]||u(s)||i.attr("checked",!1),this===c[0]&&u(c)&&c.attr("value",1),this!==c[0]||u(c)||c.removeAttribute("value"),p.render()})},render:function(){var e=this._ctrlPopup[0],t=e.querySelector("button[type='submit']"),o=_maybeArrayLike(_toConsumableArray,e.querySelectorAll("input")).filter(function(e){return e.checked});t.disabled=0===o.length},_pending:function(e,t){e.toggleClass(this.options.classNames.processing,!!t)},_getComment:function(e){return"object"!==_typeof(e)&&(e=jQuery(e)),0!==e.length?{node:e,ditemid:e.prop("id").substr(1),username:e.data("username"),displayname:e.data("displayname")}:void 0},_showDeletePopup:function(o,n,r){var s=this,a=LJ.get("remoteUser"),i=LJ.get("remote_is_maintainer"),l=jQuery(t),m=l.scrollTop();return function(e){return e}(),a?(s._ctrlPopup.html(s._tmpl("deleteCommentPopupForm",{ditemid:r.ditemid,author:r.displayname||"",isOwnComment:a===r.username,user:a,remoteIsPremiumUser:!!Site.remote.is_paid,markSpam:"markAsSpam"===n,isSpamBtnPopup:"markAsSpam"===n,canBan:r.username&&r.username!==a&&i,canDelThread:e.comments.hasChildren(r.node)&&i,superBanFlag:LJ.Flags.isEnabled("superban_step2"),canDelAuthor:r.username&&i,showTrollProtectionOption:!Site.remote.trolls_protection,personalHateFilterSettingOn:!!Site.remote.hatespeech_filter})),this._ctrlPopupCallback=function(){r.props=[],s._ctrlPopup.find(":checkbox:checked").each(function(){r.props.push(this.name)}),s._removeComment(r)},r.node.addClass(this.options.classNames.deleteClass),s._ctrlPopup.bubble("option","target",jQuery(o)).bubble("option","name","deleteBubble").bubble("show"),LJ.Util.isMediusJournal()&&jQuery("body").hasClass("iphone")&&l.width()<=650&&LJ.Event.on("bubble:popup:hide:deleteBubble",function c(){setTimeout(function(){l.scrollTop(m),LJ.Event.off("bubble:popup:hide:deleteBubble",c)})}),void this.render()):!0},showScreenPopup:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.actionBntEl,o=e.commentData,n=e.commentEl,r=this,s=LJ.get("remoteUser");o&&s&&(r._ctrlPopup.html(r._tmpl("screenCommentPopupForm",{})),this._ctrlPopupCallback=function(){var e=[];_maybeArrayLike(_toConsumableArray,r._ctrlPopup[0].querySelectorAll("input[type=checkbox]")).forEach(function(t){t.checked&&e.push(t.name)});var s=LiveJournal.getAjaxUrl("talkscreen",LiveJournal.parseGetArgs(t.href)),a={confirm:"Y",lj_form_auth:this._authToken};s+="&format=json",e.includes("mark_as_hate_speech")&&(s+="&hatespeech=1"),this._pending(n,!0),jQuery.post(s,a,function(e){if("ok"!==e.status)throw new Error(e.message);r.element.trigger("refreshThread",[o.ditemid,!1,"talkscreen"])},"json")},o.node.addClass(this.options.classNames.deleteClass),r._ctrlPopup.bubble("option","target",jQuery(t)).bubble("option","name","deleteBubble").bubble("show"))},_banUser:function(o,n){var r=function(e,r){jQuery.post(LiveJournal.getAjaxUrl("changerelation"),{target:o,action:"setBan",auth_token:e}).success(function(){t.ContextualPopup&&t.ContextualPopup.cleanCache(r),n&&n()})};e.getJSON(LiveJournal.getAjaxUrl("ctxpopup"),{user:o,mode:"getinfo"}).success(function(e){e.setBan_authtoken&&r(e.setBan_authtoken,[String(e.userid),e.username,e.url_userpic])})},_removeComment:function(e){var t=this,o=LiveJournal.getAjaxUrl("delcomment",LiveJournal.parseGetArgs(e.postLink)),n={confirm:"1",lj_form_auth:this._authToken,format:"json"},r=!1,s=!1;e.props&&e.props.forEach(function(e){return"multipunish"===e?(n.spam="1",n["delete"]="1",void(s=!0)):"multipunishB"===e?(n.hatespeech="1",n["delete"]="1",void(s=!0)):void("ban"!==e?(n[e]="1",s=!0):r=!0)}),this._pending(e.node,!0),r&&(Site.current_journal.is_comm?n.ban=1:this._banUser(e.node.data("username"),function(){s||t.element.trigger("refreshThread",[e.ditemid,!0,"delmany"])})),s&&jQuery.post(o,n,function(o){var r="";if(n.delauthor&&(r=e.node.data("username")),"ok"===o.status){var s=e.ditemid?e.ditemid:LiveJournal.parseGetArgs()["delete"];t.element.trigger("deleteComment",[s,n.delthread,r]),LJ.Event.trigger("comment/delete")}else alert(o.message)},"json")},"delete":function(e,t,o,n){var r=this._getComment(o);r&&(r.postLink=e.href,n?(r.props=["delete"],this._removeComment(r)):this._showDeletePopup(e,t,r))},bestComment:function(e,t,o){var n=this._getComment(o),r=this;n&&(this._pending(o,!0),LJ.Api.call("comment."+t,{journalid:LJ.get("journal.id"),itemid:this._itemid,talkid:n.ditemid},function(e){e.error&&(alert(e.error.message),location.reload()),r.element.trigger("refreshThread",[n.ditemid,!0,t])}))},moderate:function(e,t,o){var n=this._getComment(o),r=this;if(n){if("content_flag"===t)return LJ.Misc.LJReportPopover.setComplaintData(LJ.get("journal.id"),n.ditemid,"comment"),void LJ.Misc.LJReportPopover.show({anchorNode:e});var s="spamcomment"===t?"spamcomment":"talkscreen",a=LiveJournal.getAjaxUrl(s,LiveJournal.parseGetArgs(e.href)),i={confirm:"Y",lj_form_auth:this._authToken};a+="&format=json",this._pending(o,!0),jQuery.post(a,i,function(e){if("ok"!==e.status)throw new Error(e.message);return"spamcomment"===t?void r.element.trigger("removeFromDOM",[n.ditemid,t]):void r.element.trigger("refreshThread",[n.ditemid,!t.match(/(un)?freeze/),t])},"json")}},showEmbedPopup:function(e,t,o){var n=this._getComment(o);n&&LJ.Misc.CommentEmbedPopover.doCopy({journal:LJ.get("journal.username"),postId:LJ.get("entry.ditemid"),commentId:n.ditemid})}})}(jQuery,window);
/* <<< file end: js/jquery/jquery.lj.commentsOperations.js */

//# map link was there [jquery.lj.commentsOperations.js.map]
/* >>> file start: js/jquery/jquery.lj.commentsMassActions.js */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};
//= require js/jquery/jquery.hotkeys.js
//= require_ml comments.warning.offline
!function(e,t){e.widget("lj.commentsMassActions",jQuery.lj.basicWidget,{options:{selectors:{form:"#multiform",massActions:".b-massaction",massActionsMobile:".b-massaction-mobile",ljButtons:".b-massaction .b-ljbutton button",ljButtonsMobile:".b-massaction-mobile .b-ljbutton button",massActionsCheckAll:".b-massaction-checkall input",checkboxes:LJ.Util.isMediusJournal()?".js-comment-checkbox":".b-leaf-actions-checkbox",checkedComments:LJ.Util.isMediusJournal()?".js-comment-checkbox:checked":".b-leaf-actions-checkbox:checked",links:"a",comment:LJ.Util.isMediusJournal()?".mdspost-comment":".b-leaf",alivedComments:LJ.Util.isMediusJournal()?".mdspost-comment:not(.mdspost-comment--deleted)":".b-leaf:not(.b-leaf-deleted) ",firstLevel:LJ.Util.isMediusJournal()?".mdspost-thread--level-1":".b-tree-twig-1",twig:LJ.Util.isMediusJournal()?".mdspost-thread":".b-tree-twig",twigSelected:".b-tree-twig-selected",massOperationsAnchor:".b-massaction-anchor",ljtimes:LJ.Flags.isEnabled("homepage_v3")?".b-discoverytimes-wrapper":"#ljtime",ditemid:"#ditemid",error:".b-massaction-error"},classNames:{hidden:LJ.Util.isMediusJournal()?"mdspost-comments--3comments":"b-grove-3comments",isAnyChecked:LJ.Util.isMediusJournal()?"mdspost-comments--checked":"b-grove-checked",massActionsFixed:"b-massaction-fixed",commentSelected:"b-leaf-selected",twigSelected:"b-tree-twig-selected",preload:"b-massaction-processing",error:"b-massaction-problems"}},_create:function(){e.lj.basicWidget.prototype._create.apply(this);var t=this.options.selectors;this._authToken=this.element.data("authtoken"),this._massActions=this.element.find(t.massActions),this._massActionsCheckAll=this.element.find(t.massActionsCheckAll),this._massActionsAnchor=this.element.find(t.massOperationsAnchor),this._massActionsHeight=this._massActionsAnchor.height()||0,this._ljtimes=jQuery(t.ljtimes),this._ditemid=this.element.find(t.ditemid).val(),this._form=this.element.find(t.form),this._buttons=this.element.find(t.ljButtons),this._hidden=this.element.hasClass(this.options.classNames.hidden),LJ.Event.on("comment/delete",this._checkVisibility.bind(this)),this._setActive(!1),this._bindControls()},_bindControls:function(){var s=this,i=this,n=this.options.selectors;e.lj.basicWidget.prototype._bindControls.apply(this),this.element.delegate(n.checkboxes,"click",function(e){if(!navigator.onLine)return void e.preventDefault();var t=jQuery(this),s=this.checked;i._markChecked(t,s),LJ.Util.isMediusJournal()&&(t=t.closest(n.comment).find(n.checkboxes)),Function.defer(i._updateBoxes.bind(i),t,s);var o=i.element&&i.element.find(i.options.selectors.alivedComments).length||0;s?(i.element.addClass(i.options.classNames.isAnyChecked),i._hidden=!1):(3>o&&(i.element.addClass(i.options.classNames.hidden),i._hidden=!0),i.element.removeClass(i.options.classNames.isAnyChecked)),i._setActive(!0)}),this._el("ljButtons").on("click",function(e){i._massAction(this.getAttribute("data-value")),e.preventDefault()}),this._el("ljButtonsMobile").on("click",function(e){var t=this.getAttribute("data-value").toLowerCase();"collapse-all"===t&&i.collapseAll(),"expand-all"===t&&i.expandAll(),e.preventDefault()}),this._massActionsCheckAll.click(function(e){return navigator.onLine?void Function.defer(i._updateBoxes.bind(i),i.element.find(n.checkboxes),this.checked):void e.preventDefault()}),jQuery(t).bind("scroll resize",this._checkMassActionsPanelPosition.bind(this)),this.element.bind("commentsUpdated",this._updateMassActionsPanel.bind(this,!1)).bind("newComment",this._checkVisibility.bind(this)),jQuery(document).bind("keyup","alt+ctrl++",this.expandAll.bind(this)).bind("keyup","alt+ctrl+-",this.collapseAll.bind(this));var o=function(){s.element.find(n.checkboxes).attr("disabled",navigator.onLine?null:!0),s._massActionsCheckAll.attr("disabled",navigator.onLine?null:!0)};o(),t.addEventListener("online",o),t.addEventListener("offline",o)},_checkVisibility:function(e){e=e||{},Function.defer(function(){var t=e.type,s=this.element&&this.element.find(this.options.selectors.alivedComments).length||0,i=this.element&&this.element.find(this.options.selectors.checkedComments).length||0;t||(s-=1,t="deleteComment"),t&&s>=3?(this.element.removeClass(this.options.classNames.hidden),this._hidden=!1):"deleteComment"!==t&&i||s>=3?(this.element.addClass(this.options.classNames.isAnyChecked),this._hidden=!1):(this.element.addClass(this.options.classNames.hidden),this._hidden=!0,this.element.removeClass(this.options.classNames.isAnyChecked))}.bind(this))},_setPending:function(e){this._buttons.attr("disabled",!!e),this.element.toggleClass(this.options.classNames.preload,!!e),e&&this._massActions.removeClass(this.options.classNames.error)},_setActive:function(e){this._panelFixed=!!e,this._buttons.attr("disabled",!e)},_findTopChecked:function(){var t,s=this.options.selectors,i=this.element.find(s.twigSelected),n=0,o=jQuery();return i.each(function(){var i=jQuery(this),l=e.comments.level(i);n&&l>n&&t&&e.comments.isChild(i,t)||(n=l,o=o.add(i.find(s.comment)),t=i)}),o},_massAction:function(e){e=e.toLowerCase();var t,s=this,i=LiveJournal.constructUrl(LiveJournal.getAjaxUrl("talkmulti"),{format:"json"}),n={confirm:"1",lj_form_auth:this._authToken,mode:e,ditemid:this._ditemid,journal:Site.currentJournal},o=this._form.get(0).elements,l=[];if(["collapse","expand","freeze","unfreeze"].indexOf(e)>-1&&this._findTopChecked().each(function(){l.push(this.getAttribute("id"))}),["screen","unscreen","freeze","unfreeze","delete","deletespam","unspam"].indexOf(e)>-1)for(var a=!/((un)?freeze)/.test(e),c=0,d=o.length;d>c;++c)o[c].name.match(/selected_\d+/)&&o[c].checked&&(n[o[c].name]="on",a&&!~l.indexOf(o[c].dataset.itemId)&&l.push(o[c].dataset.itemId));return"collapse"===e||"expand"===e?(t=LJ.Function.threshold(function(t){s.element.trigger(e,[t,!0])},20,!0),l.forEach(t),this._setPending(!1),void this._updateBoxes(this.element.find(this.options.selectors.checkboxes+":checked"),!1)):(this._setPending(!0),void(0!==l.length&&jQuery.post(i,n,function(t){if(s._setPending(!1),"ok"===t.status)if("unspam"===e){var i=l.map(function(e){return e.substr(1)});s.element.trigger("removeFromDOM",[i,"unspam"])}else s._refreshComments(e,l);else s.element.find(s.options.selectors.error).html(t.message),s._massActions.addClass(s.options.classNames.error)},"json")))},_refreshComments:function(e,t){var s=t.map(function(e){return e.substr(1)}),i=this;s.forEach(function(t){Function.defer(function(){e.match(/^delete/)?(i.element.trigger("deleteComment",[t]),i._checkVisibility({type:"deleteComment"})):i.element.trigger("refreshThread",[t,!e.match(/^(un)?freeze/),e])})})},_checkMassActionsPanelPosition:function(){var e=jQuery.browser.msie&&jQuery.browser.version.substr(0,1)<9?document.documentElement.scrollTop:t.pageYOffset,s=0,i=this.options.classNames.massActionsFixed;this._panelFixed?(s=this._massActionsAnchor.offset().top,this._massActionsHeight=this._massActionsHeight||this._massActionsAnchor.height(),s+=this._massActionsHeight,s+this._ljtimes.height()>jQuery(t).height()+e?this._massActions.addClass(i):this._massActions.removeClass(i)):this._massActions.removeClass(i)},_updateBoxes:function(e,t){var s=this;e.each(function(){this.checked=t,s._markChecked(jQuery(this),t)}),this._updateMassActionsPanel(t)},_markChecked:function(e,t){t=!!t;var s=this.options.selectors,i=this.options.classNames,n=e.closest(s.comment);t&&n.hasClass(i.commentSelected)||n.toggleClass(i.commentSelected,t).closest(s.twig).toggleClass(i.twigSelected,t)},_updateMassActionsPanel:function(e){var t=this.options.selectors,s=this.options.classNames.massActionsFixed;0===this._ljtimes.length&&(this._ljtimes=jQuery(t.ljtimes));var i=this._panelFixed;this._setActive(!!e||this.element.find(t.checkboxes+":checked:first").length>0),this._checkMassActionsPanelPosition(),this._panelFixed&&this._massActions.hasClass(s)&&(i||this._massActions.hide().fadeIn(100)),this._checkVisibility.bind(this);var n=e&&0===this.element.find(t.checkboxes+":not(:checked):first").length;this._massActionsCheckAll.attr("checked",n)},_getComment:function(e){return"object"!==("undefined"==typeof e?"undefined":_typeof(e))&&(e=jQuery(e)),0!==e.length?{node:e,ditemid:e.prop("id").substr(1),username:e.data("username"),displayname:e.data("displayname")}:void 0},_toggleAll:function(e){var t=this,s=LJ.Function.threshold(function(s){t.element.trigger(e,[s,!0])},20,!0);s.batch(2),this.element.find(this.options.selectors.firstLevel).each(function(){s(this.getAttribute("data-tid"))})},expandAll:function(){this._toggleAll("expand")},collapseAll:function(){this._toggleAll("collapse")}})}(jQuery,window);
/* <<< file end: js/jquery/jquery.lj.commentsMassActions.js */

//# map link was there [jquery.lj.commentsMassActions.js.map]
